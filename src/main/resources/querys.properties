PolizasFovi_Anios=SELECT DISTINCT CALENDARIO AS CALENDARIO, CALENDARIO AS CALENDARIO_NAME FROM CALENDARIOS_CON WHERE COMPANIA = '[compania]' ORDER BY 1 DESC
PolizasFovi_datos= SELECT P.HORA AS HORA, P.COMPANIA AS COMPANIA, C_COSTOS||'-'||C_COSTOS.NOMBRE AS CTO, P.NUMERO AS NUMERO, P.ESTATUS AS ESTATUS, P.TIPO_POLIZA||'-'||T.NOMBRE AS TIPO, TO_CHAR(P.FECHA,'DD/MM/YYYY') AS FECHA, P.NOMBRE AS NOMBRE, P.DIVISA AS DIVISA, P.DIVISA||'-'||D.NOMBRE AS DIVISA_NOM, P.PARIDAD AS PARIDAD, P.FUENTE AS FUENTE, P.REFERENCIA AS REFERENCIA, P.CARGOS_BASE AS CARGOS_BASE, P.ABONOS_BASE AS ABONOS_BASE, P.CARGOS AS CARGOS , P.ABONOS AS ABONOS FROM POLIZAS P, DIVISAS D, TIPOS_POLIZAS T, C_COSTOS WHERE SUBSTR(NUMERO,1,2) = C_COSTOS.C_COSTOS AND C_COSTOS.COMPANIA = '[compania]' AND P.DIVISA = D.DIVISA AND P.TIPO_POLIZA = T.TIPO_POLIZA AND T.COMPANIA = P.COMPANIA AND TO_CHAR(P.FECHA,'YYYY') = '[calendario]' AND SUBSTR(P.NUMERO,1,2) LIKE '[ccostos]%' AND P.TIPO_POLIZA = '[tipo_poliza]' AND P.COMPANIA = '[compania]' ORDER BY P.TIPO_POLIZA, P.NUMERO
PolizasFovi_DetPolizas_datos = SELECT (SELECT ID_TRANSACCION FROM DET_POLIZASXTRANSACCION WHERE COMPANIA = '[compania]' AND TIPO_POLIZA = '[tipo_poliza]' AND FECHA = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND NUMERO = '[numero]' AND SEC = D.SEC AND ROWNUM = 1) AS ID_TRANSACCION, D.COMPANIA,  (SELECT SUM (T.IMPORTE) FROM DET_DIOT T WHERE T.COMPANIA = D.COMPANIA AND T.TIPO_POLIZA = D.TIPO_POLIZA AND T.NUMERO = D.NUMERO AND T.FECHA = D.FECHA AND T.SEC = D.SEC) AS NUM_DIOT, D.TIPO_POLIZA, TO_CHAR (D.FECHA, 'DD/MM/YYYY') AS FECHA, D.NUMERO, D.NUMERO || D.TIPO_POLIZA || TO_CHAR (D.FECHA, 'DDMMYYYY') || D.SEC AS ID, D.HORA, D.SEC, D.C_COSTOS AS CC, D.CTO_TRABAJO AS CT, D.CUENTA, (SELECT C2.CUENTA FROM CUENTAS C2 WHERE C2.ESTRUCTURA =D.COMPANIA AND C2.CUENTA=D.CUENTA) AS EXISTE_CUENTA, C.CUENTA_ALIAS,D.DESCRIPCION, D.REFERENCIA, D.CHEQUE, D.RFC, D.CARGOS_BASE, D.ABONOS_BASE, D.CARGOS, D.ABONOS, C.NOMBRE AS NOMCUENTA, D.REFERENCIA2, TO_CHAR (FECHA_DOCUMENTO, 'DD/MM/YYYY') AS FECHA_DOCUMENTO FROM DET_POLIZAS D, CUENTAS C WHERE D.COMPANIA = '[compania]' AND D.TIPO_POLIZA = '[tipo_poliza]' AND D.FECHA = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND D.NUMERO = '[numero]' AND C.CUENTA (+)= D.CUENTA AND C.ESTRUCTURA (+)=D.COMPANIA ORDER BY D.SEC
#PolizasFovi_CCostos=select distinct CTO_CTO as CTO, CTO_CTO||'-'||NOMBRE AS CTO_NAME from ERP_CTO_CTO where compania = '[compania]'  UNION ALL SELECT '', 'SIN CENTRO DE COSTO' AS SC FROM DUAL order by 1
ActualizaEstatus = SELECT ESTATUS FROM POLIZAS WHERE COMPANIA = '[compania]' AND TIPO_POLIZA = '[tipoPoliza]' AND NUMERO = '[numero]' AND FECHA = to_date('[fecha]','dd/mm/yyyy')
CuentaRegistros=SELECT COUNT(*) as TOTAL FROM  det_polizas d, CUENTAS C where d.compania = '[compania]' and d.tipo_poliza = '[tipo_poliza]' and d.fecha = to_date('[fecha]','dd/mm/yyyy') and d.numero = '[numero]' AND C.CUENTA=D.CUENTA AND C.estructura in (select estructura from companias where compania = '[compania]') 

SumCargosAbonos= WITH A AS (SELECT SUM (d.cargos) AS SUM_CARGOS, SUM (d.abonos) AS SUM_ABONOS FROM det_polizas d WHERE d.compania = '[compania]' AND d.tipo_poliza = '[tipo_poliza]' AND d.fecha = TO_DATE ('[fecha]', 'dd/mm/yyyy') AND d.numero = '[numero]' AND D.CUENTA = (SELECT C2.CUENTA FROM CUENTAS C2 WHERE C2.ESTRUCTURA =D.COMPANIA AND C2.CUENTA=D.CUENTA)) , B AS (SELECT COUNT (*) AS TOTAL_REGISTROS FROM det_polizas D2 WHERE D2.COMPANIA = '[compania]' AND D2.TIPO_POLIZA = '[tipo_poliza]' AND d2.fecha = TO_DATE ('[fecha]', 'dd/mm/yyyy') AND D2.numero = '[numero]'), C AS (SELECT COUNT (*) AS TOTAL_VALIDOS FROM det_polizas D2 WHERE D2.COMPANIA = '[compania]' AND D2.TIPO_POLIZA = '[tipo_poliza]' AND d2.fecha = TO_DATE ('[fecha]', 'dd/mm/yyyy') AND D2.numero = '[numero]' AND D2.CUENTA = (SELECT C2.CUENTA FROM CUENTAS C2 WHERE C2.ESTRUCTURA =D2.COMPANIA AND C2.CUENTA=D2.CUENTA)) SELECT * FROM A,B,C

PolizasFovi_Estatus = select estatus from polizas where compania = '[compania]' and FECHA = to_date('[FECHA]', 'DD/MM/YYYY') and TIPO_POLIZA = '[TIPO_POLIZA]' AND NUMERO = '[NUMERO]' AND ESTATUS in ([estatus])
PolizasFovi_EstatusM = select estatus from polizas where compania = '[compania]' and FECHA = to_date('[FECHA]', 'DD/MM/YYYY') and TIPO_POLIZA = '[TIPO_POLIZA]' AND NUMERO = '[NUMERO]' AND ESTATUS in ([estatus])


BuscarNuevaCuenta = SELECT '[cuenta_padre]'||'-'|| SUBSTR ( TO_CHAR (MAX (SUBSTR (CUENTA, LENGTH ('[cuenta_padre]') + 2, 6 ))),0,LENGTH(TO_CHAR (MAX (SUBSTR (CUENTA, LENGTH ('[cuenta_padre]') + 2, 6 )))) - LENGTH(TO_CHAR (MAX (SUBSTR (CUENTA, LENGTH ('[cuenta_padre]') + 2, 6 )) + 1)) )||TO_CHAR (MAX (SUBSTR (CUENTA, LENGTH ('[cuenta_padre]') + 2, 6 )) + 1)AS CUENTA_NEW FROM CUENTAS WHERE CUENTA LIKE '[cuenta_padre]%'  AND ESTRUCTURA = '[compania]'
BuscarNivelCuenta = SELECT TO_CHAR(NVL(MAX(SUBSTR (CUENTA, LENGTH ('[cuenta_padre]') + 2, 6 )),0)+1) as NVL_CUENTA FROM CUENTAS WHERE CUENTA LIKE '[cuenta_padre]%' AND ESTRUCTURA = '[compania]'
BuscarEstructuraCuenta = SELECT FORMATO FROM ESTRUCTURAS WHERE ESTRUCTURA IN (SELECT ESTRUCTURA FROM COMPANIAS WHERE COMPANIA = '[compania]') 

BuscaCT = SELECT distinct CTO_TRABAJO, NOMBRE, CTO_TRABAJO ||'-'|| NOMBRE as NOMBRE_CT FROM CTO_TRABAJO where compania = '[compania]' and (CTO_TRABAJO like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%'))                           
BuscaCC = SELECT DISTINCT CTO_CTO AS CTO, CTO_CTO||'-'||NOMBRE AS NOMBRE_CTO FROM ERP_CTO_CTO WHERE COMPANIA = '[compania]' AND (CTO_CTO like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%')) AND CTO_CTO IN ( SELECT C_COSTOS from ERP_USUARIO_C_COSTO WHERE USUARIO ='[usuario]') AND (SELECT COUNT(*) from ERP_USUARIO_C_COSTO WHERE USUARIO ='[usuario]') >0 UNION  SELECT DISTINCT CTO_CTO AS CTO, CTO_CTO||'-'||NOMBRE AS NOMBRE_CTO FROM ERP_CTO_CTO WHERE COMPANIA = '[compania]' AND (CTO_CTO like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%')) AND (SELECT COUNT(*) from ERP_USUARIO_C_COSTO WHERE USUARIO ='[usuario]') =0
BuscaCCXUsuario = select distinct CTO_CTO as CTO, CTO_CTO||'-'||NOMBRE AS NOMBRE_CTO from ERP_CTO_CTO where compania = '[compania]' and (CTO_CTO like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%')) AND CTO_CTO IN ( SELECT C_COSTOS from ERP_USUARIO_C_COSTO WHERE USUARIO ='[usuario]')




ActivarCuentaPadre = SELECT COUNT(*) as TOTAL_CUENTA FROM CUENTAS where ESTRUCTURA = '[compania]' AND CUENTA = CUENTA_ALIAS
PolizasFovi_Cuentas =select CUENTA_ALIAS,cuenta, nombre as nombre from cuentas where estructura in (select estructura from companias where compania = '[compania]') and afectable = 'S' and (cuenta_ALIAS like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%')) union select DISTINCT 'cuenta' as CUENTA_ALIAS, 'x' as cuenta, 'crear cuenta' as nombre from gentus S, gentpe e where S.us_usuario = '[usuario]' and s.us_grupo = e.PE_GPOUSU AND E.PE_CVEOPC IN ('m12o2e2','m12o2e10') AND PE_PERMISOS = 'ABMCR' UNION select CUENTA_ALIAS,cuenta, nombre as nombre from CUENTAS where REPLACE (cuenta_alias,'-','') like RTRIM('[query]%') and estructura in (select estructura from companias where compania = '[compania]') and afectable = 'S' order by 1
PolizasFovi_CuentasPadre = select CUENTA_ALIAS, AFECTABLE, CIERRE, ESTATUS,NATURALEZA, TIPO, MAYOR ,cuenta, cuenta_alias ||'-'||nombre as nombre from cuentas where estructura in (select estructura from companias where compania = '[compania]') and (cuenta_ALIAS like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%')) AND AFECTABLE = 'N' UNION  SELECT 'Titulo','','','','','','','1','TITULO' FROM DUAL
PolizasFovi_CuentasPadre2 = select CUENTA_ALIAS, AFECTABLE, CIERRE, ESTATUS,NATURALEZA, TIPO, MAYOR ,cuenta, cuenta_alias ||'-'||nombre as nombre from cuentas where estructura in (select estructura from companias where compania = '[compania]') and (cuenta_ALIAS like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%'))

PolizasFovi_Periodos=select periodo from periodos_con where compania = '[compania]' and to_date('[FECHA]', 'DD/MM/YYYY') between fecha_ini and fecha_fin and estatus = 0
BuscaPoliza = SELECT NUMERO || tipo_poliza || to_char(fecha,'ddmmyyyy') AS ID, NUMERO, to_char(fecha,'dd/mm/yyyy') AS FECHA  FROM POLIZAS WHERE HORA ='[HORA]' AND COMPANIA='[compania]' AND TIPO_POLIZA = '[TIPO]'
BuscaPolizaDet = SELECT NUMERO || tipo_poliza || to_char(fecha,'ddmmyyyy')|| SEC AS ID, NUMERO, to_char(fecha,'dd/mm/yyyy') AS FECHA  FROM DET_POLIZAS WHERE  COMPANIA='[compania]' AND TIPO_POLIZA = '[TIPO]' AND NUMERO ='[NUMERO]' AND HORA ='[HORA]' ORDER BY SEC
BuscaCuentaCorrecta = select CUENTA_ALIAS,cuenta, nombre as nombre,tipo from cuentas where afectable = 'S' and (CUENTA_ALIAS like RTRIM('[CUENTA_ALIAS]%') OR CUENTA like RTRIM('[CUENTA_ALIAS]%')) and estructura in (select estructura from companias where compania = '[compania]')  order by 1
BuscaCuentasOrden = SELECT C.TIPO, C.CUENTA FROM CUENTAS C, DET_POLIZAS P WHERE P.COMPANIA = '[COMPANIA]' AND P.NUMERO = '[NUMERO]' AND P.TIPO_POLIZA = '[TIPO_POLIZA]' AND FECHA = TO_DATE('[FECHA]','DD/MM/YYYY') AND C.ESTRUCTURA = P.COMPANIA AND C.CUENTA = P.CUENTA AND C.TIPO = 'O'
BuscaCuentasOrden2 = SELECT C.TIPO, C.CUENTA FROM CUENTAS C, DET_POLIZAS P WHERE P.COMPANIA = '[COMPANIA]' AND P.NUMERO = '[NUMERO]' AND P.TIPO_POLIZA = '[TIPO_POLIZA]' AND FECHA = TO_DATE('[FECHA]','DD/MM/YYYY') AND C.ESTRUCTURA = P.COMPANIA AND C.CUENTA = P.CUENTA AND C.TIPO <> 'O'

BuscaCuentaAlias = select cuenta, nombre as nombre from cuentas where afectable = 'S' and cuenta_alias like RTRIM('[CUENTA]%') and estructura in (select estructura from companias where compania = '[compania]') order by 1
PolizasFovi_RFC = SELECT NOMBRE, RFC FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND ORIGEN  = 'P' AND RFC LIKE UPPER ('[query]%')
TiposPolizas = SELECT TIPO_POLIZA, NOMBRE, TIPO_POLIZA || '-' || NOMBRE AS NOMBRE1 FROM TIPOS_POLIZAS WHERE COMPANIA = '[compania]'
TiposPolizasTodos = SELECT TIPO_POLIZA, NOMBRE, TIPO_POLIZA || '-' || NOMBRE AS NOMBRE1 FROM TIPOS_POLIZAS WHERE COMPANIA = '[compania]' UNION SELECT '0' AS TIPO_POLIZA, 'TODOS' AS NOMBRE, 'TODOS' AS NOMBRE1 FROM DUAL ORDER BY 1
TiposPolizasNormal = SELECT TIPO_POLIZA, NOMBRE, TIPO_POLIZA || '-' || NOMBRE AS NOMBRE1 FROM TIPOS_POLIZAS WHERE COMPANIA = '[compania]' ORDER BY 1
ValidaFolioAnual = SELECT NUMERO FROM POLIZAS WHERE COMPANIA = '[compania]' AND TIPO_POLIZA = '[tipoPoliza]' AND  NUMERO = '[numero]'

CONTA_INSERTA_POLIZAS_FOVI= BEGIN CONTA_INSERTA_POLIZAS_FOVI('[HORA]', '[compania]', '[CC]', '[NUMERO]', '[ESTATUS]', '[TIPO]', TO_DATE('[FECHA]','yyyy-mm-dd'), '[NOMBRE]', '[DIVISA]', '[PARIDAD]', '[FUENTE]', '[REFERENCIA]', [CARGOS_BASE], [ABONOS_BASE], [CARGOS], [ABONOS], '[OPERACION]', '[usuario]'); END;
CONTA_INSERTA_DETPOLIZAS_FOVI= BEGIN CONTA_INSERTA_DETPOLIZAS_FOVI2('[compania]', '[NUMERO]', '[TIPO]', TO_DATE('[FECHA]','dd/mm/yyyy'), '[HORA]', '[SEC]', '[CC]', '[CT]', '[CUENTA]','[DESCRIPCION]', '[REFERENCIA]', '[CHEQUE]', '[RFC]', [CARGOS], [ABONOS], [CARGOS], [ABONOS], '[OPERACION]', '[usuario]','[REFERENCIA2]','[FECHA_DOCUMENTO]'); END;
CONTA_INSERTA_DETPOLIZAS_FOVI3= BEGIN CONTA_INSERTA_DETPOLIZAS_FOVI3('[compania]', '[NUMERO]', '[TIPO_POLIZA]', TO_DATE('[FECHA]','dd/mm/yyyy'), '[HORA]', '[SEC]', '[CC]', '[CT]', '[CUENTA]','[DESCRIPCION]', '[REFERENCIA]', '[CHEQUE]', '[RFC]', [CARGOS], [ABONOS], [CARGOS], [ABONOS], '[OPERACION]','[OPE_SUMA]', '[usuario]','[REFERENCIA2]','[FECHA_DOCUMENTO]'); END;
OPERACIONES_POLIZAS = BEGIN OPERACIONES_POLIZAS('[compania]', '[NUMERO_POL]', '[FECHA_POL]','[TIPO_POL]','[OPERACION]'); END;




BuscaCompania = SELECT DISTINCT COMPANIA, COMPANIA||'-'||NOMBRE AS NOMBRE1 FROM COMPANIAS WHERE COMPANIA = '[compania]'
BuscaRfcCompania = SELECT DISTINCT RFC FROM COMPANIAS WHERE COMPANIA = '[compania]'
PolizasFovi_CCostos=select distinct CTO_CTO as CTO, CTO_CTO||'-'||NOMBRE AS CTO_NAME from ERP_CTO_CTO where compania = '[compania]'  UNION ALL SELECT '', 'TODOS LOS CENTROS DE COSTOS' AS SC FROM DUAL order by 1
PolizasFovi_CCostos_Usuarios = SELECT DISTINCT CTO_CTO as CTO, CTO_CTO||'-'||NOMBRE AS CTO_NAME FROM ERP_CTO_CTO WHERE COMPANIA = '[compania]'  AND CTO_CTO IN ( SELECT C_COSTOS from ERP_USUARIO_C_COSTO WHERE USUARIO ='[usuario]')
PolizasFovi_CCostos2=select distinct CTO_CTO as CTO, CTO_CTO||'-'||NOMBRE AS CTO_NAME from ERP_CTO_CTO where compania = '[compania]' 
#Busqueda de querys
PolizasFovi_datos_busfecha=select /*+ USE_MERGE(D,T) */ (SELECT /*+ FULL (TIPOS_POLIZAS) */  TIPO_SAT FROM TIPOS_POLIZAS WHERE COMPANIA = P.COMPANIA AND TIPO_POLIZA = P.TIPO_POLIZA) AS TIPO_SAT, (SELECT TIPO_SOLICITUD||'-'|| NOMBRE FROM ERP_SAT_TIPO_SOLICITUD WHERE TIPO_SOLICITUD = P.TIPO_SOLICITUD) AS TIPO_SOLICITUD, P.NUM_ORDEN, P.NUM_TRAMITE, P.NUMERO || p.tipo_poliza || to_char(p.fecha,'ddmmyyyy') AS ID,p.hora,to_char(p.FECHA_CAP,'dd/mm/yyyy HH:MI:SS P.M.') AS FECHA_CAP,p.compania,cto.cto_cto||'-'||cto.nombre,p.numero,p.estatus,p.tipo_poliza||'-'||t.nombre AS TIPO,p.tipo_poliza,to_char(p.fecha,'dd/mm/yyyy') AS FECHA,p.MODULO_ORIG ,p.nombre, p.divisa ,p.divisa||'-'||d.nombre,p.paridad,p.fuente,p.referencia,p.cargos_base,p.abonos_base,p.cargos,p.abonos,(SELECT PDF FROM ERP_POLIZASXFACTURAS R,ERP_FE_COMPROBANTES F WHERE R.COMPANIA=P.COMPANIA AND R.NUMERO_POL=P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) AS PDF, NVL(NVL((SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1), (SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXPAGOS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1)),(SELECT DISTINCT PID FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1)) AS UUID_RELACION, case when t.tipo_sat = 'D' THEN (SELECT XML FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) else (SELECT XML FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE  R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS XML,case when t.tipo_sat = 'D' THEN (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F  WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA  AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) ELSE (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA  AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS FECHA_FACT, NVL((SELECT F.NUMERO FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1), (SELECT F.NUMERO FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1)) AS NUMERO_FACT , (SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_XML,(SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_PDF,(SELECT DISTINCT DIC_TIMBRADO FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1) AS NOM_CFDI from polizas p, erp_divisas d, tipos_polizas t, ERP_CTO_CTO cto where  p.compania = '[compania]' and    p.tipo_poliza = '[tipo_poliza]'  and t.compania = p.compania and t.tipo_poliza = p.tipo_poliza and  to_char(p.fecha,'yyyy') = '[calendario]' and d.divisa = p.divisa and p.fecha BETWEEN to_date('[fec_ini]','dd/mm/yyyy') and to_date('[fec_fin]','dd/mm/yyyy') and cto.compania = p.compania and cto.cto_cto IN (SELECT DISTINCT det2.C_COSTOS FROM DET_POLIZAS det2 WHERE det2.COMPANIA = '[compania]' AND det2.TIPO_POLIZA = '[tipo_poliza]' AND det2.FECHA = P.FECHA AND det2.NUMERO=P.NUMERO AND det2.c_costos like '[ccostos]%' ) order by p.tipo_poliza, p.numero
PolizasFovi_datos_busfecnum=select /*+ USE_MERGE(D,T) */ (SELECT /*+ FULL (TIPOS_POLIZAS) */  TIPO_SAT FROM TIPOS_POLIZAS WHERE COMPANIA = P.COMPANIA AND TIPO_POLIZA = P.TIPO_POLIZA) AS TIPO_SAT,(SELECT TIPO_SOLICITUD||'-'|| NOMBRE FROM ERP_SAT_TIPO_SOLICITUD WHERE TIPO_SOLICITUD = P.TIPO_SOLICITUD) AS TIPO_SOLICITUD, P.NUM_ORDEN, P.NUM_TRAMITE, P.NUMERO || p.tipo_poliza || to_char(p.fecha,'ddmmyyyy') AS ID,p.hora,to_char(p.FECHA_CAP,'dd/mm/yyyy HH:MI:SS P.M.') AS FECHA_CAP,p.compania,cto.cto_cto||'-'||cto.nombre,p.numero,p.estatus,p.tipo_poliza||'-'||t.nombre AS TIPO,p.tipo_poliza,to_char(p.fecha,'dd/mm/yyyy') AS FECHA, p.MODULO_ORIG ,p.nombre, p.divisa,p.divisa||'-'||d.nombre,p.paridad,p.fuente,p.referencia,p.cargos_base,p.abonos_base,p.cargos,p.abonos,(SELECT PDF FROM ERP_POLIZASXFACTURAS R,ERP_FE_COMPROBANTES F WHERE R.COMPANIA=P.COMPANIA AND R.NUMERO_POL=P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) AS PDF, NVL(NVL((SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1), (SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXPAGOS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1)),(SELECT DISTINCT PID FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1)) AS UUID_RELACION, case when t.tipo_sat = 'D' THEN (SELECT XML FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) else (SELECT XML FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE  R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS XML,case when t.tipo_sat = 'D' THEN (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F  WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA  AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) ELSE (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA  AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS FECHA_FACT, NVL((SELECT F.NUMERO FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1), (SELECT F.NUMERO FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1)) AS NUMERO_FACT , (SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_XML,(SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_PDF,(SELECT DISTINCT DIC_TIMBRADO FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1) AS NOM_CFDI from polizas p, erp_divisas d, tipos_polizas t, ERP_CTO_CTO cto where  p.compania = '[compania]' and    p.tipo_poliza = '[tipo_poliza]'  and t.compania = p.compania and t.tipo_poliza = p.tipo_poliza and  to_char(p.fecha,'yyyy') = '[calendario]' and d.divisa = p.divisa and p.fecha BETWEEN to_date('[fec_ini]','dd/mm/yyyy') and to_date('[fec_fin]','dd/mm/yyyy') and cto.compania = p.compania and cto.cto_cto IN (SELECT DISTINCT det2.C_COSTOS FROM DET_POLIZAS det2 WHERE det2.COMPANIA = '[compania]' AND det2.TIPO_POLIZA = '[tipo_poliza]' AND det2.FECHA = P.FECHA AND det2.NUMERO=P.NUMERO AND det2.c_costos like '[ccostos]%' ) and p.numero between [num_ini] and [num_fin] order by p.tipo_poliza, p.numero
PolizasFovi_datos_busfecha_sinCC= select /*+ USE_MERGE(D,T) */ (SELECT /*+ FULL (TIPOS_POLIZAS) */   TIPO_SAT FROM TIPOS_POLIZAS WHERE COMPANIA = P.COMPANIA AND TIPO_POLIZA = P.TIPO_POLIZA) AS TIPO_SAT,(SELECT TIPO_SOLICITUD||'-'|| NOMBRE FROM ERP_SAT_TIPO_SOLICITUD WHERE TIPO_SOLICITUD = P.TIPO_SOLICITUD) AS TIPO_SOLICITUD, P.NUM_ORDEN, P.NUM_TRAMITE, P.NUMERO || p.tipo_poliza || to_char(p.fecha,'ddmmyyyy') AS ID, p.hora,to_char(p.FECHA_CAP,'dd/mm/yyyy HH:MI:SS P.M.') AS FECHA_CAP,p.compania,'00-00' as cto_cto   ,p.numero,p.estatus,p.tipo_poliza||'-'||t.nombre AS TIPO,p.tipo_poliza,to_char(p.fecha,'dd/mm/yyyy') AS FECHA, p.MODULO_ORIG ,p.nombre, p.divisa,p.divisa||'-'||d.nombre,p.paridad,p.fuente,p.referencia,p.cargos_base,p.abonos_base,p.cargos,p.abonos,(SELECT PDF FROM ERP_POLIZASXFACTURAS R,ERP_FE_COMPROBANTES F WHERE R.COMPANIA=P.COMPANIA AND R.NUMERO_POL=P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) AS PDF, NVL(NVL((SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1), (SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXPAGOS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1)),(SELECT DISTINCT PID FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1)) AS UUID_RELACION, case when t.tipo_sat = 'D' THEN (SELECT XML FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) else (SELECT XML FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE  R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS XML,case when t.tipo_sat = 'D' THEN (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F  WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA  AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) ELSE (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA  AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS FECHA_FACT, NVL((SELECT F.NUMERO FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1), (SELECT F.NUMERO FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1)) AS NUMERO_FACT , (SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_XML,(SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_PDF,(SELECT DISTINCT DIC_TIMBRADO FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1) AS NOM_CFDI from polizas p, erp_divisas d, tipos_polizas t where  p.compania = '[compania]' and    p.tipo_poliza = '[tipo_poliza]'  and t.compania = p.compania and t.tipo_poliza = p.tipo_poliza and  to_char(p.fecha,'yyyy') = '[calendario]' and d.divisa = p.divisa and p.fecha BETWEEN to_date('[fec_ini]','dd/mm/yyyy') and to_date('[fec_fin]','dd/mm/yyyy')  order by p.tipo_poliza, p.numero
PolizasFovi_datos_busfecnum_sinCC= select /*+ USE_MERGE(D,T) */ (SELECT /*+ FULL (TIPOS_POLIZAS) */   TIPO_SAT FROM TIPOS_POLIZAS WHERE COMPANIA = P.COMPANIA AND TIPO_POLIZA = P.TIPO_POLIZA) AS TIPO_SAT,(SELECT TIPO_SOLICITUD||'-'|| NOMBRE FROM ERP_SAT_TIPO_SOLICITUD WHERE TIPO_SOLICITUD = P.TIPO_SOLICITUD) AS TIPO_SOLICITUD, P.NUM_ORDEN, P.NUM_TRAMITE, P.NUMERO || p.tipo_poliza || to_char(p.fecha,'ddmmyyyy') AS ID, p.hora,to_char(p.FECHA_CAP,'dd/mm/yyyy HH:MI:SS P.M.') AS FECHA_CAP,p.compania,'00-00' as cto_cto   ,p.numero,p.estatus,p.tipo_poliza||'-'||t.nombre AS TIPO,p.tipo_poliza,to_char(p.fecha,'dd/mm/yyyy') AS FECHA, p.MODULO_ORIG ,p.nombre, p.divisa,p.divisa||'-'||d.nombre,p.paridad,p.fuente,p.referencia,p.cargos_base,p.abonos_base,p.cargos,p.abonos,(SELECT PDF FROM ERP_POLIZASXFACTURAS R,ERP_FE_COMPROBANTES F WHERE R.COMPANIA=P.COMPANIA AND R.NUMERO_POL=P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) AS PDF,NVL(NVL((SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1), (SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXPAGOS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1)),(SELECT DISTINCT PID FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1)) AS UUID_RELACION, case when t.tipo_sat = 'D' THEN (SELECT XML FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) else (SELECT XML FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE  R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS XML,case when t.tipo_sat = 'D' THEN (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F  WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA  AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) ELSE (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA  AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS FECHA_FACT, NVL((SELECT F.NUMERO FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1), (SELECT F.NUMERO FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1)) AS NUMERO_FACT , (SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_XML,(SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_PDF,(SELECT DISTINCT DIC_TIMBRADO FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1) AS NOM_CFDI from polizas p, erp_divisas d, tipos_polizas t where  p.compania = '[compania]' and    p.tipo_poliza = '[tipo_poliza]'  and t.compania = p.compania and t.tipo_poliza = p.tipo_poliza and  to_char(p.fecha,'yyyy') = '[calendario]' and d.divisa = p.divisa and p.fecha BETWEEN to_date('[fec_ini]','dd/mm/yyyy') and to_date('[fec_fin]','dd/mm/yyyy') and p.numero between [num_ini] and [num_fin] order by p.tipo_poliza, p.numero
PolizasFovi_datos_bus_sinTP_sinCC= select /*+ USE_MERGE(D,T) */ (SELECT /*+ FULL (TIPOS_POLIZAS) */   TIPO_SAT FROM TIPOS_POLIZAS WHERE COMPANIA = P.COMPANIA AND TIPO_POLIZA = P.TIPO_POLIZA) AS TIPO_SAT,(SELECT TIPO_SOLICITUD||'-'|| NOMBRE FROM ERP_SAT_TIPO_SOLICITUD WHERE TIPO_SOLICITUD = P.TIPO_SOLICITUD) AS TIPO_SOLICITUD, P.NUM_ORDEN, P.NUM_TRAMITE, P.NUMERO || p.tipo_poliza || to_char(p.fecha,'ddmmyyyy') AS ID, p.hora,to_char(p.FECHA_CAP,'dd/mm/yyyy HH:MI:SS P.M.') AS FECHA_CAP,p.compania,'00-00' as cto_cto   ,p.numero,p.estatus,p.tipo_poliza||'-'||t.nombre AS TIPO,p.tipo_poliza,to_char(p.fecha,'dd/mm/yyyy') AS FECHA, p.MODULO_ORIG ,p.nombre, p.divisa,p.divisa||'-'||d.nombre,p.paridad,p.fuente,p.referencia,p.cargos_base,p.abonos_base,p.cargos,p.abonos,(SELECT PDF FROM ERP_POLIZASXFACTURAS R,ERP_FE_COMPROBANTES F WHERE R.COMPANIA=P.COMPANIA AND R.NUMERO_POL=P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) AS PDF,NVL(NVL((SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1), (SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXPAGOS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1)),(SELECT DISTINCT PID FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1)) AS UUID_RELACION, case when t.tipo_sat = 'D' THEN (SELECT XML FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) else (SELECT XML FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE  R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS XML,case when t.tipo_sat = 'D' THEN (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F  WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA  AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) ELSE (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA  AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS FECHA_FACT, NVL((SELECT F.NUMERO FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1), (SELECT F.NUMERO FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1)) AS NUMERO_FACT , (SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_XML,(SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_PDF,(SELECT DISTINCT DIC_TIMBRADO FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1) AS NOM_CFDI from polizas p, erp_divisas d, tipos_polizas t where  p.compania = '[compania]'   and t.compania = p.compania and t.tipo_poliza = p.tipo_poliza and  to_char(p.fecha,'yyyy') = '[calendario]' and d.divisa = p.divisa and p.fecha BETWEEN to_date('[fec_ini]','dd/mm/yyyy') and to_date('[fec_fin]','dd/mm/yyyy')  order by p.tipo_poliza, p.numero
PolizasFovi_datos_bus_sinTP=  select /*+ USE_MERGE(D,T) */ (SELECT /*+ FULL (TIPOS_POLIZAS) */  TIPO_SAT FROM TIPOS_POLIZAS WHERE COMPANIA = P.COMPANIA AND TIPO_POLIZA = P.TIPO_POLIZA) AS TIPO_SAT,(SELECT TIPO_SOLICITUD||'-'|| NOMBRE FROM ERP_SAT_TIPO_SOLICITUD WHERE TIPO_SOLICITUD = P.TIPO_SOLICITUD) AS TIPO_SOLICITUD, P.NUM_ORDEN, P.NUM_TRAMITE, P.NUMERO || p.tipo_poliza || to_char(p.fecha,'ddmmyyyy') AS ID, p.hora,to_char(p.FECHA_CAP,'dd/mm/yyyy HH:MI:SS P.M.') AS FECHA_CAP,p.compania,'00-00' as cto_cto   ,p.numero,p.estatus,p.tipo_poliza||'-'||t.nombre AS TIPO,p.tipo_poliza,to_char(p.fecha,'dd/mm/yyyy') AS FECHA, p.MODULO_ORIG ,p.nombre, p.divisa,p.divisa||'-'||d.nombre,p.paridad,p.fuente,p.referencia,p.cargos_base,p.abonos_base,p.cargos,p.abonos,(SELECT PDF FROM ERP_POLIZASXFACTURAS R,ERP_FE_COMPROBANTES F WHERE R.COMPANIA=P.COMPANIA AND R.NUMERO_POL=P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) AS PDF, NVL(NVL((SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1), (SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXPAGOS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1)),(SELECT DISTINCT PID FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1)) AS UUID_RELACION, case when t.tipo_sat = 'D' THEN (SELECT XML FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) else (SELECT XML FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE  R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS XML, case when t.tipo_sat = 'D' THEN (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F  WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA  AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) ELSE (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA  AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS FECHA_FACT, NVL((SELECT F.NUMERO FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1), (SELECT F.NUMERO FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1)) AS NUMERO_FACT , (SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_XML,(SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_PDF,(SELECT DISTINCT DIC_TIMBRADO FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1) AS NOM_CFDI from polizas p, erp_divisas d, tipos_polizas t, ERP_CTO_CTO cto where  p.compania = '[compania]'   and t.compania = p.compania and t.tipo_poliza = p.tipo_poliza and  to_char(p.fecha,'yyyy') = '[calendario]' and d.divisa = p.divisa and p.fecha BETWEEN to_date('[fec_ini]','dd/mm/yyyy') and to_date('[fec_fin]','dd/mm/yyyy') and cto.compania = p.compania and cto.cto_cto IN (SELECT DISTINCT det2.C_COSTOS FROM DET_POLIZAS det2 WHERE det2.COMPANIA = '[compania]' AND det2.TIPO_POLIZA = P.TIPO_POLIZA AND det2.FECHA = P.FECHA AND det2.NUMERO=P.NUMERO AND det2.c_costos like '[ccostos]%' ) order by p.tipo_poliza, p.numero
PolizasFovi_datos_bus_sinTP_num= select /*+ USE_MERGE(D,T) */ (SELECT /*+ FULL (TIPOS_POLIZAS) */  TIPO_SAT FROM TIPOS_POLIZAS WHERE COMPANIA = P.COMPANIA AND TIPO_POLIZA = P.TIPO_POLIZA) AS TIPO_SAT,(SELECT TIPO_SOLICITUD||'-'|| NOMBRE FROM ERP_SAT_TIPO_SOLICITUD WHERE TIPO_SOLICITUD = P.TIPO_SOLICITUD) AS TIPO_SOLICITUD, P.NUM_ORDEN, P.NUM_TRAMITE, P.NUMERO || p.tipo_poliza || to_char(p.fecha,'ddmmyyyy') AS ID, p.hora,to_char(p.FECHA_CAP,'dd/mm/yyyy HH:MI:SS P.M.') AS FECHA_CAP,p.compania,'00-00' as cto_cto   ,p.numero,p.estatus,p.tipo_poliza||'-'||t.nombre AS TIPO,p.tipo_poliza,to_char(p.fecha,'dd/mm/yyyy') AS FECHA, p.MODULO_ORIG ,p.nombre, p.divisa,p.divisa||'-'||d.nombre,p.paridad,p.fuente,p.referencia,p.cargos_base,p.abonos_base,p.cargos,p.abonos,(SELECT PDF FROM ERP_POLIZASXFACTURAS R,ERP_FE_COMPROBANTES F WHERE R.COMPANIA=P.COMPANIA AND R.NUMERO_POL=P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) AS PDF, NVL(NVL((SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1), (SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXPAGOS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1)),(SELECT DISTINCT PID FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1)) AS UUID_RELACION, case when t.tipo_sat = 'D' THEN (SELECT XML FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) else (SELECT XML FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE  R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS XML, case when t.tipo_sat = 'D' THEN (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F  WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA  AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) ELSE (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA  AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS FECHA_FACT, NVL((SELECT F.NUMERO FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1), (SELECT F.NUMERO FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1)) AS NUMERO_FACT , (SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_XML,(SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_PDF,(SELECT DISTINCT DIC_TIMBRADO FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1) AS NOM_CFDI from polizas p, erp_divisas d, tipos_polizas t, ERP_CTO_CTO cto where  p.compania = '[compania]'   and t.compania = p.compania and t.tipo_poliza = p.tipo_poliza and  to_char(p.fecha,'yyyy') = '[calendario]' and d.divisa = p.divisa and p.fecha BETWEEN to_date('[fec_ini]','dd/mm/yyyy') and to_date('[fec_fin]','dd/mm/yyyy') and cto.compania = p.compania and cto.cto_cto IN (SELECT DISTINCT det2.C_COSTOS FROM DET_POLIZAS det2 WHERE det2.COMPANIA = '[compania]' AND det2.TIPO_POLIZA = P.TIPO_POLIZA AND det2.FECHA = P.FECHA AND det2.NUMERO=P.NUMERO AND det2.c_costos like '[ccostos]%' ) and p.numero between [num_ini] and [num_fin] order by p.tipo_poliza, p.numero
PolizasFovi_datos_bus_sinTP_sinCCnum= select /*+ USE_MERGE(D,T) */ (SELECT /*+ FULL (TIPOS_POLIZAS) */  TIPO_SAT FROM TIPOS_POLIZAS WHERE COMPANIA = P.COMPANIA AND TIPO_POLIZA = P.TIPO_POLIZA) AS TIPO_SAT,(SELECT TIPO_SOLICITUD||'-'|| NOMBRE FROM ERP_SAT_TIPO_SOLICITUD WHERE TIPO_SOLICITUD = P.TIPO_SOLICITUD) AS TIPO_SOLICITUD, P.NUM_ORDEN, P.NUM_TRAMITE, P.NUMERO || p.tipo_poliza || to_char(p.fecha,'ddmmyyyy') AS ID, p.hora,to_char(p.FECHA_CAP,'dd/mm/yyyy HH:MI:SS P.M.') AS FECHA_CAP,p.compania,'00-00' as cto_cto   ,p.numero,p.estatus,p.tipo_poliza||'-'||t.nombre AS TIPO,p.tipo_poliza,to_char(p.fecha,'dd/mm/yyyy') AS FECHA, p.MODULO_ORIG ,p.nombre, p.divisa,p.divisa||'-'||d.nombre,p.paridad,p.fuente,p.referencia,p.cargos_base,p.abonos_base,p.cargos,p.abonos,(SELECT PDF FROM ERP_POLIZASXFACTURAS R,ERP_FE_COMPROBANTES F WHERE R.COMPANIA=P.COMPANIA AND R.NUMERO_POL=P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) AS PDF, NVL(NVL((SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1), (SELECT NUMERO_POL AS UUID FROM ERP_POLIZASXPAGOS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1)),(SELECT DISTINCT PID FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1)) AS UUID_RELACION, case when t.tipo_sat = 'D' THEN (SELECT XML FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) else (SELECT XML FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE  R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS XML, case when t.tipo_sat = 'D' THEN (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F  WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA  AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) ELSE (SELECT TO_CHAR (F.FECHA, 'DD/MM/YYYY') FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA  AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1) END AS FECHA_FACT, NVL((SELECT F.NUMERO FROM ERP_POLIZASXFACTURAS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1), (SELECT F.NUMERO FROM ERP_POLIZASXPAGOS R, ERP_FE_COMPROBANTES F WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND F.COMPANIA = R.COMPANIA AND F.NUMERO = R.NUMERO_FE AND ROWNUM = 1)) AS NUMERO_FACT , (SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.xml' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_XML,(SELECT  CASE WHEN R.ORIGEN = 'CXP' AND R.NUMERO_FE IS NULL THEN (SELECT  C.COMPANIA || '/CFDI_' || C.COMPANIA || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' FROM FE_FACTURAS@CFDI C WHERE C.UUID = R.UUID) ELSE COMPANIA_CFDI || '/CFDI_' || COMPANIA_CFDI || '_' || R.ID_FACTURA || '_F' || R.FOLIO || '.pdf' END FROM ERP_POLIZASXFACTURAS R WHERE R.COMPANIA = P.COMPANIA AND R.NUMERO_POL = P.NUMERO AND R.FECHA_POL = P.FECHA AND R.TIPO_POL = P.TIPO_POLIZA AND ROWNUM = 1) AS CXC_PDF,(SELECT DISTINCT DIC_TIMBRADO FROM ERP_NOM_POLIZA N WHERE N.COMPANIA = P.COMPANIA AND N.NUMERO_POLIZA = P.NUMERO AND N.FECHA_POLIZA = P.FECHA AND N.TIPO_POLIZA = P.TIPO_POLIZA AND ROWNUM = 1) AS NOM_CFDI from polizas p, erp_divisas d, tipos_polizas t where  p.compania = '[compania]'   and t.compania = p.compania and t.tipo_poliza = p.tipo_poliza and  to_char(p.fecha,'yyyy') = '[calendario]' and d.divisa = p.divisa and p.fecha BETWEEN to_date('[fec_ini]','dd/mm/yyyy') and to_date('[fec_fin]','dd/mm/yyyy') and p.numero between [num_ini] and [num_fin] order by p.tipo_poliza, p.numero
##Fin busqueda querys
TiposSolicitud = SELECT TIPO_SOLICITUD, NOMBRE , TIPO_SOLICITUD||'-'|| NOMBRE AS NOMBRE1 FROM ERP_SAT_TIPO_SOLICITUD



BuscaCCCorrecto=select distinct CTO_CTO as CTO, CTO_CTO||'-'||NOMBRE AS CTO_NAME from ERP_CTO_CTO where compania = '[compania]' AND CTO_CTO = '[CC]'  order by 1
BuscaCCCorrectoNom=select distinct CTO_CTO as CTO, CTO_CTO||'-'||NOMBRE AS CTO_NAME from ERP_CTO_CTO where compania = '[compania]' AND CTO_NOM LIKE '%[CC]%'  order by 1
EstatusPoliza=SELECT ESTATUS FROM POLIZAS WHERE  COMPANIA='[compania]' AND TIPO_POLIZA = '[TIPO]' AND NUMERO ='[NUMERO]' AND FECHA = '[FECHA]'
BuscaDetallePolizaCopia = SELECT d.NUMERO || d.tipo_poliza || to_char(d.fecha,'ddmmyyyy') || D.SEC AS ID,d.hora, d.sec, d.c_costos AS CC, d.cto_trabajo AS CT, d.cuenta, d.descripcion, d.referencia, d.cheque, d.rfc, d.cargos_base, d.abonos_base, d.cargos, d.abonos from det_polizas d WHERE  d.COMPANIA='[compania]' AND d.TIPO_POLIZA = '[tipOriginal]' AND d.NUMERO ='[numOriginal]' AND d.FECHA = to_date('[fecOriginal]','DD/MM/YYYY') ORDER BY d.SEC

CopiaPolizasDet = INSERT INTO DET_POLIZAS (COMPANIA, TIPO_POLIZA, FECHA, NUMERO, SEC, CUENTA, C_COSTOS, DESCRIPCION, REFERENCIA, CARGOS_BASE, ABONOS_BASE, CARGOS, ABONOS, RFC, INDICADOR, FECHA_CAP, CHEQUE, ESTATUS, HORA, CTO_TRABAJO, REFERENCIA2, FECHA_DOCUMENTO) SELECT '[compania_copia]' AS COMPANIA, '[tipoPoliza_copia]' as TIPO_POLIZA, TO_DATE('[fecha_copia]','DD/MM/YYYY') as FECHA, '[NUMERO_copia]' AS NUMERO, SEC, CUENTA, C_COSTOS, DESCRIPCION, REFERENCIA, CARGOS_BASE, ABONOS_BASE, CARGOS,ABONOS , RFC, INDICADOR, SYSDATE as FECHA_CAP, CHEQUE, ESTATUS, HORA, CTO_TRABAJO, REFERENCIA2, FECHA_DOCUMENTO FROM DET_POLIZAS WHERE COMPANIA = '[compania]' AND NUMERO = '[numero_original]' AND TIPO_POLIZA = '[tipoPoliza_original]' and  FECHA = TO_DATE('[fecha_original]','DD/MM/YYYY')
#BuscaArchivos2 = SELECT COMPANIA, TIPO_POLIZA, TO_CHAR(FECHA,'DD/MM/YYYY') as FECHA, NUMERO, SEC, PATH, URL, NOMBRE, DESCRIPCION, '1' AS TIPO FROM POLIZAS_ARCHIVOS WHERE COMPANIA ='[compania]' AND TIPO_POLIZA = '[tipo_poliza]' AND FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND NUMERO = '[numero]'  UNION SELECT C.COMPANIA, C.TIPO_POLIZA, TO_CHAR(C.FECHA_POL,'DD/MM/YYYY') as FECHA, C.NUMERO_POL AS NUMERO, C.NUMERO AS SEC, C.DIR_XML AS PATH, C.XML AS URL, E.NOMBRE, P.DESCRIPCION, '2' AS TIPO  FROM ERP_FE_COMPROBANTES C, ERP_FE_CONCEPTOS P, ERP_FE_EMISOR E WHERE C.COMPANIA ='[compania]' AND C.NUMERO = P.NUMERO AND C.NUMERO = E.NUMERO AND C.TIPO_POLIZA = '[tipo_poliza]' AND C.FECHA_POL = TO_DATE('[fecha]','DD/MM/YYYY') AND C.NUMERO_POL= '[numero]' order by sec desc 
BuscaArchivos2 = SELECT COMPANIA, TIPO_POLIZA, TO_CHAR(FECHA,'DD/MM/YYYY') as FECHA, NUMERO, SEC, PATH, URL, NOMBRE, DESCRIPCION, '1' AS TIPO FROM POLIZAS_ARCHIVOS WHERE COMPANIA ='[compania]' AND TIPO_POLIZA = '[tipo_poliza]' AND FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND NUMERO = '[numero]'  UNION SELECT C.COMPANIA, C.TIPO_POLIZA, TO_CHAR(C.FECHA_POL,'DD/MM/YYYY') as FECHA, C.NUMERO_POL AS NUMERO, C.NUMERO AS SEC, C.DIR_XML AS PATH, C.XML AS URL, E.NOMBRE, P.DESCRIPCION, '2' AS TIPO  FROM ERP_FE_COMPROBANTES C, ERP_FE_CONCEPTOS P, ERP_FE_EMISOR E WHERE C.COMPANIA ='[compania]' AND C.NUMERO = P.NUMERO AND C.NUMERO = E.NUMERO AND C.TIPO_POLIZA = '[tipo_poliza]' AND C.FECHA_POL = TO_DATE('[fecha]','DD/MM/YYYY') AND C.NUMERO_POL= '[numero]' UNION SELECT N.COMPANIA, N.TIPO_POLIZA, TO_CHAR(N.FECHA_POLIZA,'DD/MM/YYYY') as FECHA, N.NUMERO_POLIZA AS NUMERO, 0 AS SEC, '' AS PATH, N.DIC_TIMBRADO AS URL, 'NOMINA' AS NOMBRE, 'Reporte Timbrado' AS DESCRIPCION, '3' AS TIPO FROM ERP_NOM_POLIZA N WHERE N.COMPANIA ='[compania]' AND N.TIPO_POLIZA = '[tipo_poliza]' AND N.FECHA_POLIZA = TO_DATE('[fecha]','DD/MM/YYYY') AND N.NUMERO_POLIZA = '[numero]' UNION SELECT P.COMPANIA,P.TIPO_POL AS TIPO_POLIZA,  TO_CHAR (P.FECHA_POL, 'DD/MM/YYYY') AS FECHA,P.NUMERO_POL AS NUMERO,C.SEC AS SEC,'' AS PATH, TO_CHAR(E.FECHA,'YYYY') || '/' || TO_CHAR(E.FECHA,'MM')|| '/' || E.PDF AS URL,'Comprobacion Factura' as NOMBRE, (SELECT NOMBRE || '-' || C.NOMBRE_PROV FROM VI_CONC_GASTOS_COMP WHERE CONC_GASTO = C.CONC_GASTO AND ESTATUS = 'A' AND COMPANIA = C.COMPANIA) AS DESCRIPCION,'4' AS TIPO FROM ERP_POLIZASXPAGOS P, VI_COMPROBACION_COMISION C,ERP_FE_COMPROBANTES E  WHERE P.COMPANIA = '[compania]' AND P.NUMERO_POL = '[numero]' AND P.FECHA_POL = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND P.TIPO_POL = '[tipo_poliza]' AND P.NUMERO_FE = C.COMISION  AND C.COMPANIA = P.COMPANIA AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO_FE  AND C.FORMA_COMPROBACION = '1' and P.OPERACION = 'GE' AND P.ORIGEN = 'VIA' UNION SELECT DISTINCT P.COMPANIA, P.TIPO_POL AS TIPO_POLIZA, TO_CHAR (P.FECHA_POL, 'DD/MM/YYYY') AS FECHA, P.NUMERO_POL AS NUMERO, A.SEC AS SEC, '' AS PATH, A.COMISION || '/' || A.NOMBRE AS URL,'Comprobacion Otros' AS NOMBRE, A.DESCRIPCION AS DESCRIPCION, '5' AS TIPO FROM ERP_POLIZASXPAGOS P, VI_COMPROBACION_COMISION C, VI_COMPROBACION_ARCHIVOS A WHERE P.COMPANIA = '[compania]' AND P.NUMERO_POL = '[numero]' AND P.FECHA_POL = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND P.TIPO_POL = '[tipo_poliza]' AND P.NUMERO_FE = C.COMISION AND C.COMPANIA = P.COMPANIA AND A.COMPANIA = C.COMPANIA AND A.COMISION = C.COMISION AND C.FORMA_COMPROBACION <> '1' AND P.OPERACION = 'GE' AND P.ORIGEN = 'VIA' order by sec desc 
INSERTA_DATOS_ARCHIVO= INSERT INTO POLIZAS_ARCHIVOS ( COMPANIA, TIPO_POLIZA, FECHA,  NUMERO, SEC, PATH,  URL,NOMBRE,DESCRIPCION) VALUES ( '[compania]','[TIPO_POLIZA]', TO_DATE('[FECHA]','DD/MM/YYYY'), '[NUMERO]', (SELECT NVL(MAX(SEC),0)+1 FROM POLIZAS_ARCHIVOS WHERE COMPANIA ='[compania]' AND TIPO_POLIZA = '[TIPO_POLIZA]' AND FECHA=TO_DATE('[FECHA]','DD/MM/YYYY') AND NUMERO ='[NUMERO]'), '[PATH]', '[URL]','[NOMBRE]','[DESCRIPCION]')
QUITAR_ARCHIVO = DELETE FROM POLIZAS_ARCHIVOS WHERE COMPANIA ='[compania]' AND TIPO_POLIZA = '[tipo_poliza]' AND FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND NUMERO= '[numero]' AND SEC=[sec]

#Factura Electronica

numeroPolFe=SELECT NUMERO, TO_CHAR (FECHA, 'DD/MM/YYYY') AS FECHA, TIPO_POLIZA, NOMBRE FROM POLIZAS WHERE COMPANIA = '[compania]' and tipo_poliza = '[tipo_poliza]' AND FECHA between (SELECT FECHA_INI FROM PERIODOS_CON WHERE PERIODO = '[periodo]' AND CALENDARIO = '[calendario]' AND COMPANIA = '[compania]') AND (SELECT FECHA_FIN FROM PERIODOS_CON WHERE PERIODO = '[periodo]' AND CALENDARIO = '[calendario]' AND COMPANIA = '[compania]') and (NUMERO like RTRIM('%[query]%') OR upper(NOMBRE) like upper('%[query]%'))
CalendarioFe=SELECT CALENDARIO FROM CALENDARIOS_CON WHERE COMPANIA = '[compania]' ORDER BY CALENDARIO DESC
PeriodoFe=SELECT PERIODO FROM PERIODOS_CON WHERE COMPANIA = '[compania]' AND CALENDARIO = '[calendario]' ORDER BY PERIODO DESC
BuscaArchivos=SELECT F.COMPANIA,  NVL((F.ESTATUSV),'2') AS ESTATUSV, F.NUMERO, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO,  (SELECT CON.NO_CASO||'-'||CON.NOMBRE FROM ERP_CAT_CONVERTIDOR CON WHERE CON.COMPANIA = F.COMPANIA AND TO_CHAR(CON.NO_CASO)= F.IDCONCGASTO) AS NOMIDCONCGASTO, F.ORIGEN, (SELECT  P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS TIPO_POLIZA, (SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS NUMERO_POL, (SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS FECHA_POL, F.XML, TO_CHAR(F.FECHA_CAP,'DD/MM/YYYY') AS FECHA_CAP, F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA,(CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN 'Cliente' ELSE 'Proveedor' END) TIPO, (CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN (SELECT CUENTA FROM ERP_CLIENTES WHERE COMPANIA =F.COMPANIA AND RFC = (SELECT E.NOMBRE  FROM ERP_FE_RECEPTOR E  WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND ROWNUM=1)) ELSE (SELECT CUENTA FROM ERP_PROVEEDORES WHERE COMPANIA =F.COMPANIA AND RFC = F.RFC AND ROWNUM = 1) END) CUENTA_CONTABLE, (CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN (SELECT AUXILIAR FROM ERP_CLIENTES WHERE COMPANIA =F.COMPANIA AND RFC = (SELECT E.NOMBRE  FROM ERP_FE_RECEPTOR E  WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND ROWNUM=1)) ELSE (SELECT AUXILIAR FROM ERP_PROVEEDORES WHERE COMPANIA =F.COMPANIA AND RFC = F.RFC AND ROWNUM = 1) END) AUXILIAR_CONTABLE FROM ERP_FE_COMPROBANTES F WHERE F.COMPANIA = '[compania]'  AND NUMERO LIKE '%[FACTURA]%'  AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) = TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(F.FECHA,'YYYY')) = TO_NUMBER('[calendario]') ORDER BY FECHA_POL, F.FECHA DESC
FindCGasto = SELECT COMPANIA, ORIGEN, IDCONCGASTO, NOMBRE, IDCONCGASTO||'-'||NOMBRE AS GNOMBRE FROM ERP_CONCEPTOS_GASTOS WHERE COMPANIA = '[compania]' AND ORIGEN = 'P'
FindCongGastos=SELECT COMPANIA, ORIGEN, IDCONCGASTO,NO_CASO,NOMBRE, NO_CASO||'-'||NOMBRE AS GNOMBRE FROM ERP_CAT_CONVERTIDOR WHERE COMPANIA = '[compania]' AND ORIGEN = 'X' order by NO_CASO
BuscaArchivosDirectorio = SELECT * FROM (SELECT ROWNUM AS NUMERO, XML, NULL AS FLAG_CARGA,'' AS CARGA,TO_CHAR(FECHA,'DD/MM/YYYY  HH24:MI:SS') AS FECHA FROM ERP_FE_XML WHERE COMPANIA = '[compania]' AND HORA = '[HORA]' AND XML NOT IN (SELECT XML FROM ERP_FE_COMPROBANTES WHERE COMPANIA = '[compania]') UNION SELECT ROWNUM AS NUMERO, XML, '1' AS FLAG_CARGA,'CARGA' AS CARGA,   TO_CHAR (FECHA, 'DD/MM/YYYY  HH24:MI:SS') AS FECHA FROM ERP_FE_XML WHERE COMPANIA = '[compania]' AND HORA = '[HORA]' AND XML IN (SELECT XML FROM ERP_FE_COMPROBANTES WHERE COMPANIA = '[compania]')) ORDER BY TO_DATE(FECHA, 'DD/MM/YYYY  HH24:MI:SS') DESC
BuscaFactura=SELECT C.COMPANIA, C.NUMERO, C.FOLIO, C.SUBTOTAL, C.TOTAL,E.NOMBRE, E.RFC FROM ERP_FE_COMPROBANTES C,ERP_FE_EMISOR E WHERE E.COMPANIA = C.COMPANIA AND UPPER(E.RFC) LIKE  UPPER ('%[query]%')
BuscaErr = SELECT XML||': '||MSG AS MENSAJE FROM ERP_FE_ERR WHERE COMPANIA = '[compania]' AND ID = '[id]'

#Busca convertidor
BuscarCuentaConvertidor = select CUENTA_ALIAS from cuentas where estructura in (select estructura from companias where compania = '[compania]') and afectable = 'S' and CUENTA_ALIAS = '[cuenta_alias]' 
BuscaConvertidor = SELECT COMPANIA, ORIGEN, IDCONCGASTO, NO_CASO, NO_CASO||'-'||NOMBRE AS NOMBRE1, T_POLIZA, ACTIVO, DESCRIPCION, NOMBRE FROM ERP_CAT_CONVERTIDOR WHERE COMPANIA = '[compania]' AND (NOMBRE LIKE '%[query]%' OR upper(NOMBRE) like upper('%[query]%')) AND ORIGEN = 'X' [condicion] UNION SELECT COMPANIA, ORIGEN, IDCONCGASTO, NO_CASO, NO_CASO||'-'||NOMBRE AS NOMBRE1, T_POLIZA, ACTIVO, DESCRIPCION, NOMBRE FROM ERP_CAT_CONVERTIDOR WHERE COMPANIA = '[compania]' AND NO_CASO LIKE UPPER('%[query]%') AND ORIGEN = 'X' [condicion] 
BuscaConvertidorPagos = SELECT COMPANIA, ORIGEN, IDCONCGASTO, NO_CASO, NO_CASO||'-'||NOMBRE AS NOMBRE1, T_POLIZA, ACTIVO, DESCRIPCION, NOMBRE FROM ERP_CAT_CONVERTIDOR WHERE COMPANIA = '[compania]' AND (NOMBRE LIKE '%[query]%' OR upper(NOMBRE) like upper('%[query]%')) AND ORIGEN = 'X2' [condicion] UNION SELECT COMPANIA, ORIGEN, IDCONCGASTO, NO_CASO, NO_CASO||'-'||NOMBRE AS NOMBRE1, T_POLIZA, ACTIVO, DESCRIPCION, NOMBRE FROM ERP_CAT_CONVERTIDOR WHERE COMPANIA = '[compania]' AND NO_CASO LIKE UPPER('%[query]%') AND ORIGEN = 'X2' [condicion] 
ErpDetConvertidor = SELECT ORDEN,COMPANIA,CONCEPTO_DIOT,C_COSTOS AS CC,ORIGEN,IDCONCGASTO,NO_CASO,IDCAMPO,SEC,CUENTA,T_APLICACION,IDOPERACION,PROYECTO,PARTIDA,IDTPAGO,T_PERSONA,DESCRIPCION,REFERENCIA,REFERENCIA2, OPERACIONES, RFC FROM ERP_DET_CONVERTIDOR WHERE COMPANIA = '[compania]' AND IDCONCGASTO = '[idConGasto]' AND ORIGEN = '[origen]' AND NO_CASO = '[caso]' order by ORDEN
BuscaCuentas = select CUENTA_ALIAS, nombre as nombre from cuentas where estructura in (select estructura from companias where compania = '[compania]') and afectable = 'S' and (CUENTA_ALIAS like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%')) order by 1
BuscaDatosCopi = SELECT NOMBRE FROM ERP_CAT_CONVERTIDOR WHERE NO_CASO = '[caso]'
BuscaErpCatConvertidor = SELECT COMPANIA, ORIGEN, IDCONCGASTO, NO_CASO, T_POLIZA, ACTIVO, DESCRIPCION, NOMBRE FROM ERP_CAT_CONVERTIDOR WHERE COMPANIA = '[compania]' AND IDCONCGASTO = '[idConGasto]'
#BuscaImportesFacturas = SELECT C.SUBTOTAL AS IMPORTE , E.RFC, 'SUBTOTAL' AS NOMIMPORTE   FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND C.NUMERO = '[numero]' AND C.COMPANIA = E.COMPANIA AND C.NUMERO = E.NUMERO UNION SELECT  TOTAL AS IMPORTE, '' AS RFC, 'TOTAL' AS NOMIMPORTE  FROM ERP_FE_COMPROBANTES WHERE COMPANIA = '[compania]' AND NUMERO = '[numero]' UNION SELECT IMPORTE AS IMPORTE, '' AS RFC, 'IVA' AS NOMIMPORTE  FROM ERP_FE_IMP_TRASLADOS WHERE COMPANIA = '[compania]' AND NUMERO = '[numero]' AND IMPUESTO = 'IVA' UNION SELECT IMPORTE AS IMPORTE, '' AS RFC, 'ISR' AS NOMIMPORTE  FROM ERP_FE_IMP_RETENCIONES WHERE COMPANIA = '[compania]' AND NUMERO = '[numero]' AND IMPUESTO = 'ISR' UNION SELECT IMPORTE AS IMPORTE, '' AS RFC, 'IVA_RET' AS NOMIMPORTE  FROM ERP_FE_IMP_RETENCIONES WHERE COMPANIA = '[compania]' AND NUMERO = '[numero]' AND IMPUESTO = 'IVA'

BuscaImportesFacturas=SELECT C.SUBTOTAL AS IMPORTE , E.RFC, 'SUBTOTAL' AS NOMIMPORTE   FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND C.NUMERO = '[numero]' AND C.COMPANIA = E.COMPANIA AND C.NUMERO = E.NUMERO UNION SELECT  TOTAL AS IMPORTE, '' AS RFC, 'TOTAL' AS NOMIMPORTE  FROM ERP_FE_COMPROBANTES WHERE COMPANIA = '[compania]' AND NUMERO = '[numero]' UNION SELECT IMPORTE AS IMPORTE, '' AS RFC, 'IVA' AS NOMIMPORTE  FROM ERP_FE_IMP_TRASLADOS WHERE COMPANIA = '[compania]' AND NUMERO = '[numero]' AND IMPUESTO = (SELECT ID_IMPUESTO_SAT FROM IMPUESTOS_SAT WHERE DESCRIPCION = 'IVA' AND ROWNUM = 1) UNION SELECT IMPORTE AS IMPORTE, '' AS RFC, 'ISR' AS NOMIMPORTE  FROM ERP_FE_IMP_RETENCIONES WHERE COMPANIA = '[compania]' AND NUMERO = '[numero]' AND IMPUESTO = (SELECT ID_IMPUESTO_SAT FROM IMPUESTOS_SAT WHERE DESCRIPCION = 'ISR' AND ROWNUM = 1)  UNION SELECT IMPORTE AS IMPORTE, '' AS RFC, 'IVA_RET' AS NOMIMPORTE  FROM ERP_FE_IMP_RETENCIONES WHERE COMPANIA = '[compania]' AND NUMERO = '[numero]' AND IMPUESTO = (SELECT ID_IMPUESTO_SAT FROM IMPUESTOS_SAT WHERE DESCRIPCION = 'IVA' AND ROWNUM = 1)


BuscaDatosFactura = SELECT C.FOLIO, C.UUID, C.MONEDA, C.TIPO_CAMBIO, E.RFC AS RFC_E, R.RFC AS RFC_R FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E, ERP_FE_RECEPTOR R WHERE C.COMPANIA = '[compania]' AND C.NUMERO = '[numero]' AND C.COMPANIA = E.COMPANIA AND C.COMPANIA = R.COMPANIA AND C.NUMERO = E.NUMERO AND C.NUMERO = R.NUMERO
BuscaDatosRecordar = SELECT C.RFC_EMISOR, C.RFC_RECEPTOR, C.NOMBRE, C.T_POLIZA, D.COMPANIA, D.ORIGEN, D.IDCONCGASTO, D.NO_CASO, D.IDCAMPO, D.SEC, D.CUENTA, D.T_APLICACION, D.IDOPERACION, D.PROYECTO, D.PARTIDA, D.IDTPAGO, D.T_PERSONA, D.DESCRIPCION, D.REFERENCIA, D.OPERACIONES FROM ERP_CAT_CONVERTIDOR C,ERP_DET_CONVERTIDOR D WHERE C.COMPANIA = 'TEMP' AND C.ORIGEN = 'X' AND D.COMPANIA = C.COMPANIA AND D.ORIGEN=C.ORIGEN AND D.IDCONCGASTO = C.IDCONCGASTO AND D.NO_CASO = C.NO_CASO AND C.RFC_EMISOR = '[rfcEmisor]' AND C.RFC_RECEPTOR = '[rfcReceptor]' ORDER BY SEC
FindConceptosDiot = SELECT NOMBRE, CONCEPTO FROM CONCEPTOS_DIOT

#Informcaion de  videos 
Videos = SELECT ID, NOMBRE, DESCRIPCION, SEC, TO_CHAR(FECHA,'DD/MM/YYYY') AS FECHA,URL,URL_IMAGEN FROM ERP_AYUDA_VIDEOS
FeFeraz = SELECT DISTINCT (SELECT COMPANIA FROM COMPANIAS WHERE COMPANIA = '[compania]') as COMPANIA, F.COMPANIA AS COMPANIA_CFDI, F.ID_FACTURA , F.ID_TIPO_COMPROBANTE, F.ID_CLIENTE, F.FOLIO,((D.IVA * (select SUM(PRECIO_UNITARIO) from FE_DET_FACTURAS@CFDI where compania in (select compania_cfdi from companias where compania = '[compania]')  and id_factura = F.ID_FACTURA))/100) AS IVA, (select SUM(PRECIO_UNITARIO) from FE_DET_FACTURAS@CFDI where compania in (select compania_cfdi from companias where compania = '[compania]') and id_factura = F.ID_FACTURA) AS SUBTOTAL,((D.IVA * (select SUM(PRECIO_UNITARIO) from FE_DET_FACTURAS@CFDI where compania in (select compania_cfdi from companias where compania = '[compania]') and id_factura = F.ID_FACTURA))/100)+ (select SUM(PRECIO_UNITARIO) from FE_DET_FACTURAS@CFDI where compania in (select compania_cfdi from companias where compania = '[compania]') and id_factura = F.ID_FACTURA) AS TOTAL  FROM  FE_FACTURAS@CFDI F,FE_DET_FACTURAS@CFDI D WHERE F.COMPANIA = (SELECT COMPANIA_CFDI FROM COMPANIAS WHERE COMPANIA ='[compania]' ) AND F.CANCELADA = 'No' AND D.COMPANIA = F.COMPANIA AND D.ID_FACTURA = F.ID_FACTURA AND to_char(F.FECHA,'mm') = to_char(sysdate,'mm') AND to_char(F.FECHA,'yyyy') = to_char(sysdate,'yyyy') ORDER BY F.ID_FACTURA

#ValidaPolizaNom = SELECT NUMERO_POLIZA FROM ERP_NOM_POLIZA WHERE COMPANIA = '[compania]' AND CALENDARIO = '[calendario]' AND PERIODO = '[periodo]' AND GRUPO_PAGO = '[grupo_pago]' AND DEPARTAMENTO = '[departamento]' AND  FECHA_PAGO = TO_DATE ('[fecha_pago]','DD/MM/YYYY') AND PROCESO_ESPECIAL = '[proceso_especial]' AND CENTRO_COSTOS = '[cto_cto]' AND ESTATUS = 'GE' UNION SELECT NUMERO_POLIZA FROM ERP_NOM_POLIZA WHERE COMPANIA = '[compania]' AND CALENDARIO = '[calendario]' AND PERIODO = '[periodo]' AND GRUPO_PAGO = '[grupo_pago]' AND  FECHA_PAGO = TO_DATE ('[fecha_pago]','DD/MM/YYYY') AND CENTRO_COSTOS = '[cto_cto]' AND ESTATUS = 'GE'
ValidaPolizaNom = SELECT NUMERO_POLIZA FROM ERP_NOM_POLIZA WHERE COMPANIA = '[compania]' AND CALENDARIO = '[calendario]' AND PERIODO = '[periodo]' AND GRUPO_PAGO = '[grupo_pago]' AND DEPARTAMENTO = '[departamento]' AND  FECHA_PAGO = TO_DATE ('[fecha_pago]','DD/MM/YYYY') AND PROCESO_ESPECIAL = '[proceso_especial]' AND CENTRO_COSTOS = '[cto_cto]' AND ESTATUS = 'GE' AND EMPLEADO = '[empleado]'
#Graficas
GraficaTiposCambio=select TO_CHAR(FECHA,'DD/MM/YYYY') AS FECHA, FACTOR from ERP_PARIDAD where DIVISA_ORIGEN = 'USD' AND DIVISA_DESTINO = 'PES'  AND ROWNUM <11 AND FECHA BETWEEN SYSDATE-10 AND SYSDATE+1 ORDER BY FECHA DESC
#Plizas Descuadradas
PolizasDescuadradas=SELECT COMPANIA,NUMERO,TIPO_POLIZA , TO_CHAR(FECHA,'DD/MM/YYYY') AS FECHA,NUMERO,CARGOS, ABONOS FROM POLIZAS WHERE COMPANIA = '[compania]' AND ESTATUS = '1'
#Saldos
SaldosPeriodo=SELECT S.COMPANIA, S.CALENDARIO, S.PERIODO, S.CUENTA, S.SALDO_INICIAL, S.CARGOS, S.ABONOS, S.SALDO_FINAL, C.CUENTA_ALIAS, C.NOMBRE  FROM SALDOS S,CUENTAS C WHERE     S.COMPANIA = '[compania]' AND S.CALENDARIO = [calendario] AND S.PERIODO = [periodo] AND S.C_COSTOS IS NULL AND C.ESTRUCTURA = '[compania]' AND C.CUENTA = S.CUENTA
BuscaPeriodos = SELECT COMPANIA, TIPO, CALENDARIO, PERIODO, FECHA_INI, FECHA_FIN, ESTATUS, FECHA_REP FROM PERIODOS_CON WHERE COMPANIA='[compania]' AND CALENDARIO='[calendario]' ORDER BY PERIODO DESC
BuscaRelacion = SELECT UUID FROM ERP_POLIZASXFACTURAS WHERE COMPANIA = '[compania]' AND FOLIO = '[folio]' AND NUMERO_FE = '[numero_fe]' AND UUID = '[uuid]'
BuscaParidad = SELECT FACTOR FROM ERP_PARIDAD WHERE DIVISA_ORIGEN = '[divisaOrig]' AND DIVISA_DESTINO = '[divisaDest]' AND FECHA = TO_DATE('[fecha]','dd/mm/yyyy')
BuscaParidadCompania = SELECT FACTOR FROM ERP_PARIDAD_COMPANIA WHERE DIVISA_ORIGEN = '[divisaOrig]' AND DIVISA_DESTINO = '[divisaDest]' AND FECHA = TO_DATE('[fecha]','dd/mm/yyyy') AND COMPANIA = '-'

BuscaPeriodoRelacion = SELECT ESTATUS FROM PERIODOS_CON WHERE COMPANIA = '[compania]' AND PERIODO = '[periodo]' AND CALENDARIO = '[calendario]'  
BuscaCuentaWS = SELECT CUENTA_ALIAS FROM CUENTAS WHERE ESTRUCTURA = '[compania]' AND CUENTA_ALIAS = '[cuenta]' 
#BuscaCuentaNormalWS = select cuenta_alias,replace(cuenta_alias,'-','') as cuenta from cuentas where estructURa = '[compania]' AND replace(cuenta_alias,'-','') = '[cuenta]' 

BuscaCuentaNormalWS = SELECT CUENTA_ALIAS FROM CUENTAS WHERE ESTRUCTURA = '[compania]' AND CUENTA_ALIAS = (SELECT CUENTA_ALIAS FROM ERP_VS_SALOMON WHERE CTA_SALOMON = '[cuenta]' AND C_COSTOS = '[cto_cto]')
#BuscaCuentaN = select CUENTA from cuentas where estructura = '[compania]' AND replace(cuenta_alias,'-','') = '[cuenta]'
BuscaCuentaN = SELECT CUENTA FROM CUENTAS WHERE ESTRUCTURA = '[compania]' AND CUENTA_ALIAS = (SELECT CUENTA_ALIAS FROM ERP_VS_SALOMON WHERE CTA_SALOMON = '[cuenta]' AND C_COSTOS = '[cto_cto]')
#BuscaPeriodoWS = SELECT ESTATUS FROM PERIODOS_CON WHERE COMPANIA = '[compania]' AND PERIODO = '[periodo]' AND CALENDARIO = '[calendario]' AND ESTATUS = '0'
BuscaPeriodoWS = SELECT ESTATUS FROM PERIODOS_CON WHERE COMPANIA = '[compania]' AND  FECHA_INI <= to_date('[fecha]','dd/mm/yyyy') AND FECHA_FIN >= to_date('[fecha]','dd/mm/yyyy')  AND ESTATUS = '0'

BuscaWSTipoPoliza = SELECT TIPO_POLIZA FROM ERP_TIPOS_POLIZA_SALOMON WHERE COMPANIA = '[compania]' AND MODULO = '[modulo]' AND TRANSACCION = '[transaccion]'

BuscaNumeroRegistros = SELECT COUNT(PID) AS PID_MAX FROM ERP_NOM_POLIZA WHERE COMPANIA = '[compania]' AND PID = '[pid]'
 
BuscaPidNomina = SELECT DISTINCT ESTATUS FROM ERP_NOM_POLIZA WHERE COMPANIA = '[compania]' AND PID = '[pid]'
BuscaDatosPoliza = SELECT DISTINCT NUMERO_POLIZA, TO_CHAR(FECHA_POLIZA,'DD/MM/YYYY') AS FECHA_POLIZA, TIPO_POLIZA FROM ERP_NOM_POLIZA WHERE COMPANIA = '[compania]' AND PID = '[pid]'
BuscaErrorCancela = SELECT ERROR FROM ERP_NOM_ERROR WHERE COMPANIA = '[compania]' AND PID = '[pid]'

#DIOT

BuscaConceptos = SELECT (SELECT COMPANIA FROM COMPANIAS WHERE COMPANIA = '[compania]') as COMPANIA, C.CONCEPTO, C.NOMBRE FROM CONCEPTOS_DIOT C 
BuscaConceptosDiot = SELECT D.COMPANIA, C.CONCEPTO, C.NOMBRE, D.IMPORTE FROM CONCEPTOS_DIOT C, DET_DIOT D  WHERE D.COMPANIA = '[compania]' AND C.CONCEPTO = D.CONCEPTO AND D.CUENTA = (SELECT CUENTA FROM CUENTAS WHERE ESTRUCTURA = '[compania]' and CUENTA_ALIAS = '[cuenta]') AND D.NUMERO = '[numero]' AND D.TIPO_POLIZA = '[tipo_poliza]' AND D.FECHA = TO_DATE('[fecha]','dd/mm/yyyy')  AND D.SEC = [sec]
BuscaCuentasDiot = SELECT DISTINCT D.CUENTA FROM CONCEPTOS_DIOT C, DET_DIOT D  WHERE D.COMPANIA = '[compania]'  AND C.CONCEPTO = D.CONCEPTO AND D.CUENTA = (SELECT CUENTA FROM CUENTAS WHERE ESTRUCTURA = '[compania]' and CUENTA_ALIAS = '[cuenta]') AND D.NUMERO = '[numero]' AND D.TIPO_POLIZA = '[tipo_poliza]' AND D.FECHA = TO_DATE('[fecha]','dd/mm/yyyy')  AND D.SEC = [sec]
BuscaDetDiot = SELECT CONCEPTO FROM DET_DIOT WHERE COMPANIA = '[compania]' AND CONCEPTO = '[concepto]' AND CUENTA = (SELECT CUENTA FROM CUENTAS WHERE ESTRUCTURA = '[compania]' and CUENTA_ALIAS = '[cuenta]') AND FECHA = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND NUMERO = '[numero]' AND SEC = [sec] AND TIPO_POLIZA = '[tipoPoliza]'
#CXP
BuscaCXPCto = select distinct CTO_CTO as CTO, CTO_CTO||'-'||NOMBRE AS NOMBRE_CTO from ERP_CTO_CTO where compania = '[compania]'
FindEmpleados =  SELECT DISTINCT E.EMPLEADO AS EMPLEADO,E.EMPLEADO ||'-'|| E.NOMBRE AS NOMBRE FROM H_LABORAL@KZNNOM2 H, EMPLEADOS@KZNNOM2 E WHERE H.COMPANIA   IN ('RHVO','RHO','HVRS') AND   H.FECHA      = (SELECT MAX(HL2.FECHA) FROM H_LABORAL@KZNNOM2 HL2 WHERE HL2.COMPANIA   =  H.COMPANIA AND   HL2.EMPLEADO   =  H.EMPLEADO ) AND   H.SEC = (SELECT MAX(HL3.SEC) FROM H_LABORAL@KZNNOM2 HL3  WHERE HL3.COMPANIA   = H.COMPANIA AND HL3.EMPLEADO = H.EMPLEADO AND HL3.FECHA = H.FECHA) AND E.COMPANIA = H.COMPANIA AND E.EMPLEADO = H.EMPLEADO AND (E.EMPLEADO LIKE '%[query]%' OR upper(E.NOMBRE) like upper('%[query]%')) ORDER BY E.EMPLEADO
FindRelacionCxp = SELECT (SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND NUM_FACTURA = C.NUMERO AND NUM_DOCUMENTO = [numero]) AS IMPORTE_DOC ,(SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND NUM_DOCUMENTO = C.NUMERO AND NUM_FACTURA = [numero]) AS IMPORTE_FACT,(SELECT NUM_FACTURA FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND NUM_DOCUMENTO = C.NUMERO AND NUM_FACTURA = [numero]) AS NUM_FACTURA_REL,(SELECT SEC FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND NUM_DOCUMENTO = C.NUMERO AND NUM_FACTURA = [numero]) AS FACT_SEC_REL, (SELECT NUM_DOCUMENTO FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND NUM_FACTURA = C.NUMERO AND NUM_DOCUMENTO = [numero]) AS NUM_DOCUMENTO_REL,(SELECT SEC FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND NUM_FACTURA = C.NUMERO AND NUM_DOCUMENTO = [numero]) AS DOC_SEC_REL, E.RFC AS RFC_EMISOR_FACT, E.NOMBRE AS NOMBRE_EMISOR_FACT, C.COMPANIA AS COMPANIA_FACT, C.NUMERO AS NUMERO_FACT, C.FOLIO AS FOLIO_FACT, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_FACT,C.SALDOS_CXP AS SALDOS_CXP_FACT, C.SERIE AS SERIE_FACT, C.SUBTOTAL AS SUBTOTAL_FACT, C.TIPO_DE_COMPROBANTE AS TIPO_DE_COMPROBANTE_FACT, C.TOTAL AS TOTAL_SIN_MOV ,(CASE WHEN C.ESTATUS_CXP = 'PAR' THEN  C.TOTAL - C.PAGO_ACUMULADO_CXP ELSE C.TOTAL  END) AS TOTAL_FACT FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO  AND C.ORIGEN IN ('CP','PRTL','WS') AND (C.ESTATUS_CXP NOT IN ('TES','ET','FG') OR C.ESTATUS_CXP IS NULL) AND C.NUMERO NOT IN ([numero]) AND E.RFC = '[rfcEmisor]' AND C.TIPO_DE_COMPROBANTE = '[comprobante]' ORDER BY FACT_SEC_REL, DOC_SEC_REL
#FindRelacionCxp = SELECT (SELECT NUM_FACTURA FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND NUM_DOCUMENTO = C.NUMERO AND NUM_FACTURA = [numero]) AS NUM_FACTURA_REL,(SELECT SEC FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND NUM_DOCUMENTO = C.NUMERO AND NUM_FACTURA = [numero]) AS FACT_SEC_REL, (SELECT NUM_DOCUMENTO FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND NUM_FACTURA = C.NUMERO AND NUM_DOCUMENTO = [numero]) AS NUM_DOCUMENTO_REL,(SELECT SEC FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND NUM_FACTURA = C.NUMERO AND NUM_DOCUMENTO = [numero]) AS DOC_SEC_REL, E.RFC AS RFC_EMISOR_FACT, E.NOMBRE AS NOMBRE_EMISOR_FACT, C.COMPANIA AS COMPANIA_FACT, C.NUMERO AS NUMERO_FACT, C.FOLIO AS FOLIO_FACT, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_FACT, C.SERIE AS SERIE_FACT, C.SUBTOTAL AS SUBTOTAL_FACT, C.TOTAL AS TOTAL_FACT  FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO  AND C.ORIGEN = 'CP' AND C.NUMERO NOT IN ([numero]) AND E.RFC = '[rfcEmisor]' AND C.TIPO_DE_COMPROBANTE = '[comprobante]' ORDER BY FACT_SEC_REL, DOC_SEC_REL


#BuscaArchivosCXP = SELECT F.COMPANIA, ESTATUS_CXP, F.CONCEPTO_CXP AS CONCEPTO, F.CTO_CXP AS NOMCC,(SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS T_DISTRIBUCION , (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS PRORRATEO, TO_CHAR(F.FECHA_VENC_CXP,'DD/MM/YYYY') AS CXP_FECHA , F.NUMERO, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO, F.ORIGEN, F.XML, F.FECHA_CAP,F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA FROM ERP_FE_COMPROBANTES F WHERE F.COMPANIA = '[compania]'  AND NUMERO LIKE '%[FACTURA]%' AND ORIGEN = 'CP' ORDER BY F.FECHA DESC
#BuscaArchivosCXP = SELECT F.FOLIO_PAGOS,(SELECT  P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS TIPO_POLIZA,(SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS FECHA_POL,(SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS NUMERO_POL , F.SALDOS_CXP, F.COMPANIA, 'C' AS TIPO_CXP, '' as TIPO_GASTO,'' AS BENEFICIARIO, 0 as OTROS_IMPUESTOS, ESTATUS_CXP,  NVL((F.ESTATUSV),'2') AS ESTATUSV, F.CONCEPTO_CXP AS CONCEPTO, F.CTO_CXP AS NOMCC,(SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS T_DISTRIBUCION, (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS PRORRATEO, TO_CHAR(F.FECHA_VENC_CXP,'DD/MM/YYYY') AS CXP_FECHA, F.NUMERO, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO , F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO, F.ORIGEN, F.XML , TO_CHAR(F.FECHA_CAP,'DD/MM/YYYY') AS FECHA_CAP,F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR ,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR ,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA, '' AS DESCRIPCION_OTRAS FROM ERP_FE_COMPROBANTES F WHERE F.COMPANIA = '[compania]'  AND NUMERO LIKE '%%' AND ORIGEN = 'CP' AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) = TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(F.FECHA,'YYYY')) = TO_NUMBER('[calendario]') UNION SELECT 0 AS FOLIO_PAGOS, '' AS TIPO_POLIZA,'' AS FECHA_POL, '' AS NUMERO_POL, 999 AS SALDOS_CXP,S.COMPANIA, 'O' AS TIPO_CXP, S.TIPO_GASTO,S.BENEFICIARIO, S.OTROS_IMPUESTOS, S.ESTATUS_CXP, '3' AS ESTATUSV, S.CONCEPTO_CXP AS CONCEPTO, S.CTO_CXP AS NOMCC,(SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = S.CONCEPTO_CXP AND S.COMPANIA = C.COMPANIA) AS T_DISTRIBUCION , (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = S.CONCEPTO_CXP AND S.COMPANIA = C.COMPANIA) AS PRORRATEO, TO_CHAR(S.FECHA_VENC_CXP,'DD/MM/YYYY') AS CXP_FECHA , S.ID AS NUMERO, S.IVA AS IVA, '' AS FOLIO, '' AS FOLIO_FISCAL_ORIG, '' AS PDF, '' AS UUID, TO_CHAR (S.FECHA, 'DD/MM/YYYY') AS FECHA, NULL AS FECHA_FOLIO_FISCAL_ORIG, '' AS SERIE, '' AS SERIE_FOLIO_FISCAL_ORIG, S.IMPORTE AS SUBTOTAL, S.TOTAL AS TOTAL, S.TIPO_CAMBIO, '' AS TIPO_DE_COMPROBANTE, '' AS CONDICIONES_DE_PAGO, 0 AS DESCUENTO, '' AS FORMA_DE_PAGO, '' AS METODO_DE_PAGO, S.MONEDA AS MONEDA, 0 AS MONTO_FOLIO_FISCAL_ORIG, '' AS LUGAR_EXPEDICION, '' AS MOTIVO_DESCUENTO , '' AS NO_CERTIFICADO, '' AS NUM_CTA_PAGO, '' AS VERSION ,  '' AS IDCONCGASTO, 'CP' AS ORIGEN, '' AS XML, NULL AS FECHA_CAP,'' AS FLAG_POLIZA, '' AS DESCRIPCION, S.RFC AS RFC_EMISOR,   BENEFICIARIO AS NOMBRE_EMISOR,'' AS RFC_RECEPTOR ,'' AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =S.COMPANIA) AS RFC_COMPANIA, S.DESCRIPCION AS DESCRIPCION_OTRAS FROM ERP_CP_OTRAS S WHERE S.COMPANIA = '[compania]'  AND S.ID LIKE '%%' AND TO_NUMBER(TO_CHAR(S.FECHA,'MM')) = TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(S.FECHA,'YYYY')) = TO_NUMBER('[calendario]')  ORDER BY 1 DESC
#BuscaArchivosCXP = WITH A AS (SELECT NVL((SELECT COMPANIA FROM COMPANIA_ORDEN_COMPRA O WHERE O.COMPANIA = C.COMPANIA AND O.ESTATUS = 'A'),'N/A') AS COMPANIA FROM COMPANIAS C WHERE COMPANIA = '[compania]' ) SELECT (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = F.COMPANIA AND NUMERO_FE = F.NUMERO AND ROWNUM < 2) AS NUM_REL_OTRAS, F.FOLIO_PAGOS,(SELECT  P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS TIPO_POLIZA,(SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS FECHA_POL,(SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS NUMERO_POL , F.SALDOS_CXP, F.COMPANIA, 'C' AS TIPO_CXP, '' as TIPO_GASTO,'' AS BENEFICIARIO, 0 as OTROS_IMPUESTOS, F.ESTATUS_CXP,NVL((SELECT NOMBRE FROM ERP_ESTATUS_TESORERIA WHERE CLAVE = F.ESTATUS_CXP),'Sin Pagar') AS NOM_ESTATUS_CXP,  NVL((F.ESTATUSV),'2') AS ESTATUSV, F.CONCEPTO_CXP AS CONCEPTO, F.CTO_CXP AS NOMCC,(SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS T_DISTRIBUCION, (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS PRORRATEO, TO_CHAR(F.FECHA_VENC_CXP,'DD/MM/YYYY') AS CXP_FECHA, F.NUMERO, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO , F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO, F.ORIGEN, F.XML , TO_CHAR(F.FECHA_CAP,'DD/MM/YYYY') AS FECHA_CAP,F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR ,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR ,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA, '' AS DESCRIPCION_OTRAS FROM ERP_FE_COMPROBANTES F,ERP_FE_EMISOR E,A WHERE F.COMPANIA = '[compania]'  AND F.NUMERO LIKE '%%' AND E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND E.RFC NOT IN (SELECT C.RFC FROM ERP_INTERCOS I, COMPANIAS C, ERP_CCLIENTES L WHERE I.COMPANIA = '[compania]' AND C.COMPANIA = I.COMPANIA_INTERCO AND L.COMPANIA = I.COMPANIA AND L.RFC = C.RFC) AND F.ORIGEN in ('CP','PRTL','SATCP','WS') AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) <= TO_NUMBER('[periodoFin]') AND TO_NUMBER(TO_CHAR(F.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND F.NUMERO NOT IN (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE NUMERO_FE = F.NUMERO AND COMPANIA = F.COMPANIA) AND (CASE WHEN A.COMPANIA = F.COMPANIA AND F.NUMERO = (SELECT NUMERO_FE FROM ERP_ORDENXFACTURA WHERE COMPANIA = F.COMPANIA AND NUMERO_FE = F.NUMERO AND ESTATUS_CXP IS NOT NULL AND ESTATUS_CXP = '1' AND ORIGEN = 'FE' AND ROWNUM = 1) THEN 1 WHEN A.COMPANIA != F.COMPANIA THEN 1 ELSE 0 END) = 1 ORDER BY F.FECHA
BuscaArchivosCXP=SELECT (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = F.COMPANIA AND NUMERO_FE = F.NUMERO AND ROWNUM < 2) AS NUM_REL_OTRAS, F.FOLIO_PAGOS,(SELECT  P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS TIPO_POLIZA,(SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS FECHA_POL,(SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS NUMERO_POL , F.SALDOS_CXP, F.COMPANIA, 'C' AS TIPO_CXP, '' as TIPO_GASTO,'' AS BENEFICIARIO, 0 as OTROS_IMPUESTOS, F.ESTATUS_CXP,NVL((SELECT NOMBRE FROM ERP_ESTATUS_TESORERIA WHERE CLAVE = F.ESTATUS_CXP),'Sin Pagar') AS NOM_ESTATUS_CXP,  NVL((F.ESTATUSV),'2') AS ESTATUSV, F.CONCEPTO_CXP AS CONCEPTO, F.CTO_CXP AS NOMCC,(SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = F.COMPANIA AND C.CONCEPTO = F.CONCEPTO_CXP ) AS T_DISTRIBUCION, (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = F.COMPANIA AND C.CONCEPTO = F.CONCEPTO_CXP) AS PRORRATEO, TO_CHAR(F.FECHA_VENC_CXP,'DD/MM/YYYY') AS CXP_FECHA, F.NUMERO, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO , F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO, F.ORIGEN, F.XML , TO_CHAR(F.FECHA_CAP,'DD/MM/YYYY') AS FECHA_CAP,F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR ,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR ,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA, '' AS DESCRIPCION_OTRAS FROM ERP_FE_COMPROBANTES F,ERP_FE_EMISOR E WHERE F.COMPANIA = '[compania]'  AND F.NUMERO LIKE '%%' AND E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND E.RFC NOT IN (SELECT C.RFC FROM ERP_INTERCOS I, COMPANIAS C, ERP_CCLIENTES L WHERE I.COMPANIA = '[compania]' AND C.COMPANIA = I.COMPANIA_INTERCO AND L.COMPANIA = I.COMPANIA AND L.RFC = C.RFC) AND F.ORIGEN in ('CP','PRTL','SATCP','WS') AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) <= TO_NUMBER('[periodoFin]') AND TO_NUMBER(TO_CHAR(F.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND F.NUMERO NOT IN (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE NUMERO_FE = F.NUMERO AND COMPANIA = F.COMPANIA) AND  F.NUMERO = (SELECT NUMERO_FE FROM ERP_ORDENXFACTURA WHERE COMPANIA = F.COMPANIA AND NUMERO_FE = F.NUMERO AND ESTATUS_CXP IS NOT NULL AND ESTATUS_CXP = '1' AND ORIGEN = 'FE' AND ROWNUM = 1) UNION SELECT (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = F.COMPANIA AND NUMERO_FE = F.NUMERO AND ROWNUM < 2) AS NUM_REL_OTRAS, F.FOLIO_PAGOS,(SELECT  P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS TIPO_POLIZA,(SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS FECHA_POL,(SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS NUMERO_POL , F.SALDOS_CXP, F.COMPANIA, 'C' AS TIPO_CXP, '' as TIPO_GASTO,'' AS BENEFICIARIO, 0 as OTROS_IMPUESTOS, F.ESTATUS_CXP,NVL((SELECT NOMBRE FROM ERP_ESTATUS_TESORERIA WHERE CLAVE = F.ESTATUS_CXP),'Sin Pagar') AS NOM_ESTATUS_CXP,  NVL((F.ESTATUSV),'2') AS ESTATUSV, F.CONCEPTO_CXP AS CONCEPTO, F.CTO_CXP AS NOMCC,(SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = F.COMPANIA AND C.CONCEPTO = F.CONCEPTO_CXP ) AS T_DISTRIBUCION, (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = F.COMPANIA AND C.CONCEPTO = F.CONCEPTO_CXP) AS PRORRATEO, TO_CHAR(F.FECHA_VENC_CXP,'DD/MM/YYYY') AS CXP_FECHA, F.NUMERO, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO , F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO, F.ORIGEN, F.XML , TO_CHAR(F.FECHA_CAP,'DD/MM/YYYY') AS FECHA_CAP,F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR ,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR ,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA, '' AS DESCRIPCION_OTRAS FROM ERP_FE_COMPROBANTES F,ERP_FE_EMISOR E WHERE F.COMPANIA = '[compania]'  AND F.NUMERO LIKE '%%' AND E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND E.RFC NOT IN (SELECT C.RFC FROM ERP_INTERCOS I, COMPANIAS C, ERP_CCLIENTES L WHERE I.COMPANIA = '[compania]' AND C.COMPANIA = I.COMPANIA_INTERCO AND L.COMPANIA = I.COMPANIA AND L.RFC = C.RFC) AND F.ORIGEN in ('CP','PRTL','SATCP','WS') AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) <= TO_NUMBER('[periodoFin]') AND TO_NUMBER(TO_CHAR(F.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND F.NUMERO NOT IN (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE NUMERO_FE = F.NUMERO AND COMPANIA = F.COMPANIA) AND F.NUMERO NOT IN (SELECT NUMERO FROM ERP_ORDEN_ARCHIVOS WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO AND ORIGEN = 'FE') ORDER BY FECHA
#BuscaArchivosCXPOtros = SELECT 0 AS FOLIO_PAGOS_OTROS, '' AS TIPO_POLIZA_OTROS,'' AS FECHA_POL_OTROS, '' AS NUMERO_POL_OTROS, 999 AS SALDOS_CXP_OTROS,S.COMPANIA AS COMPANIA_OTROS, 'O' AS TIPO_CXP_OTROS, S.TIPO_GASTO AS TIPO_GASTO_OTROS,S.BENEFICIARIO AS BENEFECIARIO_OTROS, S.OTROS_IMPUESTOS AS OTROS_IMPUESTOS_OTROS, S.ESTATUS_CXP AS ESTATUS_CXP_OTROS, '3' AS ESTATUSV_OTROS, S.CONCEPTO_CXP AS CONCEPTO_OTROS, S.CTO_CXP AS NOMCC_OTROS,(SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = S.CONCEPTO_CXP AND S.COMPANIA = C.COMPANIA) AS T_DISTRIBUCION_OTROS , (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = S.CONCEPTO_CXP AND S.COMPANIA = C.COMPANIA) AS PRORRATEO_OTROS, TO_CHAR(S.FECHA_VENC_CXP,'DD/MM/YYYY') AS CXP_FECHA_OTROS , S.ID AS NUMERO_OTROS, S.IVA AS IVA_OTROS, '' AS FOLIO_OTROS, '' AS FOLIO_FISCAL_ORIG_OTROS, '' AS PDF_OTROS, '' AS UUID_OTROS, TO_CHAR (S.FECHA, 'DD/MM/YYYY') AS FECHA_OTROS, NULL AS FECHA_FOLIO_FISCAL_ORIG_OTROS, '' AS SERIE_OTROS, '' AS SERIE_FOLIO_FISCAL_ORIG_OTROS, S.IMPORTE AS SUBTOTAL_OTROS, S.TOTAL AS TOTAL_OTROS, S.TIPO_CAMBIO AS TIPO_CAMBIO_OTROS, '' AS TIPO_DE_COMPROBANTE_OTROS, '' AS CONDICIONES_DE_PAGO_OTROS, 0 AS DESCUENTO_OTROS, '' AS FORMA_DE_PAGO_OTROS, '' AS METODO_DE_PAGO_OTROS, S.MONEDA AS MONEDA_OTROS, 0 AS MONTO_FOLIO_FISCAL_ORIG_OTROS, '' AS LUGAR_EXPEDICION_OTROS, '' AS MOTIVO_DESCUENTO_OTROS , '' AS NO_CERTIFICADO_OTROS, '' AS NUM_CTA_PAGO_OTROS, '' AS VERSION_OTROS ,  '' AS IDCONCGASTO_OTROS, 'CP' AS ORIGEN_OTROS, '' AS XML_OTROS, NULL AS FECHA_CAP_OTROS,'' AS FLAG_POLIZA_OTROS, '' AS DESCRIPCION_OTROS, S.RFC AS RFC_EMISOR_OTROS,   BENEFICIARIO AS NOMBRE_EMISOR_OTROS,'' AS RFC_RECEPTOR_OTROS ,'' AS NOMBRE_RECEPTOR_OTROS,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =S.COMPANIA) AS RFC_COMPANIA_OTROS, S.DESCRIPCION AS DESCRIPCION_OTRAS_OTROS FROM ERP_CP_OTRAS S WHERE S.COMPANIA = '[compania]'  AND S.ID LIKE '%%' 
#BuscaArchivosCXPOtros = WITH A AS(SELECT NVL((SELECT COMPANIA FROM COMPANIA_ORDEN_COMPRA O WHERE O.COMPANIA = C.COMPANIA AND O.ESTATUS = 'A'),'N/A') AS COMPANIA FROM COMPANIAS C WHERE COMPANIA = '[compania]' ) SELECT S.REEMBOLSO, ( CASE WHEN (SELECT NVL (SUM (TOT_GTO_PESOS), 0) FROM VI_COMPROBACION_COMISION_GAST WHERE COMPANIA = S.COMPANIA AND COMISION = S.ID) > 0 THEN (SELECT NVL (SUM (TOT_GTO_PESOS), 0) FROM VI_COMPROBACION_COMISION_GAST WHERE COMPANIA = S.COMPANIA AND COMISION = S.ID) ELSE (SELECT NVL(SUM (C.TOTAL),0) AS TOTAL_REL FROM ERP_FE_COMPROBANTES C, ERP_CXP_FACTURASXOTRAS O WHERE O.COMPANIA = S.COMPANIA AND  NUMERO_OTRAS = S.ID AND C.NUMERO = O.NUMERO_FE AND C.COMPANIA = O.COMPANIA) END) AS TOTAL_COMPROBADO, (SELECT DISTINCT NUMERO_OTRAS FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = S.COMPANIA AND NUMERO_OTRAS = S.ID) AS NUMERO_RELACION_OTRAS,S.COMPANIA AS COMPANIA_OTROS,  S.TIPO_GASTO AS TIPO_GASTO_OTROS, (SELECT NOMBRE FROM ERP_CP_OTRAS_TIPO WHERE COMPANIA = S.COMPANIA AND TIPO = S.TIPO_GASTO) AS NOMBRE_T_GASTO_OTROS,S.BENEFICIARIO AS BENEFECIARIO_OTROS, S.OTROS_IMPUESTOS AS OTROS_IMPUESTOS_OTROS, S.ESTATUS_CXP AS ESTATUS_CXP_OTROS,  S.CONCEPTO_CXP AS CONCEPTO_OTROS, S.CTO_CXP AS NOMCC_OTROS,(SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = S.CONCEPTO_CXP AND S.COMPANIA = C.COMPANIA) AS T_DISTRIBUCION_OTROS , (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = S.CONCEPTO_CXP AND S.COMPANIA = C.COMPANIA) AS PRORRATEO_OTROS, TO_CHAR(S.FECHA_VENC_CXP,'DD/MM/YYYY') AS CXP_FECHA_OTROS , S.ID AS NUMERO_OTROS, S.IVA AS IVA_OTROS,  TO_CHAR (S.FECHA, 'DD/MM/YYYY') AS FECHA_OTROS, S.IMPORTE AS SUBTOTAL_OTROS, S.TOTAL AS TOTAL_OTROS, S.TIPO_CAMBIO AS TIPO_CAMBIO_OTROS,  S.MONEDA AS MONEDA_OTROS, 'CP' AS ORIGEN_OTROS,  S.RFC AS RFC_EMISOR_OTROS,   BENEFICIARIO AS NOMBRE_EMISOR_OTROS,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =S.COMPANIA) AS RFC_COMPANIA_OTROS, S.DESCRIPCION AS DESCRIPCION_OTRAS_OTROS , S.FACTURABLE AS FACTURABLE_OTROS FROM ERP_CP_OTRAS S,A WHERE S.COMPANIA = '[compania]'  AND S.ID LIKE '%[otros]%' AND TO_NUMBER(TO_CHAR(S.FECHA,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(S.FECHA,'MM')) <= TO_NUMBER('[periodoFinal]') AND TO_NUMBER(TO_CHAR(S.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND (CASE WHEN A.COMPANIA = S.COMPANIA AND s.ID = (SELECT NUMERO_FE FROM ERP_ORDENXFACTURA WHERE COMPANIA = S.COMPANIA AND NUMERO_FE = S.ID AND ESTATUS_CXP IS NOT NULL AND ESTATUS_CXP = '1' AND ORIGEN = 'OTR' AND ROWNUM = 1) THEN 1 WHEN A.COMPANIA != S.COMPANIA THEN 1 ELSE 0 END) = 1 ORDER BY S.ID ASC
BuscaArchivosCXPOtros=SELECT S.REEMBOLSO, ( CASE WHEN (SELECT NVL (SUM (TOT_GTO_PESOS), 0) FROM VI_COMPROBACION_COMISION_GAST WHERE COMPANIA = S.COMPANIA AND COMISION = S.ID) > 0 THEN (SELECT NVL (SUM (TOT_GTO_PESOS), 0) FROM VI_COMPROBACION_COMISION_GAST WHERE COMPANIA = S.COMPANIA AND COMISION = S.ID) ELSE (SELECT NVL(SUM (C.TOTAL),0) AS TOTAL_REL FROM ERP_FE_COMPROBANTES C, ERP_CXP_FACTURASXOTRAS O WHERE O.COMPANIA = S.COMPANIA AND  NUMERO_OTRAS = S.ID AND C.NUMERO = O.NUMERO_FE AND C.COMPANIA = O.COMPANIA) END) AS TOTAL_COMPROBADO, (SELECT DISTINCT NUMERO_OTRAS FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = S.COMPANIA AND NUMERO_OTRAS = S.ID) AS NUMERO_RELACION_OTRAS,S.COMPANIA AS COMPANIA_OTROS,  S.TIPO_GASTO AS TIPO_GASTO_OTROS, (SELECT NOMBRE FROM ERP_CP_OTRAS_TIPO WHERE COMPANIA = S.COMPANIA AND TIPO = S.TIPO_GASTO) AS NOMBRE_T_GASTO_OTROS,S.BENEFICIARIO AS BENEFECIARIO_OTROS, S.OTROS_IMPUESTOS AS OTROS_IMPUESTOS_OTROS, S.ESTATUS_CXP AS ESTATUS_CXP_OTROS,  S.CONCEPTO_CXP AS CONCEPTO_OTROS, S.CTO_CXP AS NOMCC_OTROS,(SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = S.COMPANIA AND C.CONCEPTO = S.CONCEPTO_CXP) AS T_DISTRIBUCION_OTROS , (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = S.COMPANIA AND C.CONCEPTO = S.CONCEPTO_CXP) AS PRORRATEO_OTROS, TO_CHAR(S.FECHA_VENC_CXP,'DD/MM/YYYY') AS CXP_FECHA_OTROS , S.ID AS NUMERO_OTROS, S.IVA AS IVA_OTROS,  TO_CHAR (S.FECHA, 'DD/MM/YYYY') AS FECHA_OTROS, S.IMPORTE AS SUBTOTAL_OTROS, S.TOTAL AS TOTAL_OTROS, S.TIPO_CAMBIO AS TIPO_CAMBIO_OTROS,  S.MONEDA AS MONEDA_OTROS, 'CP' AS ORIGEN_OTROS,  S.RFC AS RFC_EMISOR_OTROS,   BENEFICIARIO AS NOMBRE_EMISOR_OTROS,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =S.COMPANIA) AS RFC_COMPANIA_OTROS, S.DESCRIPCION AS DESCRIPCION_OTRAS_OTROS , S.FACTURABLE AS FACTURABLE_OTROS FROM ERP_CP_OTRAS S WHERE S.COMPANIA = '[compania]'  AND S.ID LIKE '%[otros]%' AND TO_NUMBER(TO_CHAR(S.FECHA,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(S.FECHA,'MM')) <= TO_NUMBER('[periodoFinal]') AND TO_NUMBER(TO_CHAR(S.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND S.ID = (SELECT NUMERO_FE FROM ERP_ORDENXFACTURA WHERE COMPANIA = S.COMPANIA AND NUMERO_FE = S.ID AND ESTATUS_CXP IS NOT NULL AND ESTATUS_CXP = '1' AND ORIGEN = 'OTR' AND ROWNUM = 1) UNION SELECT S.REEMBOLSO, ( CASE WHEN (SELECT NVL (SUM (TOT_GTO_PESOS), 0) FROM VI_COMPROBACION_COMISION_GAST WHERE COMPANIA = S.COMPANIA AND COMISION = S.ID) > 0 THEN (SELECT NVL (SUM (TOT_GTO_PESOS), 0) FROM VI_COMPROBACION_COMISION_GAST WHERE COMPANIA = S.COMPANIA AND COMISION = S.ID) ELSE (SELECT NVL(SUM (C.TOTAL),0) AS TOTAL_REL FROM ERP_FE_COMPROBANTES C, ERP_CXP_FACTURASXOTRAS O WHERE O.COMPANIA = S.COMPANIA AND  NUMERO_OTRAS = S.ID AND C.NUMERO = O.NUMERO_FE AND C.COMPANIA = O.COMPANIA) END) AS TOTAL_COMPROBADO, (SELECT DISTINCT NUMERO_OTRAS FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = S.COMPANIA AND NUMERO_OTRAS = S.ID) AS NUMERO_RELACION_OTRAS,S.COMPANIA AS COMPANIA_OTROS,  S.TIPO_GASTO AS TIPO_GASTO_OTROS, (SELECT NOMBRE FROM ERP_CP_OTRAS_TIPO WHERE COMPANIA = S.COMPANIA AND TIPO = S.TIPO_GASTO) AS NOMBRE_T_GASTO_OTROS,S.BENEFICIARIO AS BENEFECIARIO_OTROS, S.OTROS_IMPUESTOS AS OTROS_IMPUESTOS_OTROS, S.ESTATUS_CXP AS ESTATUS_CXP_OTROS,  S.CONCEPTO_CXP AS CONCEPTO_OTROS, S.CTO_CXP AS NOMCC_OTROS,(SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = S.COMPANIA AND C.CONCEPTO = S.CONCEPTO_CXP) AS T_DISTRIBUCION_OTROS , (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = S.COMPANIA AND C.CONCEPTO = S.CONCEPTO_CXP) AS PRORRATEO_OTROS, TO_CHAR(S.FECHA_VENC_CXP,'DD/MM/YYYY') AS CXP_FECHA_OTROS , S.ID AS NUMERO_OTROS, S.IVA AS IVA_OTROS,  TO_CHAR (S.FECHA, 'DD/MM/YYYY') AS FECHA_OTROS, S.IMPORTE AS SUBTOTAL_OTROS, S.TOTAL AS TOTAL_OTROS, S.TIPO_CAMBIO AS TIPO_CAMBIO_OTROS,  S.MONEDA AS MONEDA_OTROS, 'CP' AS ORIGEN_OTROS,  S.RFC AS RFC_EMISOR_OTROS,   BENEFICIARIO AS NOMBRE_EMISOR_OTROS,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =S.COMPANIA) AS RFC_COMPANIA_OTROS, S.DESCRIPCION AS DESCRIPCION_OTRAS_OTROS , S.FACTURABLE AS FACTURABLE_OTROS FROM ERP_CP_OTRAS S WHERE S.COMPANIA = '[compania]'  AND S.ID LIKE '%[otros]%' AND TO_NUMBER(TO_CHAR(S.FECHA,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(S.FECHA,'MM')) <= TO_NUMBER('[periodoFinal]') AND TO_NUMBER(TO_CHAR(S.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND S.ID NOT IN (SELECT NUMERO FROM ERP_ORDEN_ARCHIVOS WHERE COMPANIA = S.COMPANIA AND NUMERO = S.ID AND ORIGEN = 'OTR') ORDER BY NUMERO_OTROS ASC
BuscaArchivosCXPPagos = SELECT F.FOLIO_PAGOS,(SELECT  P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS TIPO_POLIZA,(SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS FECHA_POL,(SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS NUMERO_POL , F.SALDOS_CXP, F.COMPANIA, 'C' AS TIPO_CXP, '' as TIPO_GASTO,'' AS BENEFICIARIO, 0 as OTROS_IMPUESTOS, ESTATUS_CXP,  NVL((F.ESTATUSV),'2') AS ESTATUSV, F.CONCEPTO_CXP AS CONCEPTO, F.CTO_CXP AS NOMCC,(SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS T_DISTRIBUCION, (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS PRORRATEO, TO_CHAR(F.FECHA_VENC_CXP,'DD/MM/YYYY') AS CXP_FECHA, F.NUMERO, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO , F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO, F.ORIGEN, F.XML , TO_CHAR(F.FECHA_CAP,'DD/MM/YYYY') AS FECHA_CAP,F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR ,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR ,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA, '' AS DESCRIPCION_OTRAS FROM ERP_FE_COMPROBANTES F WHERE F.COMPANIA = '[compania]'  AND NUMERO LIKE '%%' AND ORIGEN in ('CP','PRTL') AND TO_NUMBER(TO_CHAR(F.FECHA_VENC_CXP,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(F.FECHA_VENC_CXP,'MM')) <= TO_NUMBER('[periodoFin]') AND TO_NUMBER(TO_CHAR(F.FECHA_VENC_CXP,'YYYY')) = TO_NUMBER('[calendario]') AND F.FECHA_VENC_CXP IS NOT NULL 

#BuscaArchivosCXPIntercos = WITH A AS(SELECT I.COMPANIA_INTERCO,C.RFC,I.COMPANIA FROM ERP_INTERCOS I, COMPANIAS C, ERP_CCLIENTES L WHERE I.COMPANIA = '[compania]' AND C.COMPANIA = I.COMPANIA_INTERCO AND L.COMPANIA = I.COMPANIA AND L.RFC = C.RFC), B AS (SELECT (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = F.COMPANIA AND NUMERO_FE = F.NUMERO AND ROWNUM < 2) AS NUM_REL_OTRAS, F.FOLIO_PAGOS, (SELECT P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE', 'GEN') AND ROWNUM = 1) AS TIPO_POLIZA, (SELECT TO_CHAR (P.FECHA_POL, 'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE', 'GEN') AND ROWNUM = 1) AS FECHA_POL, (SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE', 'GEN') AND ROWNUM = 1) AS NUMERO_POL, F.SALDOS_CXP, F.COMPANIA,'C' AS TIPO_CXP,'' AS TIPO_GASTO, '' AS BENEFICIARIO, 0 AS OTROS_IMPUESTOS, F.ESTATUS_CXP, NVL ( (SELECT NOMBRE FROM ERP_ESTATUS_TESORERIA WHERE CLAVE = F.ESTATUS_CXP),'Sin Pagar') AS NOM_ESTATUS_CXP, NVL ( (F.ESTATUSV), '2') AS ESTATUSV, F.CONCEPTO_CXP AS CONCEPTO, F.CTO_CXP AS NOMCC, (SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = F.COMPANIA AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS T_DISTRIBUCION, (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = F.COMPANIA AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS PRORRATEO, TO_CHAR (F.FECHA_VENC_CXP, 'DD/MM/YYYY') AS CXP_FECHA,F.NUMERO, (SELECT NVL (SUM (T.IMPORTE), 0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID,TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE,F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL,F.TOTAL, F.TIPO_CAMBIO,F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION,F.MOTIVO_DESCUENTO,F.NO_CERTIFICADO, F.NUM_CTA_PAGO,F.VERSION, F.IDCONCGASTO,F.ORIGEN, F.XML, TO_CHAR (F.FECHA_CAP, 'DD/MM/YYYY') AS FECHA_CAP,F.FLAG_POLIZA,(SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO = F.NUMERO AND ROWNUM = 1) AS DESCRIPCION, (SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_EMISOR, (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_EMISOR, (SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO)  AS RFC_RECEPTOR,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR, (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) AS RFC_COMPANIA, '' AS DESCRIPCION_OTRAS FROM ERP_FE_COMPROBANTES F, A,ERP_FE_EMISOR E WHERE F.COMPANIA = A.COMPANIA AND E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND E.RFC = A.RFC AND F.NUMERO LIKE '%%' AND TO_NUMBER (TO_CHAR (F.FECHA, 'MM')) >= TO_NUMBER ('[periodo]') AND TO_NUMBER (TO_CHAR (F.FECHA, 'MM')) <= TO_NUMBER ('[periodoFin]') AND TO_NUMBER (TO_CHAR (F.FECHA, 'YYYY')) = TO_NUMBER ('[calendario]') AND F.NUMERO NOT IN (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE NUMERO_FE = F.NUMERO AND COMPANIA = F.COMPANIA) ORDER BY F.FECHA) SELECT * FROM B

BuscaArchivosCXPIntercos = SELECT (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = F.COMPANIA AND NUMERO_FE = F.NUMERO AND ROWNUM < 2) AS NUM_REL_OTRAS, F.FOLIO_PAGOS, (SELECT P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE', 'GEN') AND ROWNUM = 1) AS TIPO_POLIZA, (SELECT TO_CHAR (P.FECHA_POL, 'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE', 'GEN') AND ROWNUM = 1) AS FECHA_POL, (SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE', 'GEN') AND ROWNUM = 1) AS NUMERO_POL, F.SALDOS_CXP, F.COMPANIA,'C' AS TIPO_CXP,'' AS TIPO_GASTO, '' AS BENEFICIARIO, 0 AS OTROS_IMPUESTOS, F.ESTATUS_CXP, NVL ( (SELECT NOMBRE FROM ERP_ESTATUS_TESORERIA WHERE CLAVE = F.ESTATUS_CXP),'Sin Pagar') AS NOM_ESTATUS_CXP, NVL ( (F.ESTATUSV), '2') AS ESTATUSV, F.CONCEPTO_CXP AS CONCEPTO, F.CTO_CXP AS NOMCC, (SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = F.COMPANIA AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS T_DISTRIBUCION, (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = F.COMPANIA AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS PRORRATEO, TO_CHAR (F.FECHA_VENC_CXP, 'DD/MM/YYYY') AS CXP_FECHA,F.NUMERO, (SELECT NVL (SUM (T.IMPORTE), 0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID,TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE,F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL,F.TOTAL, F.TIPO_CAMBIO,F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION,F.MOTIVO_DESCUENTO,F.NO_CERTIFICADO, F.NUM_CTA_PAGO,F.VERSION, F.IDCONCGASTO,F.ORIGEN, F.XML, TO_CHAR (F.FECHA_CAP, 'DD/MM/YYYY') AS FECHA_CAP,F.FLAG_POLIZA,(SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO = F.NUMERO AND ROWNUM = 1) AS DESCRIPCION, (SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_EMISOR, (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_EMISOR, (SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO)  AS RFC_RECEPTOR,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR, (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) AS RFC_COMPANIA, '' AS DESCRIPCION_OTRAS FROM ERP_FE_COMPROBANTES F, ERP_FE_EMISOR E WHERE F.COMPANIA = (SELECT DISTINCT I.COMPANIA FROM ERP_INTERCOS I, COMPANIAS C, ERP_CCLIENTES L WHERE I.COMPANIA = F.COMPANIA AND C.COMPANIA = I.COMPANIA_INTERCO AND L.COMPANIA = I.COMPANIA AND L.RFC = C.RFC) AND E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND E.RFC IN (SELECT C.RFC FROM ERP_INTERCOS I, COMPANIAS C, ERP_CCLIENTES L WHERE I.COMPANIA = F.COMPANIA AND C.COMPANIA = I.COMPANIA_INTERCO AND L.COMPANIA = I.COMPANIA AND L.RFC = C.RFC) AND F.NUMERO LIKE '%%' AND TO_NUMBER (TO_CHAR (F.FECHA, 'MM')) >= TO_NUMBER ('[periodo]') AND TO_NUMBER (TO_CHAR (F.FECHA, 'MM')) <= TO_NUMBER ('[periodoFin]') AND TO_NUMBER (TO_CHAR (F.FECHA, 'YYYY')) = TO_NUMBER ('[calendario]') AND F.NUMERO NOT IN (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE NUMERO_FE = F.NUMERO AND COMPANIA = F.COMPANIA) ORDER BY F.FECHA

BuscaArchivosCXPIntercosP=SELECT (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = F.COMPANIA AND NUMERO_FE = F.NUMERO AND ROWNUM < 2) AS NUM_REL_OTRAS, F.FOLIO_PAGOS, (SELECT P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE', 'GEN') AND ROWNUM = 1) AS TIPO_POLIZA, (SELECT TO_CHAR (P.FECHA_POL, 'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE', 'GEN') AND ROWNUM = 1) AS FECHA_POL, (SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE', 'GEN') AND ROWNUM = 1) AS NUMERO_POL, F.SALDOS_CXP, F.COMPANIA,'C' AS TIPO_CXP,'' AS TIPO_GASTO, '' AS BENEFICIARIO, 0 AS OTROS_IMPUESTOS, F.ESTATUS_CXP, NVL ( (SELECT NOMBRE FROM ERP_ESTATUS_TESORERIA WHERE CLAVE = F.ESTATUS_CXP),'Sin Pagar') AS NOM_ESTATUS_CXP, NVL ( (F.ESTATUSV), '2') AS ESTATUSV, F.CONCEPTO_CXP AS CONCEPTO, F.CTO_CXP AS NOMCC, (SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = F.COMPANIA AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS T_DISTRIBUCION, (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = F.COMPANIA AND C.CONCEPTO = F.CONCEPTO_CXP AND F.COMPANIA = C.COMPANIA) AS PRORRATEO, TO_CHAR (F.FECHA_VENC_CXP, 'DD/MM/YYYY') AS CXP_FECHA,F.NUMERO, (SELECT NVL (SUM (T.IMPORTE), 0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID,TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE,F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL,F.TOTAL, F.TIPO_CAMBIO,F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION,F.MOTIVO_DESCUENTO,F.NO_CERTIFICADO, F.NUM_CTA_PAGO,F.VERSION, F.IDCONCGASTO,F.ORIGEN, F.XML, TO_CHAR (F.FECHA_CAP, 'DD/MM/YYYY') AS FECHA_CAP,F.FLAG_POLIZA,(SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO = F.NUMERO AND ROWNUM = 1) AS DESCRIPCION, (SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_EMISOR, (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_EMISOR, (SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO)  AS RFC_RECEPTOR,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR, (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) AS RFC_COMPANIA, '' AS DESCRIPCION_OTRAS FROM ERP_FE_COMPROBANTES F, ERP_FE_EMISOR E WHERE F.COMPANIA = (SELECT DISTINCT I.COMPANIA FROM ERP_INTERCOS I, COMPANIAS C, ERP_CCLIENTES L WHERE I.COMPANIA = '[compania]' AND C.COMPANIA = I.COMPANIA_INTERCO AND L.COMPANIA = I.COMPANIA AND L.RFC = C.RFC) AND E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND E.RFC IN (SELECT C.RFC FROM ERP_INTERCOS I, COMPANIAS C, ERP_CCLIENTES L WHERE I.COMPANIA = '[compania]' AND C.COMPANIA = I.COMPANIA_INTERCO AND L.COMPANIA = I.COMPANIA AND L.RFC = C.RFC) AND F.NUMERO LIKE '%%' AND TO_NUMBER (TO_CHAR (F.FECHA, 'MM')) >= TO_NUMBER ('[periodo]') AND TO_NUMBER (TO_CHAR (F.FECHA, 'MM')) <= TO_NUMBER ('[periodoFin]') AND TO_NUMBER (TO_CHAR (F.FECHA, 'YYYY')) = TO_NUMBER ('[calendario]') AND F.NUMERO NOT IN (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE NUMERO_FE = F.NUMERO AND COMPANIA = F.COMPANIA) ORDER BY F.FECHA

BuscaDatosCancelacion=SELECT COMPANIA,NUMERO,UUID,ESTATUS_CXP FROM ERP_FE_COMPROBANTES WHERE COMPANIA = '[companiaC]' and UUID = '[uuidC]'

BuscaArchivosCXPOtrosEmpleado= SELECT (SELECT DISTINCT NUMERO_OTRAS FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = S.COMPANIA AND NUMERO_OTRAS = S.ID) AS NUMERO_RELACION_OTRAS,S.COMPANIA AS COMPANIA_OTROS,  S.TIPO_GASTO AS TIPO_GASTO_OTROS, (SELECT NOMBRE FROM ERP_CP_OTRAS_TIPO WHERE COMPANIA = S.COMPANIA AND TIPO = S.TIPO_GASTO) AS NOMBRE_T_GASTO_OTROS,S.BENEFICIARIO AS BENEFECIARIO_OTROS, S.OTROS_IMPUESTOS AS OTROS_IMPUESTOS_OTROS, S.ESTATUS_CXP AS ESTATUS_CXP_OTROS,  S.CONCEPTO_CXP AS CONCEPTO_OTROS, S.CTO_CXP AS NOMCC_OTROS,(SELECT C.T_DISTRIBUCION FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = S.CONCEPTO_CXP AND S.COMPANIA = C.COMPANIA) AS T_DISTRIBUCION_OTROS , (SELECT C.COLUMNA_PRORRATEO FROM ERP_CP_CONC_PAGO C WHERE C.COMPANIA = '[compania]' AND C.CONCEPTO = S.CONCEPTO_CXP AND S.COMPANIA = C.COMPANIA) AS PRORRATEO_OTROS, TO_CHAR(S.FECHA_VENC_CXP,'DD/MM/YYYY') AS CXP_FECHA_OTROS , S.ID AS NUMERO_OTROS, S.IVA AS IVA_OTROS,  TO_CHAR (S.FECHA, 'DD/MM/YYYY') AS FECHA_OTROS, S.IMPORTE AS SUBTOTAL_OTROS, S.TOTAL AS TOTAL_OTROS, S.TIPO_CAMBIO AS TIPO_CAMBIO_OTROS,  S.MONEDA AS MONEDA_OTROS, 'CP' AS ORIGEN_OTROS,  S.RFC AS RFC_EMISOR_OTROS,   BENEFICIARIO AS NOMBRE_EMISOR_OTROS,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =S.COMPANIA) AS RFC_COMPANIA_OTROS, S.DESCRIPCION AS DESCRIPCION_OTRAS_OTROS , S.FACTURABLE AS FACTURABLE_OTROS FROM ERP_CP_OTRAS S WHERE S.COMPANIA = '[compania]'  AND S.ID LIKE '%[otros]%' AND TO_NUMBER(TO_CHAR(S.FECHA,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(S.FECHA,'MM')) <= TO_NUMBER('[periodoFinal]') AND TO_NUMBER(TO_CHAR(S.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND S.RFC = (SELECT RFC FROM EMPLEADOS@KZNNOM2 WHERE COMPANIA IN ('RHO','HVRS') AND EMPLEADO = '[usuario]' AND ROWNUM = 1)  ORDER BY S.ID ASC

BuscaConceptoCXP = SELECT CONCEPTO, CONCEPTO || '-' || NOMBRE AS NOMBRE_CONCEPTO FROM ERP_CP_CONC_PAGO WHERE COMPANIA = '[compania]' order by concepto
BuscaGridConceptoCxp = SELECT COMPANIA AS COMPANIA_CONC, CONCEPTO AS CONCEPTO_CONC, NOMBRE AS NOMBRE_CONC, CUENTA AS CUENTA_CONC FROM ERP_CP_CONC_PAGO WHERE COMPANIA = '[compania]' AND UPPER(NOMBRE) LIKE RTRIM(UPPER('%[query]%'))
BuscaCCCxp = SELECT COMPANIA AS COMPANIA_CC, CTO_CTO AS CTO_CTO_CC, NOMBRE AS NOMBRE_CC FROM ERP_CTO_CTO WHERE COMPANIA = '[compania]' AND UPPER(NOMBRE) LIKE RTRIM(UPPER('%[query]%'))

PolizasFE_Cuentas =select CUENTA_ALIAS,cuenta, nombre as nombre from cuentas where estructura in (select estructura from companias where compania = '[compania]') and afectable = 'S' and (cuenta_ALIAS like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%')) 
BuscaTipoGasto = SELECT TIPO, NOMBRE , TIPO ||'-'||NOMBRE AS NOMBRE1 FROM ERP_CP_OTRAS_TIPO WHERE COMPANIA = '[compania]' AND ESTATUS = 'A'
BuscaDivisaCXP = SELECT CODIGO, MONEDA, CODIGO ||'-'|| MONEDA AS NOMBRE FROM ERP_SAT_MONEDAS WHERE (UPPER(CODIGO) LIKE UPPER('%[query]%') OR UPPER(MONEDA) LIKE UPPER('%[query]%'))

BuscaCuentaDiot = SELECT CUENTA FROM CUENTAS WHERE ESTRUCTURA = '[compania]' and CUENTA_ALIAS = '[cuenta]'

#RELACION DE POLIZAS CON MULTIPLES ARCHICVOS

BuscaFE=SELECT F.COMPANIA, F.NUMERO AS NUMERO_FE, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO,  (SELECT CON.NO_CASO||'-'||CON.NOMBRE FROM ERP_CAT_CONVERTIDOR CON WHERE CON.COMPANIA = F.COMPANIA AND TO_CHAR(CON.NO_CASO)= F.IDCONCGASTO AND ORIGEN = 'X') AS NOMIDCONCGASTO, F.ORIGEN, (SELECT  P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS TIPO_POLIZA, (SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND P.NUMERO_POL = '[numeroPol]' AND P.TIPO_POL = '[tipoPol]' AND FECHA_POL = TO_DATE('[fechaPol]','dd/mm/yyyy') AND ROWNUM = 1) AS NUMERO_POL, (SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS FECHA_POL, F.XML, F.FECHA_CAP,F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA FROM ERP_FE_COMPROBANTES F WHERE F.COMPANIA = '[compania]'  AND NUMERO LIKE '%[FACTURA]%' ORDER BY NUMERO_POL, FECHA_POL, F.FECHA DESC
BuscaFEPagos=SELECT F.COMPANIA, F.NUMERO AS NUMERO_FE, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO,  (SELECT CON.NO_CASO||'-'||CON.NOMBRE FROM ERP_CAT_CONVERTIDOR CON WHERE CON.COMPANIA = F.COMPANIA AND TO_CHAR(CON.NO_CASO)= F.IDCONCGASTO AND ORIGEN = 'X') AS NOMIDCONCGASTO, F.ORIGEN, (SELECT  P.TIPO_POL FROM ERP_POLIZASXPAGOS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS TIPO_POLIZA, (SELECT P.NUMERO_POL FROM ERP_POLIZASXPAGOS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND P.NUMERO_POL = '[numeroPol]' AND P.TIPO_POL = '[tipoPol]' AND FECHA_POL = TO_DATE('[fechaPol]','dd/mm/yyyy') AND ROWNUM = 1) AS NUMERO_POL, (SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXPAGOS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS FECHA_POL, F.XML, F.FECHA_CAP,F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA FROM ERP_FE_COMPROBANTES F WHERE F.COMPANIA = '[compania]'  AND NUMERO LIKE '%[FACTURA]%' ORDER BY NUMERO_POL, FECHA_POL, F.FECHA DESC


BuscaQuitarFE = SELECT F.COMPANIA, F.NUMERO AS NUMERO_FE, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO,  (SELECT CON.NO_CASO||'-'||CON.NOMBRE FROM ERP_CAT_CONVERTIDOR CON WHERE CON.COMPANIA = F.COMPANIA AND TO_CHAR(CON.NO_CASO)= F.IDCONCGASTO AND ORIGEN = 'X') AS NOMIDCONCGASTO, F.ORIGEN, (SELECT  P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS TIPO_POLIZA, (SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND P.NUMERO_POL = '[numeroPol]' AND P.TIPO_POL = '[tipoPol]' AND FECHA_POL = TO_DATE('[fechaPol]','dd/mm/yyyy') AND ROWNUM = 1) AS NUMERO_POL, (SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS FECHA_POL, F.XML, F.FECHA_CAP,F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA FROM ERP_FE_COMPROBANTES F, ERP_POLIZASXFACTURAS S WHERE F.COMPANIA = '[compania]'  AND F.NUMERO LIKE '%[FACTURA]%' AND S.COMPANIA = F.COMPANIA AND S.NUMERO_FE = F.NUMERO AND S.UUID = F.UUID AND S.NUMERO_POL = '[numeroPol]' and S.FECHA_POL = TO_DATE('[fechaPol]','dd/mm/yyyy') and S.TIPO_POL = '[tipoPol]' ORDER BY F.FECHA_POL, F.FECHA DESC
BuscaQuitarFEPagos = SELECT F.COMPANIA, F.NUMERO AS NUMERO_FE, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO,  (SELECT CON.NO_CASO||'-'||CON.NOMBRE FROM ERP_CAT_CONVERTIDOR CON WHERE CON.COMPANIA = F.COMPANIA AND TO_CHAR(CON.NO_CASO)= F.IDCONCGASTO AND ORIGEN = 'X') AS NOMIDCONCGASTO, F.ORIGEN, (SELECT  P.TIPO_POL FROM ERP_POLIZASXPAGOS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS TIPO_POLIZA, (SELECT P.NUMERO_POL FROM ERP_POLIZASXPAGOS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND P.NUMERO_POL = '[numeroPol]' AND P.TIPO_POL = '[tipoPol]' AND FECHA_POL = TO_DATE('[fechaPol]','dd/mm/yyyy') AND ROWNUM = 1) AS NUMERO_POL, (SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXPAGOS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION IN ('GE','GEN') AND ROWNUM = 1) AS FECHA_POL, F.XML, F.FECHA_CAP,F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA FROM ERP_FE_COMPROBANTES F, ERP_POLIZASXPAGOS S WHERE F.COMPANIA = '[compania]'  AND F.NUMERO LIKE '%[FACTURA]%' AND S.COMPANIA = F.COMPANIA AND S.NUMERO_FE = F.NUMERO AND S.UUID = F.UUID AND S.NUMERO_POL = '[numeroPol]' and S.FECHA_POL = TO_DATE('[fechaPol]','dd/mm/yyyy') and S.TIPO_POL = '[tipoPol]' ORDER BY F.FECHA_POL, F.FECHA DESC

#Cuentas

#BuscaCuentasGrid = SELECT C.ID, C.BANCO, C.ESTRUCTURA, C.CUENTA_PADRE, C.CUENTA, C.NOMBRE, C.AFECTABLE, C.CIERRE, C.ESTATUS, C.NATURALEZA, C.CLAVE_PRESUP, C.TIPO, C.MAYOR, C.CTA_COMPLEMENTARIA, C.DIVISA, C.CUENTA_SAT, C.CUENTA_ALIAS, (SELECT CUENTA FROM SALDOS WHERE COMPANIA = '[compania]' AND CUENTA = C.CUENTA AND ROWNUM = 1) AS SALDO, (SELECT SUM(SALDO_FINAL) FROM SALDOS WHERE COMPANIA = '[compania]' AND CUENTA = C.CUENTA) AS SALDO_NUM, (SELECT CUENTA FROM DET_POLIZAS WHERE COMPANIA = '[compania]' AND CUENTA = C.CUENTA AND ROWNUM = 1) AS DET_POLIZA  from cuentas C where C.estructura in (select estructura from companias where compania = '[compania]') and (C.CUENTA_ALIAS like RTRIM('[cuenta]%') OR upper(C.NOMBRE) like upper('%[cuenta]%')) order by C.cuenta
#BuscaCuentasGrid = SELECT (SELECT ORIGEN FROM ESTRUCTURAS WHERE ESTRUCTURA = C.ESTRUCTURA) AS ORIGEN, C.ID, C.ID_ORD_BALANZA, C.BANCO, C.ESTRUCTURA, C.CUENTA_PADRE,(SELECT CS.CUENTA_ALIAS||'-'|| CS.NOMBRE FROM CUENTAS CS WHERE CS.ESTRUCTURA = C.ESTRUCTURA AND CS.CUENTA =C.CUENTA_PADRE) CUENTA_PADRE_NOMBRE, C.CUENTA, C.NOMBRE, C.AFECTABLE, C.CIERRE, C.ESTATUS, C.NATURALEZA, C.CLAVE_PRESUP, C.TIPO, C.MAYOR, C.CTA_COMPLEMENTARIA, C.DIVISA, C.CUENTA_SAT, C.CUENTA_ALIAS, (SELECT CUENTA FROM SALDOS WHERE COMPANIA = '[compania]' AND CUENTA = C.CUENTA AND ROWNUM = 1) AS SALDO, (SELECT SALDO_FINAL FROM SALDOS WHERE COMPANIA = '[compania]' AND CUENTA = C.CUENTA AND TIPO='CON' AND SALDO_FINAL <> 0 AND C_COSTOS IS NULL AND ROWNUM = 1) AS SALDO_NUM, (SELECT CUENTA FROM DET_POLIZAS WHERE COMPANIA = '[compania]' AND CUENTA = C.CUENTA AND ROWNUM = 1) AS DET_POLIZA  from cuentas C where C.estructura = '[compania]' and (C.CUENTA_ALIAS like RTRIM('[cuenta]%') OR upper(C.NOMBRE) like upper('%[cuenta]%')) order by C.cuenta
BuscaCuentasGrid = SELECT (SELECT ORIGEN FROM ESTRUCTURAS WHERE ESTRUCTURA = C.ESTRUCTURA) AS ORIGEN, C.ID, C.ID_ORD_BALANZA, C.BANCO,(SELECT F.BANCO || '-' || F.NOMBRE FROM ERP_SAT_BANCOS B, ERP_CAT_BANCO F WHERE     F.BANCO_SAT = B.CLAVE AND F.COMPANIA = C.ESTRUCTURA AND F.ESTATUS = '0' AND F.BANCO = C.BANCO) AS BANCO_NOM,C.ESTRUCTURA, C.CUENTA_PADRE,(SELECT CS.CUENTA_ALIAS||'-'|| CS.NOMBRE FROM CUENTAS CS WHERE CS.ESTRUCTURA = C.ESTRUCTURA AND CS.CUENTA =C.CUENTA_PADRE) CUENTA_PADRE_NOMBRE, C.CUENTA, C.NOMBRE, C.AFECTABLE, C.CIERRE, C.ESTATUS, C.NATURALEZA, C.CLAVE_PRESUP, C.TIPO, C.MAYOR, C.CTA_COMPLEMENTARIA, C.DIVISA, C.CUENTA_SAT, C.CUENTA_ALIAS, (SELECT CUENTA FROM SALDOS WHERE COMPANIA = '[compania]' AND CUENTA = C.CUENTA AND ROWNUM = 1) AS SALDO, (SELECT SALDO_FINAL FROM SALDOS WHERE COMPANIA = '[compania]' AND CUENTA = C.CUENTA AND TIPO='CON' AND SALDO_FINAL <> 0 AND C_COSTOS IS NULL AND ROWNUM = 1) AS SALDO_NUM, (SELECT CUENTA FROM DET_POLIZAS WHERE COMPANIA = '[compania]' AND CUENTA = C.CUENTA AND ROWNUM = 1) AS DET_POLIZA  from cuentas C where C.estructura = '[compania]' and (C.CUENTA_ALIAS like RTRIM('[cuenta]%') OR upper(C.NOMBRE) like upper('%[cuenta]%')) order by C.cuenta
#BuscaCuentasGrid2= SELECT (SELECT ORIGEN FROM ESTRUCTURAS WHERE ESTRUCTURA = C.ESTRUCTURA) AS ORIGEN, C.ID, C.ID_ORD_BALANZA, C.BANCO,(SELECT B.CLAVE ||'-'|| C.NOMBRE AS NOMBRE1 FROM ERP_SAT_BANCOS B, ERP_CAT_BANCO F  WHERE F.BANCO_SAT = B.CLAVE AND F.COMPANIA = C.ESTRUCTURA AND F.ESTATUS = '0' AND  B.CLAVE = C.BANCO) AS BANCO_NOM, C.ESTRUCTURA, C.CUENTA_PADRE,(SELECT CS.CUENTA_ALIAS||'-'|| CS.NOMBRE FROM CUENTAS CS WHERE CS.ESTRUCTURA = C.ESTRUCTURA AND CS.CUENTA =C.CUENTA_PADRE) CUENTA_PADRE_NOMBRE, C.CUENTA, C.NOMBRE, C.AFECTABLE, C.CIERRE, C.ESTATUS, C.NATURALEZA, C.CLAVE_PRESUP, C.TIPO, C.MAYOR, C.CTA_COMPLEMENTARIA,(SELECT CS.CUENTA_ALIAS||'-'|| CS.NOMBRE FROM CUENTAS CS WHERE CS.ESTRUCTURA = C.ESTRUCTURA AND CS.CUENTA =C.CTA_COMPLEMENTARIA) AS CTA_COMPL_NOM, C.DIVISA,(SELECT CODIGO ||'-'|| MONEDA AS NOMBRE FROM ERP_SAT_MONEDAS WHERE CODIGO = C.DIVISA) AS NOM_DIVISA, C.CUENTA_SAT,(SELECT  CODIGO_AGRUPADOR ||'-'||NOMBRE AS NOMBRE1 FROM ERP_SAT_CUENTAS WHERE  CODIGO_AGRUPADOR = C.CUENTA_SAT) AS CUENTA_SAT_NOM, C.CUENTA_ALIAS, (SELECT CUENTA FROM SALDOS WHERE COMPANIA = C.ESTRUCTURA AND CUENTA = C.CUENTA AND ROWNUM = 1) AS SALDO, (SELECT SALDO_FINAL FROM SALDOS WHERE COMPANIA = C.ESTRUCTURA AND CUENTA = C.CUENTA AND TIPO='CON' AND SALDO_FINAL <> 0 AND C_COSTOS IS NULL AND ROWNUM = 1) AS SALDO_NUM, (SELECT CUENTA FROM DET_POLIZAS WHERE COMPANIA = C.ESTRUCTURA AND CUENTA = C.CUENTA AND ROWNUM = 1) AS DET_POLIZA  from cuentas C where C.estructura = '[compania]' and (C.CUENTA_ALIAS like RTRIM('[cuenta]%') OR upper(C.NOMBRE) like upper('%[cuenta]%')) [order]  
BuscaCuentasGrid2= SELECT (SELECT ORIGEN FROM ESTRUCTURAS WHERE ESTRUCTURA = C.ESTRUCTURA) AS ORIGEN, C.ID, C.ID_ORD_BALANZA, C.BANCO,(SELECT F.BANCO || '-' || F.NOMBRE FROM ERP_SAT_BANCOS B, ERP_CAT_BANCO F WHERE     F.BANCO_SAT = B.CLAVE AND F.COMPANIA = C.ESTRUCTURA AND F.ESTATUS = '0' AND F.BANCO = C.BANCO) AS BANCO_NOM,C.ESTRUCTURA, C.CUENTA_PADRE,(SELECT CS.CUENTA_ALIAS||'-'|| CS.NOMBRE FROM CUENTAS CS WHERE CS.ESTRUCTURA = C.ESTRUCTURA AND CS.CUENTA =C.CUENTA_PADRE) CUENTA_PADRE_NOMBRE, C.CUENTA, C.NOMBRE, C.AFECTABLE, C.CIERRE, C.ESTATUS, C.NATURALEZA, C.CLAVE_PRESUP, C.TIPO, C.MAYOR, C.CTA_COMPLEMENTARIA,(SELECT CS.CUENTA_ALIAS||'-'|| CS.NOMBRE FROM CUENTAS CS WHERE CS.ESTRUCTURA = C.ESTRUCTURA AND CS.CUENTA =C.CTA_COMPLEMENTARIA) AS CTA_COMPL_NOM, C.DIVISA,(SELECT CODIGO ||'-'|| MONEDA AS NOMBRE FROM ERP_SAT_MONEDAS WHERE CODIGO = C.DIVISA) AS NOM_DIVISA, C.CUENTA_SAT,(SELECT  CODIGO_AGRUPADOR ||'-'||NOMBRE AS NOMBRE1 FROM ERP_SAT_CUENTAS WHERE  CODIGO_AGRUPADOR = C.CUENTA_SAT) AS CUENTA_SAT_NOM, C.CUENTA_ALIAS, (SELECT CUENTA FROM SALDOS WHERE COMPANIA = C.ESTRUCTURA AND CUENTA = C.CUENTA AND ROWNUM = 1) AS SALDO, (SELECT SALDO_FINAL FROM SALDOS WHERE COMPANIA = C.ESTRUCTURA AND CUENTA = C.CUENTA AND TIPO='CON' AND SALDO_FINAL <> 0 AND C_COSTOS IS NULL AND ROWNUM = 1) AS SALDO_NUM, (SELECT CUENTA FROM DET_POLIZAS WHERE COMPANIA = C.ESTRUCTURA AND CUENTA = C.CUENTA AND ROWNUM = 1) AS DET_POLIZA  from cuentas C where C.estructura = '[compania]' and (C.CUENTA_ALIAS like RTRIM('[cuenta]%') OR upper(C.NOMBRE) like upper('%[cuenta]%')) [order]  
BuscaCuentaPadre = SELECT  CUENTA AS CUENTA_PADRE, CUENTA_ALIAS FROM CUENTAS WHERE ESTRUCTURA = '[compania]' AND CUENTA = (SELECT  SUBSTR (S.CUENTA, 1,  LENGTH (S.CUENTA) - 7) FROM CUENTAS S WHERE ESTRUCTURA = '[compania]' AND S.CUENTA = '[cuenta]') 
BuscaCuentaPadreID = SELECT  CUENTA AS CUENTA_PADRE FROM CUENTAS WHERE ESTRUCTURA = '[compania]' AND CUENTA = (SELECT  SUBSTR (S.CUENTA, 1,  LENGTH (S.CUENTA) - 7) FROM CUENTAS S WHERE ESTRUCTURA = '[compania]' AND S.ID = '[id]') 
#BuscaMaxCtaTitulo = SELECT TO_NUMBER(MAX(SUBSTR (CUENTA, 1,  instr(CUENTA||'-', '-', 1) - 1))) AS CUENTA_TITULO FROM CUENTAS WHERE ESTRUCTURA = '[compania]'
BuscaMaxCtaTitulo = SELECT SUBSTR ('000000', 1,  6 - LENGTH (TO_CHAR (NVL(MAX(CUENTA),0)+1)) )||TO_CHAR (NVL(MAX(CUENTA),0)+1) AS CUENTA_TITULO FROM CUENTAS WHERE LENGTH (CUENTA) <= 6 AND ESTRUCTURA = '[compania]'
BuscaNumCuentas = SELECT COUNT(CUENTA) AS NUM_CUENTA FROM CUENTAS WHERE ESTRUCTURA = '[compania]'
BuscaCuentaSat = SELECT CODIGO_AGRUPADOR, NOMBRE, CODIGO_AGRUPADOR ||'-'||NOMBRE AS NOMBRE1 FROM ERP_SAT_CUENTAS WHERE  CODIGO_AGRUPADOR like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%') order by CODIGO_AGRUPADOR
BuscaMonedaSat = SELECT CODIGO, MONEDA, CODIGO ||'-'|| MONEDA AS NOMBRE FROM ERP_SAT_MONEDAS WHERE CODIGO like RTRIM('[query]%') OR upper(MONEDA) like upper('%[query]%')
#BuscaBancoSat = SELECT CLAVE, NOMBRE, CLAVE ||'-'|| NOMBRE AS NOMBRE1 FROM ERP_SAT_BANCOS WHERE CLAVE like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%')
#BuscaBancoSat = SELECT B.CLAVE, B.NOMBRE, B.CLAVE ||'-'|| B.NOMBRE AS NOMBRE1 FROM ERP_SAT_BANCOS B WHERE B.CLAVE IN (SELECT BANCO FROM CUENTAS WHERE ESTRUCTURA = '[compania]' AND (BANCO like RTRIM('[query]%') OR B.NOMBRE like RTRIM('[query]%') ))
BuscaBancoSat = SELECT C.BANCO, C.CUENTA_BANCO, B.CLAVE, C.NOMBRE, C.BANCO ||'-'|| C.NOMBRE AS NOMBRE1 FROM ERP_SAT_BANCOS B, ERP_CAT_BANCO C  WHERE C.BANCO_SAT = B.CLAVE AND C.COMPANIA = '[compania]' AND C.ESTATUS = '0' AND  (B.CLAVE like RTRIM('[query]%') OR upper(B.NOMBRE) like upper('%[query]%'))
BuscaCuentasPdreGrid = select CUENTA_ALIAS, CUENTA_ALIAS ||'-'|| nombre as nombre from cuentas where estructura in (select estructura from companias where compania = '[compania]') and afectable = 'S' and (CUENTA like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%')) order by 1
BuscaPermisosCta = SELECT PE_PERMISOS, PE_GPOUSU FROM GENTPE WHERE PE_GPOUSU = (SELECT US_GRUPO FROM GENTUS WHERE US_USUARIO = (SELECT UC_USUARIO FROM GENTUC WHERE UC_COMPANIA = '[compania]' AND UC_USUARIO = '[usuario]' AND ROWNUM = 1) AND US_CVESIS = 'empres' AND US_FECHA_BAJA IS NULL) AND PE_CVESIS = 'empres' AND PE_CVEOPC = 'm12o2e11'
BuscaPermisosPolizas = SELECT PE_PERMISOS, PE_GPOUSU FROM GENTPE WHERE PE_GPOUSU = (SELECT US_GRUPO FROM GENTUS WHERE US_USUARIO = (SELECT UC_USUARIO FROM GENTUC WHERE UC_COMPANIA = '[compania]' AND UC_USUARIO = '[usuario]' AND ROWNUM = 1) AND US_CVESIS = 'empres' AND US_FECHA_BAJA IS NULL) AND PE_CVESIS = 'empres' AND PE_CVEOPC = 'm12o4o7'

buscarEstructura2 = SELECT FORMATO_ALIAS FROM ESTRUCTURAS WHERE ESTRUCTURA = '[compania]' 
buscaCtaComplementaria = select CUENTA_ALIAS ,cuenta, cuenta_alias ||'-'||nombre as nombre from cuentas where estructura in (select estructura from companias where compania = '[compania]') and (cuenta_ALIAS like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%')) 
buscaSaldo= SELECT SALDO_INICIAL, CARGOS, ABONOS, SALDO_FINAL FROM SALDOS WHERE CUENTA = '[cuenta]' AND COMPANIA = '[compania]' AND ROWNUM = 1 
buscaDetPoliza= SELECT CUENTA FROM DET_POLIZAS WHERE CUENTA = '[cuenta]' AND COMPANIA = '[compania]' AND ROWNUM = 1 

buscaDatosCtaPadre = SELECT AFECTABLE FROM CUENTAS WHERE ESTRUCTURA = '[compania]' AND CUENTA = '[cuenta]'
TranspasoSaldos = INSERT INTO SALDOS (COMPANIA,TIPO,CALENDARIO,PERIODO,CUENTA,C_COSTOS,SALDO_INICIAL,CARGOS,ABONOS,SALDO_FINAL) SELECT COMPANIA, TIPO, CALENDARIO, PERIODO,'[cuenta_nueva]' ,C_COSTOS,SALDO_INICIAL,CARGOS,ABONOS,SALDO_FINAL FROM SALDOS WHERE COMPANIA = '[compania]' AND CUENTA = '[cuenta_vieja]'
VerificaCtaSat = SELECT CODIGO_AGRUPADOR FROM ERP_SAT_CUENTAS WHERE CODIGO_AGRUPADOR = '[cuenta_sat]'

#CFDI

BuscaRfcCfdi = SELECT ID,RFC,PASSWORD FROM ERP_SAT_LEER_CFDI WHERE COMPANIA = '[compania]' and USUARIO = '[usuario]'


#Transaccion

TiposTransaccion = SELECT ID, COLUMNAS ,NOMBRE FROM ERP_SAT_TRANSACCION_TIPO
BuscaMetPago = SELECT CLAVE, CONCEPTO, CLAVE || '-' || CONCEPTO AS NOMBRE FROM ERP_SAT_MET_PAGOS WHERE CLAVE like RTRIM('[query]%') OR upper(CONCEPTO) like upper('%[query]%') AND CLAVE NOT IN ('2','3')
#BuscaTransaccionSat = SELECT ID, NUMERO_POL, TIPO_POL, TO_CHAR(FECHA_POL,'dd/mm/yyyy') AS FECHA_POL, SEC_POL, ORIGEN_PAGO, T_DOC_PAGO, FOLIO_PAGO, SEC_PAGO, NUM_CTA, DES_CTA, CONCEPTO, DEBE, HABER, TIPO, UUID_CFDI, RFC, CFD_CBB_SERIE, CFD_CBB_NUMFOL, NUM_FACT_EXT, TAX_ID, NUM, BAN_EMIS_NAL, BAN_EMIS_EXT, FECHA, BENEF, CTA_ORI, BANCO_ORI_NAL, BANCO_ORI_EXT, CTA_DEST, BANCO_DEST_NAL, BANCO_DEST_EXT, MET_PAGO_POL, MONTO_TOTAL, MONEDA, TIP_CAMB FROM ERP_SAT_TRANSACCION WHERE COMPANIA = '[compania]' AND NUMERO_POL = '[numeroPol]' AND TIPO_POL = '[tipoPoliza]' AND FECHA_POL = TO_DATE('[fecha]','dd/mm/yyyy') AND SEC_POL = [sec]
#BuscaTransaccionSat = SELECT ID, COMPANIA, ORIGEN_PAGO, T_DOC_PAGO, FOLIO_PAGO, SEC_PAGO, NUM_CTA, DES_CTA, CONCEPTO, DEBE, HABER, TIPO, UUID_CFDI, RFC, CFD_CBB_SERIE, CFD_CBB_NUMFOL, NUM_FACT_EXT, TAX_ID, NUM, BAN_EMIS_NAL, BAN_EMIS_EXT, TO_CHAR(FECHA,'DD/MM/YYYY') AS FECHA, BENEF, CTA_ORI, BANCO_ORI_NAL, BANCO_ORI_EXT, CTA_DEST, BANCO_DEST_NAL, BANCO_DEST_EXT, MET_PAGO_POL, MONTO_TOTAL, MONEDA, TIP_CAMB FROM ERP_SAT_TRANSACCION WHERE COMPANIA = '[compania]' 
BuscaTransaccionSat = SELECT (SELECT FOLIO FROM ERP_FE_COMPROBANTES  WHERE COMPANIA = T.COMPANIA AND UUID = T.UUID_CFDI AND ROWNUM = 1) as FOLIO_CFDI,(SELECT TO_CHAR(FECHA,'DD/MM/YYYY') FROM ERP_FE_COMPROBANTES  WHERE COMPANIA = T.COMPANIA AND UUID = T.UUID_CFDI AND ROWNUM = 1) AS FECHA_CFDI, (SELECT E.NOMBRE FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = T.COMPANIA AND E.COMPANIA = C.COMPANIA AND C.NUMERO = E.NUMERO AND C.UUID = T.UUID_CFDI AND ROWNUM = 1) AS EMISOR_CFDI, T.MET_PAGO_AUX ,(SELECT CONCEPTO FROM ERP_SAT_MET_PAGOS WHERE CLAVE = T.MET_PAGO_AUX) AS NOMBRE_MET_PAGO_AUX,T.ID, T.COMPANIA, T.ORIGEN_PAGO, T.T_DOC_PAGO, T.FOLIO_PAGO, T.SEC_PAGO, T.NUM_CTA, T.DES_CTA, T.CONCEPTO, T.DEBE, T.HABER, T.TIPO, T.UUID_CFDI, T.RFC, T.CFD_CBB_SERIE, T.CFD_CBB_NUMFOL, T.NUM_FACT_EXT, T.TAX_ID, T.NUM, T.BAN_EMIS_NAL,(SELECT NOMBRE FROM ERP_SAT_BANCOS WHERE CLAVE = T.BAN_EMIS_NAL) AS NOMBRE_BAN_EMIS_NAL, T.BAN_EMIS_EXT, TO_CHAR(T.FECHA,'DD/MM/YYYY') AS FECHA, T.BENEF, T.CTA_ORI, T.BANCO_ORI_NAL,(SELECT NOMBRE FROM ERP_SAT_BANCOS WHERE CLAVE = T.BANCO_ORI_NAL) AS NOMBRE_BANCO_ORI_NAL, T.BANCO_ORI_EXT, T.CTA_DEST, T.BANCO_DEST_NAL,(SELECT NOMBRE FROM ERP_SAT_BANCOS WHERE CLAVE = T.BANCO_DEST_NAL) AS NOMBRE_BANCO_DEST_NAL, T.BANCO_DEST_EXT, T.MET_PAGO_POL,(SELECT CONCEPTO FROM ERP_SAT_MET_PAGOS WHERE CLAVE = T.MET_PAGO_POL) AS NOMBRE_MET_PAGO_POL, T.MONTO_TOTAL, T.MONEDA,(SELECT MONEDA FROM ERP_SAT_MONEDAS WHERE CODIGO = T.MONEDA ) AS NOMBRE_MONEDA, T.TIP_CAMB, (SELECT ID_TRANSACCION FROM DET_POLIZASXTRANSACCION WHERE COMPANIA = '[compania]' AND TIPO_POLIZA = '[tipoPoliza]' AND FECHA = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND NUMERO = '[numero]' AND SEC = [sec] AND ID_TRANSACCION = T.ID) AS ID_TRANSACCION FROM ERP_SAT_TRANSACCION T WHERE T.COMPANIA = '[compania]'  order by ID_TRANSACCION, T.ID 

 
#BuscaDatosCompNal = SELECT C.UUID, C.TOTAL, NVL(C.TIPO_CAMBIO,1) AS TIPO_CAMBIO, C.MONEDA FROM ERP_FE_COMPROBANTES C, ERP_POLIZASXFACTURAS F WHERE C.COMPANIA = '[compania]' AND F.COMPANIA = C.COMPANIA AND F.FECHA_POL = TO_DATE('[fecha]','DD/MM/YYYY') AND F.TIPO_POL = '[tipoPoliza]' AND F.NUMERO_POL = '[numero]' AND F.NUMERO_FE = C.NUMERO AND F.UUID = C.UUID
BuscaDatosCompNal = SELECT C.FOLIO, C.UUID, C.TOTAL, NVL(C.TIPO_CAMBIO,1) AS TIPO_CAMBIO,(SELECT E.RFC FROM ERP_FE_EMISOR E, COMPANIAS M WHERE E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND M.COMPANIA = E.COMPANIA AND M.RFC = E.RFC) AS COUNT_RFC_E ,(SELECT R.RFC FROM ERP_FE_RECEPTOR R, COMPANIAS M WHERE R.COMPANIA = C.COMPANIA AND R.NUMERO = C.NUMERO AND M.COMPANIA = R.COMPANIA AND M.RFC = R.RFC) AS COUNT_RFC_R, (SELECT RFC FROM ERP_FE_EMISOR WHERE COMPANIA = C.COMPANIA AND NUMERO = C.NUMERO) AS RFC_EMISOR,(SELECT NOMBRE FROM ERP_FE_EMISOR WHERE COMPANIA = C.COMPANIA AND NUMERO = C.NUMERO) AS NOMBRE_EMISOR, (SELECT RFC FROM ERP_FE_RECEPTOR WHERE COMPANIA = C.COMPANIA AND NUMERO = C.NUMERO ) AS RFC_RECEPTOR,  NVL((SELECT MONEDA_SAT FROM ERP_CFDI_MONEDAS WHERE MONEDA = C.MONEDA),'MXN') AS MONEDA FROM ERP_FE_COMPROBANTES C, ERP_POLIZASXFACTURAS F WHERE C.COMPANIA = '[compania]' AND F.COMPANIA = C.COMPANIA AND F.FECHA_POL = TO_DATE('[fecha]','DD/MM/YYYY') AND F.TIPO_POL = '[tipoPoliza]' AND F.NUMERO_POL = '[numero]' AND F.NUMERO_FE = C.NUMERO AND F.UUID = C.UUID
BuscaMonedaCFDI = SELECT CASE MONEDA_SAT WHEN 'MXN' THEN '1' WHEN 'USD' THEN '2' END AS MONEDA_SAT  FROM ERP_CFDI_MONEDAS WHERE MONEDA = '[moneda]'

BuscaNumeracionTipoPoliza = SELECT NUMERACION, FOLIO_INI FROM TIPOS_POLIZAS WHERE COMPANIA = '[compania]' AND TIPO_POLIZA = '[tipoPoliza]'
#WS XML

buscaDatosWSF = SELECT UUID, FOLIO FROM ERP_FE_COMPROBANTES WHERE COMPANIA = '[compania]' AND NUMERO = [numero]

buscaCtasHijas = SELECT CUENTA FROM CUENTAS WHERE ESTRUCTURA = '[compania]' AND CUENTA_PADRE = '[cuenta]' UNION SELECT CUENTA FROM CUENTAS WHERE ESTRUCTURA = '[compania]' AND CUENTA_PADRE LIKE '[cuenta]-%'

#POLIZASXML

#BuscaTransXPoliza = SELECT T.NUM_CTA, (SELECT NOMBRE FROM CUENTAS WHERE CUENTA = T.NUM_CTA AND ESTRUCTURA = T.COMPANIA ) AS DES_CTA_NOM, T.CONCEPTO, T.DEBE, T.HABER, T.SEC_POL, T.TIPO, T.UUID_CFDI, T.RFC, T.CFD_CBB_SERIE, T.CFD_CBB_NUMFOL, T.NUM_FACT_EXT, T.TAX_ID, T.NUM, T.BAN_EMIS_NAL,T.BAN_EMIS_EXT,TO_CHAR(T.FECHA,'DD/MM/YYYY') AS FECHA,T.BENEF,T.CTA_ORI,T.BANCO_ORI_NAL,T.BANCO_ORI_EXT, T.CTA_DEST,T.BANCO_DEST_NAL,T.BANCO_DEST_EXT, T.MET_PAGO_POL,T.MONTO_TOTAL,T.MONEDA,T.TIP_CAMB  FROM ERP_SAT_TRANSACCION T  WHERE T.COMPANIA = '[compania]' AND T.NUMERO_POL = '[numero]' AND T.TIPO_POL = '[tipo_pol]' AND T.FECHA_POL = TO_DATE('[fecha]','DD/MM/YYYY')
#BuscaTransXPoliza = SELECT D.CUENTA, D.CARGOS,D.ABONOS,REPLACE(D.DESCRIPCION,',',' ') AS DESCRIPCION, T.NUM_CTA, REPLACE ((SELECT NOMBRE FROM CUENTAS WHERE CUENTA = D.CUENTA AND ESTRUCTURA = T.COMPANIA ), ',', ' ') AS DES_CTA_NOM, T.CONCEPTO, NVL(T.DEBE,0), NVL(T.HABER,0), T.SEC_POL, T.TIPO, T.UUID_CFDI, T.RFC, T.CFD_CBB_SERIE, T.CFD_CBB_NUMFOL, T.NUM_FACT_EXT, T.TAX_ID, T.NUM, T.BAN_EMIS_NAL,T.BAN_EMIS_EXT,TO_CHAR(T.FECHA,'DD/MM/YYYY') AS FECHA,T.BENEF,T.CTA_ORI,T.BANCO_ORI_NAL,T.BANCO_ORI_EXT, T.CTA_DEST,T.BANCO_DEST_NAL,T.BANCO_DEST_EXT, T.MET_PAGO_POL,TO_NUMBER(TO_CHAR(T.MONTO_TOTAL,'999999999.99')) as MONTO_TOTAL,T.MONEDA,T.TIP_CAMB  FROM ERP_SAT_TRANSACCION T, DET_POLIZAS D, DET_POLIZASXTRANSACCION DT  WHERE T.COMPANIA = '[compania]' AND D.NUMERO = '[numero]' AND D.TIPO_POLIZA = '[tipo_pol]' AND D.FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND DT.COMPANIA = D.COMPANIA AND DT.NUMERO = D.NUMERO AND DT.FECHA = D.FECHA AND DT.TIPO_POLIZA = D.TIPO_POLIZA AND DT.SEC = D.SEC AND D.COMPANIA = T.COMPANIA AND  DT.ID_TRANSACCION = T.ID 
#BuscaTransXPoliza = SELECT (SELECT CUENTA_ALIAS FROM CUENTAS WHERE ESTRUCTURA = D.COMPANIA AND CUENTA = D.CUENTA AND ROWNUM = 1) AS CUENTA, D.CARGOS,D.ABONOS,REPLACE(REPLACE (REPLACE (D.DESCRIPCION, ',', ' '),'*',' '),'"',' ') AS DESCRIPCION, T.NUM_CTA, REPLACE ((SELECT NOMBRE FROM CUENTAS WHERE CUENTA = D.CUENTA AND ESTRUCTURA = T.COMPANIA ), ',', ' ') AS DES_CTA_NOM, T.CONCEPTO, NVL(T.DEBE,0), NVL(T.HABER,0), T.SEC_POL, T.TIPO, T.UUID_CFDI, T.RFC, T.CFD_CBB_SERIE, T.CFD_CBB_NUMFOL, T.NUM_FACT_EXT, T.TAX_ID, T.NUM, T.BAN_EMIS_NAL,T.BAN_EMIS_EXT,TO_CHAR(T.FECHA,'DD/MM/YYYY') AS FECHA,REPLACE(T.BENEF, ',', ' ') AS BENEF,T.CTA_ORI,T.BANCO_ORI_NAL,T.BANCO_ORI_EXT, T.CTA_DEST,T.BANCO_DEST_NAL,T.BANCO_DEST_EXT, T.MET_PAGO_POL,cast ( T.MONTO_TOTAL AS NUMBER(14, 2)) AS MONTO_TOTAL,T.MONEDA,T.TIP_CAMB  FROM ERP_SAT_TRANSACCION T, DET_POLIZAS D, DET_POLIZASXTRANSACCION DT  WHERE T.COMPANIA = '[compania]' AND D.NUMERO = '[numero]' AND D.TIPO_POLIZA = '[tipo_pol]' AND D.FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND DT.COMPANIA = D.COMPANIA AND DT.NUMERO = D.NUMERO AND DT.FECHA = D.FECHA AND DT.TIPO_POLIZA = D.TIPO_POLIZA AND DT.SEC = D.SEC AND D.COMPANIA = T.COMPANIA AND  DT.ID_TRANSACCION = T.ID 
#BuscaTransXPolizaDet = SELECT C.CUENTA_ALIAS AS CUENTA,D.CARGOS,D.ABONOS,REPLACE (REPLACE (REPLACE (D.DESCRIPCION, ',', ' '), '*', ' '),'"',' ') AS DESCRIPCION,T.NUM_CTA,REPLACE (C.NOMBRE, ',',  ' ') AS DES_CTA_NOM,T.CONCEPTO,NVL (T.DEBE, 0),NVL (T.HABER, 0),T.SEC_POL,T.TIPO,T.UUID_CFDI,T.RFC,T.CFD_CBB_SERIE,T.CFD_CBB_NUMFOL,T.NUM_FACT_EXT,T.TAX_ID,T.NUM,T.BAN_EMIS_NAL,T.BAN_EMIS_EXT,TO_CHAR (T.FECHA, 'DD/MM/YYYY') AS FECHA,REPLACE (T.BENEF, ',', ' ') AS BENEF,T.CTA_ORI,T.BANCO_ORI_NAL,T.BANCO_ORI_EXT,T.CTA_DEST,T.BANCO_DEST_NAL,T.BANCO_DEST_EXT,T.MET_PAGO_POL,CAST (T.MONTO_TOTAL AS NUMBER (14, 2)) AS MONTO_TOTAL,T.MONEDA,T.TIP_CAMB FROM ERP_SAT_TRANSACCION T, DET_POLIZAS D, DET_POLIZASXTRANSACCION DT,CUENTAS C WHERE     D.COMPANIA = '[compania]' AND D.NUMERO = '[numero]' AND D.TIPO_POLIZA = '[tipo_pol]' AND D.FECHA = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND D.SEC = [sec] AND C.CUENTA = D.CUENTA AND C.ESTRUCTURA = D.COMPANIA AND T.COMPANIA  =  D.COMPANIA AND DT.COMPANIA  =D.COMPANIA AND DT.NUMERO  = D.NUMERO AND DT.FECHA  =  D.FECHA AND DT.TIPO_POLIZA =  D.TIPO_POLIZA AND DT.SEC =  D.SEC AND DT.ID_TRANSACCION  =  T.ID union SELECT C.CUENTA_ALIAS AS CUENTA,D.CARGOS,D.ABONOS,REPLACE (REPLACE (REPLACE (D.DESCRIPCION, ',', ' '), '*', ' '),'"',' ')AS DESCRIPCION,'' AS NUM_CTA,REPLACE (C.NOMBRE, ',',  ' ') AS DES_CTA_NOM,'' AS CONCEPTO,0,0,0 SEC_POL,'NA'  AS TIPO,'' UUID_CFDI,'' RFC,'' CFD_CBB_SERIE, '' CFD_CBB_NUMFOL,'' NUM_FACT_EXT,'' TAX_ID,'' NUM,'' BAN_EMIS_NAL,'' BAN_EMIS_EXT, NULL AS  FECHA,'' BENEF,'' AS CTA_ORI,'' AS BANCO_ORI_NAL, '' AS BANCO_ORI_EXT,'' AS CTA_DEST,'' AS BANCO_DEST_NAL,'' AS BANCO_DEST_EXT, '' AS MET_PAGO_POL,0.0 MONTO_TOTAL,'' AS MONEDA,0 AS TIP_CAMB FROM  DET_POLIZAS D, CUENTAS C WHERE D.COMPANIA = '[compania]' AND D.NUMERO = '[numero]' AND D.TIPO_POLIZA = '[tipo_pol]' AND D.FECHA = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND C.CUENTA = D.CUENTA AND C.ESTRUCTURA = D.COMPANIA AND  D.COMPANIA || D.NUMERO || TO_CHAR(D.FECHA,'DDMMYYY') || D.TIPO_POLIZA ||D.SEC NOT IN( SELECT  DT.COMPANIA || DT.NUMERO || TO_CHAR(DT.FECHA,'DDMMYYY') || DT.TIPO_POLIZA ||DT.SEC FROM DET_POLIZASXTRANSACCION DT WHERE DT.NUMERO = D.NUMERO AND DT.TIPO_POLIZA = D.TIPO_POLIZA AND TO_CHAR(DT.FECHA,'DDMMYYY')  = TO_CHAR(D.FECHA,'DDMMYYY'))      
BuscaTransXPolizaDet = SELECT C.CUENTA_ALIAS AS CUENTA,D.CARGOS,D.ABONOS,REPLACE (REPLACE (REPLACE (D.DESCRIPCION, ',', ' '), '*', ' '),'"',' ') AS DESCRIPCION,T.NUM_CTA,REPLACE (C.NOMBRE, ',',  ' ') AS DES_CTA_NOM,T.CONCEPTO,NVL (T.DEBE, 0),NVL (T.HABER, 0),T.SEC_POL,T.TIPO,T.UUID_CFDI,T.RFC,T.CFD_CBB_SERIE,T.CFD_CBB_NUMFOL,T.NUM_FACT_EXT,T.TAX_ID,T.NUM,T.BAN_EMIS_NAL,T.BAN_EMIS_EXT,TO_CHAR (T.FECHA, 'DD/MM/YYYY') AS FECHA,REPLACE (T.BENEF, ',', ' ') AS BENEF,T.CTA_ORI,T.BANCO_ORI_NAL,T.BANCO_ORI_EXT,T.CTA_DEST,T.BANCO_DEST_NAL,T.BANCO_DEST_EXT,T.MET_PAGO_POL,CAST (T.MONTO_TOTAL AS NUMBER (14, 2)) AS MONTO_TOTAL,T.MONEDA,T.TIP_CAMB FROM ERP_SAT_TRANSACCION T, DET_POLIZAS D, DET_POLIZASXTRANSACCION DT,CUENTAS C WHERE     D.COMPANIA = '[compania]' AND D.NUMERO = '[numero]' AND D.TIPO_POLIZA = '[tipo_pol]' AND D.FECHA = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND D.SEC = [sec] AND C.CUENTA = D.CUENTA AND C.ESTRUCTURA = D.COMPANIA AND T.COMPANIA  =  D.COMPANIA AND DT.COMPANIA  =D.COMPANIA AND DT.NUMERO  = D.NUMERO AND DT.FECHA  =  D.FECHA AND DT.TIPO_POLIZA =  D.TIPO_POLIZA AND DT.SEC =  D.SEC AND DT.ID_TRANSACCION  =  T.ID 
BuscaTransXPoliza=SELECT D.SEC,C.CUENTA_ALIAS AS CUENTA, D.CARGOS, D.ABONOS, REPLACE (REPLACE (REPLACE (NVL(D.DESCRIPCION,REFERENCIA), ',', ' '), '*', ' '),  '"', ' ')  AS DESCRIPCION, REPLACE (C.NOMBRE, ',', ' ') AS DES_CTA_NOM  FROM  DET_POLIZAS D,  CUENTAS C WHERE D.COMPANIA = '[compania]' AND D.NUMERO = '[numero]' AND D.TIPO_POLIZA = '[tipo_pol]' AND D.FECHA = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND C.CUENTA = D.CUENTA AND C.ESTRUCTURA = D.COMPANIA
 
BuscaTransXPolizaNom = SELECT D.CUENTA, D.CARGOS, D.ABONOS, REPLACE (D.DESCRIPCION, ',', ' ') AS DESCRIPCION, T.NUM_CTA,  REPLACE ( (SELECT TRIM(NOMBRE) FROM CUENTAS WHERE CUENTA = D.CUENTA AND ESTRUCTURA = T.COMPANIA), ',', ' ') AS DES_CTA_NOM, T.CONCEPTO, NVL (T.DEBE, 0), NVL (T.HABER, 0),  D.SEC AS SEC_POL, T.TIPO, replace(replace(T.UUID_CFDI,chr(10),''),chr(13),'') as UUID_CFDI,T.RFC,T.CFD_CBB_SERIE, T.CFD_CBB_NUMFOL, T.NUM_FACT_EXT, T.TAX_ID, T.NUM, T.BAN_EMIS_NAL, T.BAN_EMIS_EXT, TO_CHAR (T.FECHA, 'DD/MM/YYYY') AS FECHA, REPLACE (T.BENEF, ',', ' ') AS BENEF, T.CTA_ORI, T.BANCO_ORI_NAL, T.BANCO_ORI_EXT, T.CTA_DEST, T.BANCO_DEST_NAL, T.BANCO_DEST_EXT, T.MET_PAGO_POL, CAST (T.MONTO_TOTAL AS NUMBER (14, 2)) AS MONTO_TOTAL, T.MONEDA, T.TIP_CAMB FROM ERP_SAT_TRANSACCION_NOMINA T, DET_POLIZAS D WHERE T.COMPANIA = '[compania]' AND D.NUMERO = '[numero]' AND D.TIPO_POLIZA = '[tipo_pol]' AND D.FECHA = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND D.COMPANIA = T.COMPANIA AND T.NUMERO_POL = D.NUMERO AND T.FECHA_POL = D.FECHA AND T.TIPO_POL = D.TIPO_POLIZA ORDER BY D.SEC


#BuscaTransXFolio = SELECT T.MET_PAGO_AUX,D.CUENTA, D.CARGOS,D.ABONOS,D.DESCRIPCION, T.NUM_CTA, (SELECT NOMBRE FROM CUENTAS WHERE CUENTA = D.CUENTA AND ESTRUCTURA = T.COMPANIA ) AS DES_CTA_NOM, T.CONCEPTO, T.DEBE, T.HABER, T.SEC_POL, T.TIPO, T.UUID_CFDI, T.RFC, T.CFD_CBB_SERIE, T.CFD_CBB_NUMFOL, T.NUM_FACT_EXT, T.TAX_ID, T.NUM, T.BAN_EMIS_NAL,T.BAN_EMIS_EXT,TO_CHAR(T.FECHA,'DD/MM/YYYY') AS FECHA,T.BENEF,T.CTA_ORI,T.BANCO_ORI_NAL,T.BANCO_ORI_EXT, T.CTA_DEST,T.BANCO_DEST_NAL,T.BANCO_DEST_EXT, T.MET_PAGO_POL,T.MONTO_TOTAL,T.MONEDA,T.TIP_CAMB  FROM ERP_SAT_TRANSACCION T, DET_POLIZAS D WHERE T.COMPANIA = '[compania]' AND T.NUMERO_POL = '[numero]' AND T.FECHA_POL = TO_DATE('[fecha]','DD/MM/YYYY') AND D.COMPANIA = T.COMPANIA AND D.NUMERO = T.NUMERO_POL AND D.TIPO_POLIZA = T.TIPO_POL AND D.FECHA = T.FECHA_POL AND D.SEC = T.SEC_POL AND T.TIPO IN ('CompNal','CompNalOtr','CompExt')

#BuscaTransXFolio = SELECT T.MET_PAGO_AUX,D.CUENTA, D.CARGOS,D.ABONOS,REPLACE(D.DESCRIPCION,',',' ') AS DESCRIPCION, T.NUM_CTA, (SELECT NOMBRE FROM CUENTAS WHERE CUENTA = D.CUENTA AND ESTRUCTURA = T.COMPANIA ) AS DES_CTA_NOM, T.CONCEPTO, T.DEBE, T.HABER, T.SEC_POL, T.TIPO, T.UUID_CFDI, T.RFC, T.CFD_CBB_SERIE, T.CFD_CBB_NUMFOL, T.NUM_FACT_EXT, T.TAX_ID, T.NUM, T.BAN_EMIS_NAL,T.BAN_EMIS_EXT,TO_CHAR(T.FECHA,'DD/MM/YYYY') AS FECHA,T.BENEF,T.CTA_ORI,T.BANCO_ORI_NAL,T.BANCO_ORI_EXT, T.CTA_DEST,T.BANCO_DEST_NAL,T.BANCO_DEST_EXT, T.MET_PAGO_POL,T.MONTO_TOTAL,T.MONEDA,T.TIP_CAMB  FROM ERP_SAT_TRANSACCION T, DET_POLIZAS D, DET_POLIZASXTRANSACCION DT WHERE T.COMPANIA = '[compania]' AND D.NUMERO = '[numero]' AND D.FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND D.TIPO_POLIZA = '[tipo_poliza]' AND DT.COMPANIA = D.COMPANIA AND DT.NUMERO = D.NUMERO AND DT.FECHA = D.FECHA AND DT.TIPO_POLIZA = D.TIPO_POLIZA AND DT.SEC = D.SEC AND D.COMPANIA = T.COMPANIA AND  DT.ID_TRANSACCION = T.ID  AND T.TIPO IN ('CompNal','CompNalOtr','CompExt')
#BuscaTransXFolio = WITH A AS( SELECT DISTINCT NVL(T.MET_PAGO_AUX,'98') AS MET_PAGO_AUX,'' as CUENTA, 0 AS CARGOS, 0 AS ABONOS,'' AS DESCRIPCION, T.NUM_CTA, '' AS DES_CTA_NOM, T.CONCEPTO, NVL(T.DEBE,0), NVL(T.HABER,0), T.SEC_POL, T.TIPO, T.UUID_CFDI, T.RFC, T.CFD_CBB_SERIE, T.CFD_CBB_NUMFOL, T.NUM_FACT_EXT, T.TAX_ID, T.NUM, T.BAN_EMIS_NAL,T.BAN_EMIS_EXT,TO_CHAR(T.FECHA,'DD/MM/YYYY') AS FECHA,T.BENEF,T.CTA_ORI,T.BANCO_ORI_NAL,T.BANCO_ORI_EXT, T.CTA_DEST,T.BANCO_DEST_NAL,T.BANCO_DEST_EXT, T.MET_PAGO_POL,cast ( T.MONTO_TOTAL AS NUMBER(14, 2)) AS MONTO_TOTAL,T.MONEDA,T.TIP_CAMB  FROM ERP_SAT_TRANSACCION T, DET_POLIZAS D, DET_POLIZASXTRANSACCION DT WHERE T.COMPANIA = '[compania]' AND D.NUMERO = '[numero]' AND D.FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND D.TIPO_POLIZA = '[tipo_poliza]' AND DT.COMPANIA = D.COMPANIA AND DT.NUMERO = D.NUMERO AND DT.FECHA = D.FECHA AND DT.TIPO_POLIZA = D.TIPO_POLIZA AND DT.SEC = D.SEC AND D.COMPANIA = T.COMPANIA AND  DT.ID_TRANSACCION = T.ID  AND T.TIPO IN ('CompNal','CompNalOtr','CompExt') UNION SELECT '98' AS MET_PAGO_AUX,'' as CUENTA, 0 AS CARGOS, 0 AS ABONOS,'' AS DESCRIPCION, '' AS NUM_CTA, '' AS DES_CTA_NOM, '' AS CONCEPTO, 0 AS DEBE, 0 AS HABER, 0 AS SEC_POL,'CompNal' AS TIPO, P.UUID as UUID_CFDI, C.RFC,'' AS CFD_CBB_SERIE, '' AS CFD_CBB_NUMFOL,'' AS NUM_FACT_EXT, '' AS TAX_ID, '' AS NUM, '' AS BAN_EMIS_NAL,'' AS BAN_EMIS_EXT,'' AS FECHA,'' AS BENEF,'' AS CTA_ORI,'' AS BANCO_ORI_NAL,'' AS BANCO_ORI_EXT, '' AS CTA_DEST,'' AS BANCO_DEST_NAL,'' AS BANCO_DEST_EXT, '' AS MET_PAGO_POL, TO_NUMBER (TO_CHAR ((0.16*(SELECT SUM (DD.PRECIO_UNITARIO) FROM FE_DET_FACTURAS@CFDI DD WHERE DD.COMPANIA = (SELECT COMPANIA_CFDI FROM COMPANIAS WHERE COMPANIA = '[compania]') AND DD.ID_FACTURA = F.ID_FACTURA)+(SELECT SUM (DD.PRECIO_UNITARIO) FROM FE_DET_FACTURAS@CFDI DD WHERE DD.COMPANIA = (SELECT COMPANIA_CFDI FROM COMPANIAS WHERE COMPANIA = '[compania]') AND DD.ID_FACTURA = F.ID_FACTURA)),'999999999.99')) AS MONTO_TOTAL, CASE F.ID_MONEDA WHEN 1 THEN 'MXN' WHEN 2 THEN 'USD' WHEN 3 THEN 'USD' ELSE '' END AS MONEDA,CASE F.ID_MONEDA WHEN 1 THEN 1 WHEN 2 THEN NVL((SELECT DISTINCT TIPO_CAMBIO FROM R_DIVISAS@radm_dblink R WHERE ID_COMPANIA = (SELECT COMPANIA_CXC FROM COMPANIAS WHERE COMPANIA ='[compania]' ) AND ID_MONEDA IN ('3','2') AND FECHA = TO_DATE(TO_CHAR(F.FECHA,'DD/MM/YYYY'),'DD/MM/YYYY') AND ROWNUM = 1),1) WHEN 3 THEN NVL((SELECT DISTINCT TIPO_CAMBIO FROM R_DIVISAS@radm_dblink R WHERE ID_COMPANIA = (SELECT COMPANIA_CXC FROM COMPANIAS WHERE COMPANIA ='[compania]' ) AND ID_MONEDA IN ('2','3') AND FECHA = TO_DATE(TO_CHAR(F.FECHA,'DD/MM/YYYY'),'DD/MM/YYYY') AND ROWNUM = 1),1) ELSE 1 END AS TIP_CAMB FROM ERP_POLIZASXFACTURAS P, FE_FACTURAS@CFDI F, FE_CLIENTES@CFDI C, FE_DET_FACTURAS@CFDI D WHERE P.COMPANIA = '[compania]' AND F.COMPANIA = P.COMPANIA_CFDI AND F.ID_FACTURA = P.ID_FACTURA AND D.COMPANIA   = F.COMPANIA AND D.ID_FACTURA = F.ID_FACTURA AND C.COMPANIA = F.COMPANIA AND C.ID_CLIENTE = F.ID_CLIENTE AND F.FOLIO = P.FOLIO AND P.NUMERO_POL = '[numero]' AND P.FECHA_POL = TO_DATE('[fecha]','DD/MM/YYYY') AND P.TIPO_POL = '[tipo_poliza]' AND P.NUMERO_FE IS NULL UNION SELECT '98' AS MET_PAGO_AUX,'' AS CUENTA,0 AS CARGOS,0 AS ABONOS,'' AS DESCRIPCION,'' AS NUM_CTA,'' AS DES_CTA_NOM,'' AS CONCEPTO,0 AS DEBE,0 AS HABER,0 AS SEC_POL,'CompNal' AS TIPO,C.UUID AS UUID_CFDI,E.RFC,'' AS CFD_CBB_SERIE,'' AS CFD_CBB_NUMFOL,'' AS NUM_FACT_EXT,'' AS TAX_ID,'' AS NUM,'' AS BAN_EMIS_NAL,'' AS BAN_EMIS_EXT,'' AS FECHA,'' AS BENEF,'' AS CTA_ORI,'' AS BANCO_ORI_NAL,'' AS BANCO_ORI_EXT,'' AS CTA_DEST,'' AS BANCO_DEST_NAL,'' AS BANCO_DEST_EXT,'' AS MET_PAGO_POL, CAST (C.TOTAL AS NUMBER (14, 2)) AS MONTO_TOTAL, NVL((SELECT MONEDA_SAT FROM ERP_CFDI_MONEDAS WHERE MONEDA = C.MONEDA ),'MXN') AS MONEDA, TO_NUMBER(NVL (IS_NUMBER(C.TIPO_CAMBIO), 1)) AS TIP_CAMB FROM ERP_POLIZASXFACTURAS F, ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE F.COMPANIA = '[compania]' AND F.NUMERO_POL = '[numero]' AND F.FECHA_POL = TO_DATE('[fecha]','DD/MM/YYYY') AND F.TIPO_POL = '[tipo_poliza]' AND C.COMPANIA = F.COMPANIA AND C.NUMERO = F.NUMERO_FE AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO UNION SELECT DISTINCT NVL (T.MET_PAGO_AUX, '98') AS MET_PAGO_AUX,'' AS CUENTA,0 AS CARGOS,0 AS ABONOS,'' AS DESCRIPCION, T.NUM_CTA,'' AS DES_CTA_NOM,T.CONCEPTO,NVL (T.DEBE, 0), NVL (T.HABER, 0),T.SEC_POL,T.TIPO, T.UUID_CFDI,T.RFC,T.CFD_CBB_SERIE,T.CFD_CBB_NUMFOL,T.NUM_FACT_EXT,T.TAX_ID,T.NUM,T.BAN_EMIS_NAL,T.BAN_EMIS_EXT,TO_CHAR (T.FECHA, 'DD/MM/YYYY') AS FECHA,T.BENEF,T.CTA_ORI,T.BANCO_ORI_NAL,T.BANCO_ORI_EXT, T.CTA_DEST,T.BANCO_DEST_NAL,T.BANCO_DEST_EXT,T.MET_PAGO_POL, CAST (T.MONTO_TOTAL AS NUMBER (14, 2)) AS MONTO_TOTAL,T.MONEDA,T.TIP_CAMB FROM ERP_SAT_TRANSACCION_NOMINA T, POLIZAS P WHERE P.COMPANIA = '[compania]' AND P.NUMERO = '[numero]' AND P.FECHA = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND P.TIPO_POLIZA = '[tipo_poliza]' AND T.COMPANIA = P.COMPANIA AND T.NUMERO_POL = P.NUMERO AND T.TIPO_POL = P.TIPO_POLIZA AND T.FECHA_POL = P.FECHA AND T.TIPO IN ('CompNal', 'CompNalOtr', 'CompExt')) SELECT DISTINCT * FROM A
BuscaTransXFolio = WITH A AS( SELECT DISTINCT NVL(T.MET_PAGO_AUX,'98') AS MET_PAGO_AUX,'' as CUENTA, 0 AS CARGOS, 0 AS ABONOS,'' AS DESCRIPCION, T.NUM_CTA, '' AS DES_CTA_NOM, T.CONCEPTO, NVL(T.DEBE,0), NVL(T.HABER,0), T.SEC_POL, T.TIPO, T.UUID_CFDI, T.RFC, T.CFD_CBB_SERIE, T.CFD_CBB_NUMFOL, T.NUM_FACT_EXT, T.TAX_ID, T.NUM, T.BAN_EMIS_NAL,T.BAN_EMIS_EXT,TO_CHAR(T.FECHA,'DD/MM/YYYY') AS FECHA,T.BENEF,T.CTA_ORI,T.BANCO_ORI_NAL,T.BANCO_ORI_EXT, T.CTA_DEST,T.BANCO_DEST_NAL,T.BANCO_DEST_EXT, T.MET_PAGO_POL,cast ( T.MONTO_TOTAL AS NUMBER(14, 2)) AS MONTO_TOTAL,T.MONEDA,T.TIP_CAMB  FROM ERP_SAT_TRANSACCION T, DET_POLIZAS D, DET_POLIZASXTRANSACCION DT WHERE T.COMPANIA = '[compania]' AND D.NUMERO = '[numero]' AND D.FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND D.TIPO_POLIZA = '[tipo_poliza]' AND DT.COMPANIA = D.COMPANIA AND DT.NUMERO = D.NUMERO AND DT.FECHA = D.FECHA AND DT.TIPO_POLIZA = D.TIPO_POLIZA AND DT.SEC = D.SEC AND D.COMPANIA = T.COMPANIA AND  DT.ID_TRANSACCION = T.ID  AND T.TIPO IN ('CompNal','CompNalOtr','CompExt') UNION SELECT '98' AS MET_PAGO_AUX,'' as CUENTA, 0 AS CARGOS, 0 AS ABONOS,'' AS DESCRIPCION, '' AS NUM_CTA, '' AS DES_CTA_NOM, '' AS CONCEPTO, 0 AS DEBE, 0 AS HABER, 0 AS SEC_POL,'CompNal' AS TIPO, P.UUID as UUID_CFDI, C.RFC,'' AS CFD_CBB_SERIE, '' AS CFD_CBB_NUMFOL,'' AS NUM_FACT_EXT, '' AS TAX_ID, '' AS NUM, '' AS BAN_EMIS_NAL,'' AS BAN_EMIS_EXT,'' AS FECHA,'' AS BENEF,'' AS CTA_ORI,'' AS BANCO_ORI_NAL,'' AS BANCO_ORI_EXT, '' AS CTA_DEST,'' AS BANCO_DEST_NAL,'' AS BANCO_DEST_EXT, '' AS MET_PAGO_POL,  ROUND(0.16*NVL((SELECT SUM (DD.PRECIO_UNITARIO) FROM FE_DET_FACTURAS@CFDI DD WHERE DD.COMPANIA = (SELECT COMPANIA_CFDI FROM COMPANIAS WHERE COMPANIA = '[compania]') AND DD.ID_FACTURA = F.ID_FACTURA),0)+NVL((SELECT SUM (DD.PRECIO_UNITARIO) FROM FE_DET_FACTURAS@CFDI DD WHERE DD.COMPANIA = (SELECT COMPANIA_CFDI FROM COMPANIAS WHERE COMPANIA = '[compania]') AND DD.ID_FACTURA = F.ID_FACTURA),0),2) AS MONTO_TOTAL, CASE F.ID_MONEDA WHEN 1 THEN 'MXN' WHEN 2 THEN 'USD' WHEN 3 THEN 'USD' ELSE '' END AS MONEDA,CASE F.ID_MONEDA WHEN 1 THEN 1 WHEN 2 THEN NVL((SELECT DISTINCT TIPO_CAMBIO FROM R_DIVISAS@radm_dblink R WHERE ID_COMPANIA = (SELECT COMPANIA_CXC FROM COMPANIAS WHERE COMPANIA ='[compania]' ) AND ID_MONEDA IN ('3','2') AND FECHA = TO_DATE(TO_CHAR(F.FECHA,'DD/MM/YYYY'),'DD/MM/YYYY') AND ROWNUM = 1),1) WHEN 3 THEN NVL((SELECT DISTINCT TIPO_CAMBIO FROM R_DIVISAS@radm_dblink R WHERE ID_COMPANIA = (SELECT COMPANIA_CXC FROM COMPANIAS WHERE COMPANIA ='[compania]' ) AND ID_MONEDA IN ('2','3') AND FECHA = TO_DATE(TO_CHAR(F.FECHA,'DD/MM/YYYY'),'DD/MM/YYYY') AND ROWNUM = 1),1) ELSE 1 END AS TIP_CAMB FROM ERP_POLIZASXFACTURAS P, FE_FACTURAS@CFDI F, FE_CLIENTES@CFDI C, FE_DET_FACTURAS@CFDI D WHERE P.COMPANIA = '[compania]' AND F.COMPANIA = P.COMPANIA_CFDI AND F.ID_FACTURA = P.ID_FACTURA AND D.COMPANIA   = F.COMPANIA AND D.ID_FACTURA = F.ID_FACTURA AND C.COMPANIA = F.COMPANIA AND C.ID_CLIENTE = F.ID_CLIENTE AND F.FOLIO = P.FOLIO AND P.NUMERO_POL = '[numero]' AND P.FECHA_POL = TO_DATE('[fecha]','DD/MM/YYYY') AND P.TIPO_POL = '[tipo_poliza]' AND P.NUMERO_FE IS NULL UNION SELECT DISTINCT NVL (T.MET_PAGO_AUX, '98') AS MET_PAGO_AUX,'' AS CUENTA,0 AS CARGOS,0 AS ABONOS,'' AS DESCRIPCION, T.NUM_CTA,'' AS DES_CTA_NOM,T.CONCEPTO,NVL (T.DEBE, 0), NVL (T.HABER, 0),T.SEC_POL,T.TIPO, T.UUID_CFDI,T.RFC,T.CFD_CBB_SERIE,T.CFD_CBB_NUMFOL,T.NUM_FACT_EXT,T.TAX_ID,T.NUM,T.BAN_EMIS_NAL,T.BAN_EMIS_EXT,TO_CHAR (T.FECHA, 'DD/MM/YYYY') AS FECHA,T.BENEF,T.CTA_ORI,T.BANCO_ORI_NAL,T.BANCO_ORI_EXT, T.CTA_DEST,T.BANCO_DEST_NAL,T.BANCO_DEST_EXT,T.MET_PAGO_POL, CAST (T.MONTO_TOTAL AS NUMBER (14, 2)) AS MONTO_TOTAL,T.MONEDA,T.TIP_CAMB FROM ERP_SAT_TRANSACCION_NOMINA T, POLIZAS P WHERE P.COMPANIA = '[compania]' AND P.NUMERO = '[numero]' AND P.FECHA = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND P.TIPO_POLIZA = '[tipo_poliza]' AND T.COMPANIA = P.COMPANIA AND T.NUMERO_POL = P.NUMERO AND T.TIPO_POL = P.TIPO_POLIZA AND T.FECHA_POL = P.FECHA AND T.TIPO IN ('CompNal', 'CompNalOtr', 'CompExt')) SELECT DISTINCT * FROM A

BuscaCtaAuxCtasDet = SELECT DISTINCT CONCEPTO, TO_CHAR(FECHA,'yyyy-MM-dd') AS FECHA, NUM_UNIDEN_POL, DEBE, HABER FROM ERP_SAT_AUXILIAR_CTAS_DET WHERE COMPANIA = '[compania]' AND PID = '[pid]' AND NUM_CTA = '[cuenta]' AND TO_NUMBER(TO_CHAR(FECHA,'MM'))=[mes] AND TO_NUMBER(TO_CHAR(FECHA,'YYYY'))=[calendario] ORDER BY FECHA, NUM_UNIDEN_POL
BuscaCtaAuxCtas = SELECT DISTINCT NUM_CTA, DES_CTA, SALDO_INI, SALDO_FIN FROM ERP_SAT_AUXILIAR_CTAS_DET WHERE COMPANIA = '[compania]' AND PID = '[pid]' AND TO_NUMBER(TO_CHAR(FECHA,'MM'))=[mes] AND TO_NUMBER(TO_CHAR(FECHA,'YYYY'))=[calendario]  ORDER BY NUM_CTA
BuscaCompaniaNomina = select compania from  companias where compania_nomina = '[compania]'

BuscaAvisos = SELECT A.ORDEN, A.SEC,A.TIPO, REPLACE(A.MENSAJE, ',','#') AS MENSAJE, A.COLOR_FONDO, A.TIEMPO_VISIBLE, A.TITULO FROM ERP_MSG_AVISOS A WHERE A.COMPANIA = '[compania]' AND A.USUARIO IS NULL AND A.QUERY IS NULL AND A.ESTATUS = '1' AND A.NUM_VISTAS > (SELECT COUNT(*) FROM ERP_MSG_AVISOS_NUM WHERE SEC = A.SEC) AND SYSDATE BETWEEN A.FECHA_INI AND A.FECHA_FIN AND A.GPO_USUARIO IS NULL UNION SELECT B.ORDEN,B.SEC,B.TIPO, REPLACE(B.MENSAJE, ',','#') AS MENSAJE, B.COLOR_FONDO, B.TIEMPO_VISIBLE, B.TITULO FROM ERP_MSG_AVISOS B WHERE B.COMPANIA IS NULL AND B.ESTATUS = '1' AND B.NUM_VISTAS > (SELECT COUNT(*) FROM ERP_MSG_AVISOS_NUM WHERE SEC = B.SEC) AND SYSDATE BETWEEN B.FECHA_INI AND B.FECHA_FIN  AND B.GPO_USUARIO IS NULL AND B.USUARIO = '[usuario]' UNION SELECT C.ORDEN, C.SEC,C.TIPO, REPLACE(C.MENSAJE, ',','#') AS MENSAJE, C.COLOR_FONDO, C.TIEMPO_VISIBLE, C.TITULO FROM ERP_MSG_AVISOS C WHERE C.COMPANIA IS NULL  AND C.GPO_USUARIO = (SELECT DISTINCT US_GRUPO FROM GENTUS WHERE US_USUARIO = '[usuario]') AND C.ESTATUS = '1' AND C.NUM_VISTAS > (SELECT COUNT(*) FROM ERP_MSG_AVISOS_NUM WHERE SEC = C.SEC) AND SYSDATE BETWEEN C.FECHA_INI AND C.FECHA_FIN  AND C.USUARIO IS NULL UNION SELECT D.ORDEN, D.SEC,D.TIPO, REPLACE(D.MENSAJE, ',','#') AS MENSAJE, D.COLOR_FONDO, D.TIEMPO_VISIBLE, D.TITULO FROM ERP_MSG_AVISOS D WHERE D.COMPANIA = '[compania]'  AND D.GPO_USUARIO = (SELECT DISTINCT US_GRUPO FROM GENTUS WHERE US_USUARIO = '[usuario]') AND D.ESTATUS = '1' AND D.NUM_VISTAS > (SELECT COUNT(*) FROM ERP_MSG_AVISOS_NUM WHERE SEC = D.SEC) AND SYSDATE BETWEEN D.FECHA_INI AND D.FECHA_FIN  AND D.USUARIO IS NULL [query] ORDER by ORDEN
#BuscaQueryAviso = SELECT QUERY FROM ERP_MSG_AVISOS WHERE usuario = '[usuario]' AND QUERY IS NOT NULL
BuscaQueryAviso = SELECT QUERY FROM ERP_MSG_AVISOS WHERE usuario = '[usuario]' AND QUERY IS NOT NULL AND COMPANIA IS NULL UNION SELECT QUERY FROM ERP_MSG_AVISOS WHERE COMPANIA = '[compania]' AND QUERY IS NOT NULL AND USUARIO IS NULL UNION SELECT QUERY FROM ERP_MSG_AVISOS WHERE COMPANIA = '[compania]' AND GPO_USUARIO = (SELECT us_grupo FROM GENTUS WHERE US_USUARIO = '[usuario]') AND QUERY IS NOT NULL AND USUARIO IS NULL
BuscaRegistrosPro = SELECT NVL(COUNT(*) + 1,0) AS NUM_REGISTROS FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]'
BuscaRfcProveedor = SELECT RFC FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND RFC = '[rfc]'
BuscaRfcCliente = SELECT RFC FROM ERP_CLIENTES WHERE COMPANIA = '[compania]' AND RFC = '[rfc]'
BuscaRegistrosCli = SELECT NVL(COUNT(*) + 1,0) AS NUM_REGISTROS FROM ERP_CLIENTES WHERE COMPANIA = '[compania]'

#BuscaDatosProveedores = SELECT C.FOLIO, E.NOMBRE, E.RFC FROM ERP_FE_COMPROBANTES C, ERP_POLIZASXFACTURAS F, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND F.COMPANIA = C.COMPANIA AND F.FECHA_POL = TO_DATE('[fecha]','DD/MM/YYYY') AND F.TIPO_POL = '[tipoPoliza]' AND F.NUMERO_POL = '[numero]' AND F.NUMERO_FE = C.NUMERO AND F.UUID = C.UUID AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO

BuscaDatCFDI = SELECT C.UUID, C.FOLIO,E.RFC AS RFC_EMISOR, R.RFC AS RFC_RECEPTOR,C.TOTAL,C.TIPO_CAMBIO,C.MONEDA FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E, ERP_FE_RECEPTOR R WHERE C.COMPANIA = '[compania]' AND C.NUMERO = [numero] AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND R.COMPANIA = C.COMPANIA AND R.NUMERO  = E.NUMERO

BuscaRFCCompania = SELECT RFC FROM COMPANIAS WHERE COMPANIA = '[compania]'
BuscaIDTransaccion = SELECT ID FROM ERP_SAT_TRANSACCION WHERE COMPANIA = '[compania]' AND UUID_CFDI = '[uuid]' AND ROWNUM = 1

BuscaDatosProveedores = SELECT CUENTA_CLAVE, BANCO, ID_CLIENTE,NOMBRE,RFC FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND (NOMBRE like RTRIM('%[query]%') OR RFC like RTRIM('[query]%')) 
#BuscaBancoProveedore = SELECT B.CLAVE, B.NOMBRE, B.CLAVE ||'-'|| B.NOMBRE AS NOMBRE1 ,(SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND BANCO = B.CLAVE AND ROWNUM = 1) AS CUENTA_CLAVE FROM ERP_SAT_BANCOS B WHERE B.CLAVE IN (SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND (BANCO like RTRIM('[query]%') OR B.NOMBRE like RTRIM('[query]%') ))
BuscaBancoProveedore = SELECT S.CLAVE,S.NOMBRE, S.CLAVE || '-' || S.NOMBRE AS NOMBRE1, C.CUENTA_CLAVE, C.NOMBRE as NOMBRE_PROV, C.RFC FROM ERP_CCLIENTES C, ERP_SAT_BANCOS S WHERE COMPANIA = '[compania]' AND C.BANCO = S.CLAVE AND C.BANCO IS NOT NULL AND (C.BANCO like RTRIM('[query]%') OR S.NOMBRE like RTRIM('%[query]%') )

#BuscaFechaSystema=SELECT TO_CHAR(SYSDATE,'MM') AS PERIODO, TO_CHAR(SYSDATE,'YYYY') AS CALENDARIO FROM DUAL
BuscaFechaViaticos=SELECT TO_CHAR(NVL(MAX(F_INI_COMISION),SYSDATE),'MM') AS PERIODO,TO_CHAR(NVL(MAX(F_INI_COMISION),SYSDATE),'YYYY') AS CALENDARIO FROM VI_COMISIONES  WHERE COMPANIA = '[compania]'
BuscaFechaSystemaOtras = SELECT TO_CHAR(NVL(MAX(FECHA),SYSDATE),'MM') AS PERIODO,TO_CHAR(NVL(MAX(FECHA),SYSDATE),'YYYY') AS CALENDARIO FROM ERP_CP_OTRAS WHERE COMPANIA = '[compania]'
BuscaFechaSystema=SELECT TO_CHAR(NVL(MAX(FECHA),SYSDATE),'MM') AS PERIODO,TO_CHAR(NVL(MAX(FECHA),SYSDATE),'YYYY') AS CALENDARIO FROM ERP_FE_COMPROBANTES WHERE COMPANIA = '[compania]' AND ORIGEN = '[origen]'
BuscaFechaSystema2=SELECT TO_CHAR(NVL(MAX(FECHA),SYSDATE),'MM') AS PERIODO,TO_CHAR(NVL(MAX(FECHA),SYSDATE),'YYYY') AS CALENDARIO FROM ERP_FE_COMPROBANTES WHERE COMPANIA = '[compania]' 
BuscaFechaSystema2CXC = SELECT TO_CHAR(NVL(MAX(C.FECHA),SYSDATE),'MM') AS PERIODO,TO_CHAR(NVL(MAX(C.FECHA),SYSDATE),'YYYY') AS CALENDARIO FROM ERP_FE_COMPROBANTES C WHERE C.COMPANIA = '[compania]' AND (((SELECT M.RFC FROM ERP_FE_EMISOR M WHERE M.COMPANIA = C.COMPANIA AND M.NUMERO = C.NUMERO) = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = C.COMPANIA) AND C.TIPO_DE_COMPROBANTE = 'ingreso') OR ((SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO) =(SELECT RFC FROM COMPANIAS WHERE COMPANIA = C.COMPANIA) AND C.TIPO_DE_COMPROBANTE = 'egreso'))
BuscaFechaSystema2CXP = SELECT TO_CHAR(NVL(MAX(C.FECHA),SYSDATE),'MM') AS PERIODO,TO_CHAR(NVL(MAX(C.FECHA),SYSDATE),'YYYY') AS CALENDARIO FROM ERP_FE_COMPROBANTES C WHERE C.COMPANIA = '[compania]' AND (((SELECT M.RFC FROM ERP_FE_EMISOR M WHERE M.COMPANIA = C.COMPANIA AND M.NUMERO = C.NUMERO) = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = C.COMPANIA) AND C.TIPO_DE_COMPROBANTE = 'egreso') OR ((SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO) =(SELECT RFC FROM COMPANIAS WHERE COMPANIA = C.COMPANIA) AND C.TIPO_DE_COMPROBANTE = 'ingreso'))

BuscaSecDetPoliza = SELECT SEC FROM DET_POLIZAS WHERE COMPANIA = '[compania]' AND NUMERO = '[numero]' AND FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND TIPO_POLIZA = '[tipo_poliza]'
BuscaSecDetPolizaSB = SELECT D.SEC FROM DET_POLIZAS D,CUENTAS C WHERE D.COMPANIA = '[compania]' AND D.NUMERO = '[numero]' AND D.FECHA = TO_DATE ('[fecha]', 'DD/MM/YYYY') AND D.TIPO_POLIZA = '[tipo_poliza]' AND C.ESTRUCTURA = D.COMPANIA AND C.CUENTA = D.CUENTA AND C.BANCO IS NULL

BuscaCuentaBanco = SELECT C.CUENTA, C.NOMBRE,D.SEC,D.CARGOS,D.ABONOS, B.BANCO_SAT,NVL (B.CUENTA_CLABE, B.CUENTA_BANCO) AS CUENTA_BANCO,R.RFC,REPLACE(R.NOMBRE,',','') AS BENEF,REPLACE(E.NOMBRE,',','') AS BENEF_EMISOR FROM CUENTAS C, DET_POLIZAS D, ERP_CAT_BANCO B,ERP_FE_COMPROBANTES F,ERP_FE_EMISOR E, ERP_FE_RECEPTOR R WHERE C.ESTRUCTURA = '[compania]' AND D.COMPANIA = C.ESTRUCTURA AND D.CUENTA = C.CUENTA AND B.COMPANIA = C.ESTRUCTURA AND C.BANCO = B.BANCO AND D.NUMERO = '[numeroPol]' AND D.FECHA = TO_DATE ('[fechaPol]', 'DD/MM/YYYY') AND D.TIPO_POLIZA = '[tipoPol]' AND F.COMPANIA = D.COMPANIA AND F.NUMERO = '[numero]' AND E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND R.COMPANIA = F.COMPANIA AND R.NUMERO = F.NUMERO
BuscaCuentaBancoCXP = SELECT C.CUENTA, C.NOMBRE,D.SEC,D.CARGOS,D.ABONOS, B.BANCO_SAT,NVL (B.CUENTA_CLABE, B.CUENTA_BANCO) AS CUENTA_BANCO,R.RFC,REPLACE(R.NOMBRE,',','') AS BENEF,REPLACE(E.NOMBRE,',','') AS BENEF_EMISOR,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = D.COMPANIA AND RFC = E.RFC) AS BANCO_PROV,(SELECT NVL(CUENTA_CLAVE,NUMERO_CUENTA) FROM ERP_CCLIENTES WHERE COMPANIA = D.COMPANIA AND RFC = E.RFC) AS CUENTA_PROV FROM CUENTAS C, DET_POLIZAS D, ERP_CAT_BANCO B,ERP_FE_COMPROBANTES F,ERP_FE_EMISOR E, ERP_FE_RECEPTOR R WHERE C.ESTRUCTURA = '[compania]' AND D.COMPANIA = C.ESTRUCTURA AND D.CUENTA = C.CUENTA AND B.COMPANIA = C.ESTRUCTURA AND C.BANCO = B.BANCO AND D.NUMERO = '[numeroPol]' AND D.FECHA = TO_DATE ('[fechaPol]', 'DD/MM/YYYY') AND D.TIPO_POLIZA = '[tipoPol]' AND F.COMPANIA = D.COMPANIA AND F.NUMERO = '[numero]' AND E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND R.COMPANIA = F.COMPANIA AND R.NUMERO = F.NUMERO

##QUerys CargaFE2 
#BuscaArchivosCXC=SELECT F.COMPANIA,  NVL((F.ESTATUSV),'2') AS ESTATUSV, F.NUMERO, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO,  (SELECT CON.NO_CASO||'-'||CON.NOMBRE FROM ERP_CAT_CONVERTIDOR CON WHERE CON.COMPANIA = F.COMPANIA AND CON.NO_CASO= F.IDCONCGASTO) AS NOMIDCONCGASTO, F.ORIGEN, (SELECT  P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS TIPO_POLIZA, (SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS NUMERO_POL, (SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS FECHA_POL, F.XML, TO_CHAR(F.FECHA_CAP,'DD/MM/YYYY') AS FECHA_CAP, F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA,(CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN 'Cliente' ELSE 'Proveedor' END) TIPO, (CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN (SELECT CUENTA FROM ERP_CLIENTES WHERE COMPANIA =F.COMPANIA AND RFC = (SELECT E.NOMBRE  FROM ERP_FE_RECEPTOR E  WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND ROWNUM=1)) ELSE (SELECT CUENTA FROM ERP_PROVEEDORES WHERE COMPANIA =F.COMPANIA AND RFC = F.RFC) END) CUENTA_CONTABLE, (CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN (SELECT AUXILIAR FROM ERP_CLIENTES WHERE COMPANIA =F.COMPANIA AND RFC = (SELECT E.NOMBRE  FROM ERP_FE_RECEPTOR E  WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND ROWNUM=1)) ELSE (SELECT AUXILIAR FROM ERP_PROVEEDORES WHERE COMPANIA =F.COMPANIA AND RFC = F.RFC) END) AUXILIAR_CONTABLE FROM ERP_FE_COMPROBANTES F WHERE F.COMPANIA = '[compania]'  AND NUMERO LIKE '%[FACTURA]%' AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) = TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(F.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) ORDER BY FECHA_POL, F.FECHA DESC
#BuscaArchivosCXC=SELECT F.COMPANIA,  NVL((F.ESTATUSV),'2') AS ESTATUSV, F.NUMERO, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO,  (SELECT CON.NO_CASO||'-'||CON.NOMBRE FROM ERP_CAT_CONVERTIDOR CON WHERE CON.COMPANIA = F.COMPANIA AND CON.NO_CASO= F.IDCONCGASTO) AS NOMIDCONCGASTO, F.ORIGEN, (SELECT  P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS TIPO_POLIZA, (SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS NUMERO_POL, (SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS FECHA_POL, F.XML, TO_CHAR(F.FECHA_CAP,'DD/MM/YYYY') AS FECHA_CAP, F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA,(CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN 'Cliente' ELSE 'Proveedor' END) TIPO, (CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN (SELECT CUENTA FROM ERP_CLIENTES WHERE COMPANIA =F.COMPANIA AND RFC = (SELECT E.NOMBRE  FROM ERP_FE_RECEPTOR E  WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND ROWNUM=1)) ELSE (SELECT CUENTA FROM ERP_PROVEEDORES WHERE COMPANIA =F.COMPANIA AND RFC = F.RFC) END) CUENTA_CONTABLE, (CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN (SELECT AUXILIAR FROM ERP_CLIENTES WHERE COMPANIA =F.COMPANIA AND RFC = (SELECT E.NOMBRE  FROM ERP_FE_RECEPTOR E  WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND ROWNUM=1)) ELSE (SELECT AUXILIAR FROM ERP_PROVEEDORES WHERE COMPANIA =F.COMPANIA AND RFC = F.RFC) END) AUXILIAR_CONTABLE FROM ERP_FE_COMPROBANTES F WHERE F.COMPANIA = '[compania]'  AND NUMERO LIKE '%[FACTURA]%' AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) <= TO_NUMBER('[periodo_fin]') AND TO_NUMBER(TO_CHAR(F.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) ORDER BY  F.FECHA, FECHA_POL DESC
#ingresos
BuscaArchivosCXC=SELECT F.COMPANIA,  NVL((F.ESTATUSV),'2') AS ESTATUSV, F.NUMERO, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO,  (SELECT CON.NO_CASO||'-'||CON.NOMBRE FROM ERP_CAT_CONVERTIDOR CON WHERE CON.COMPANIA = F.COMPANIA AND CON.NO_CASO= F.IDCONCGASTO AND ORIGEN = 'X') AS NOMIDCONCGASTO, F.ORIGEN, (SELECT  P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS TIPO_POLIZA, (SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS NUMERO_POL, (SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS FECHA_POL, F.XML, TO_CHAR(F.FECHA_CAP,'DD/MM/YYYY') AS FECHA_CAP, F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA,(CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN 'Cliente' ELSE 'Proveedor' END) TIPO, (CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN (SELECT CUENTA FROM ERP_CLIENTES WHERE COMPANIA =F.COMPANIA AND RFC = (SELECT E.RFC  FROM ERP_FE_RECEPTOR E  WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND ROWNUM=1) AND ROWNUM = 1) ELSE (SELECT CUENTA FROM ERP_PROVEEDORES WHERE COMPANIA =F.COMPANIA AND RFC = F.RFC AND ROWNUM = 1) END) CUENTA_CONTABLE, (CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN (SELECT AUXILIAR FROM ERP_CLIENTES WHERE COMPANIA =F.COMPANIA AND RFC = (SELECT E.NOMBRE  FROM ERP_FE_RECEPTOR E  WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND ROWNUM=1)) ELSE (SELECT AUXILIAR FROM ERP_PROVEEDORES WHERE COMPANIA =F.COMPANIA AND RFC = F.RFC AND ROWNUM = 1) END) AUXILIAR_CONTABLE,(SELECT TOTAL_DEDUCCIONES FROM ERP_FE_NOMINA WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS TOTAL_DEDUCCIONES,(SELECT TOTAL_PERCEPCIONES FROM ERP_FE_NOMINA WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS TOTAL_PERCEPCIONES, (SELECT NUM_DIAS_PAGADOS FROM ERP_FE_NOMINA WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS NUM_DIAS_PAGADOS, (SELECT FECHA_PAGO FROM ERP_FE_NOMINA WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS FECHA_PAGO,  (SELECT REGISTRO_PATRONAL FROM ERP_FE_NOMINA_EMISOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS REGISTRO_PATRONAL,(SELECT SALARIO_DIARIO_INT FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS SALARIO_DIARIO_INT, (SELECT CUENTA_BANCARIA FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS CUENTA_BANCARIA, (SELECT PERIODICIDAD_PAGO FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS PERIODICIDAD_PAGO, (SELECT PUESTO FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS PUESTO, (SELECT DEPARTAMENTO FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS DEPARTAMENTO, (SELECT NUM_EMPLEADO FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS NUM_EMPLEADO, (SELECT FECHA_INI_REL_LABORAL FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS FECHA_INI_REL_LABORAL, (SELECT NUM_SEG_SOCIAL FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS NUM_SEG_SOCIAL, (SELECT CURP FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS CURP FROM ERP_FE_COMPROBANTES F WHERE F.COMPANIA = '[compania]'  AND NUMERO LIKE '%[FACTURA]%' AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) <= TO_NUMBER('[periodo_fin]') AND TO_NUMBER(TO_CHAR(F.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND (((SELECT M.RFC FROM ERP_FE_EMISOR M WHERE M.COMPANIA = F.COMPANIA AND M.NUMERO = F.NUMERO) = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) AND F.TIPO_DE_COMPROBANTE IN ('ingreso','I')) OR ((SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) =(SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) AND F.TIPO_DE_COMPROBANTE IN ('egreso','E'))) ORDER BY  F.FECHA, FECHA_POL,F.NUMERO DESC
#egresos
BuscaArchivosCXP2=SELECT F.COMPANIA,  NVL((F.ESTATUSV),'2') AS ESTATUSV, F.NUMERO, (SELECT NVL(SUM(T.IMPORTE),0) FROM ERP_FE_IMP_TRASLADOS T WHERE T.COMPANIA = F.COMPANIA AND T.NUMERO = F.NUMERO) AS IVA, F.FOLIO, F.FOLIO_FISCAL_ORIG, F.PDF, F.UUID, TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, TO_CHAR (F.FECHA_FOLIO_FISCAL_ORIG, 'DD/MM/YYYY') AS FECHA_FOLIO_FISCAL_ORIG, F.SERIE, F.SERIE_FOLIO_FISCAL_ORIG, F.SUBTOTAL, F.TOTAL, F.TIPO_CAMBIO, F.TIPO_DE_COMPROBANTE, F.CONDICIONES_DE_PAGO, F.DESCUENTO, F.FORMA_DE_PAGO, F.METODO_DE_PAGO, F.MONEDA, F.MONTO_FOLIO_FISCAL_ORIG, F.LUGAR_EXPEDICION, F.MOTIVO_DESCUENTO, F.NO_CERTIFICADO, F.NUM_CTA_PAGO, F.VERSION,  F.IDCONCGASTO,  (SELECT CON.NO_CASO||'-'||CON.NOMBRE FROM ERP_CAT_CONVERTIDOR CON WHERE CON.COMPANIA = F.COMPANIA AND CON.NO_CASO= F.IDCONCGASTO AND ORIGEN = 'X') AS NOMIDCONCGASTO, F.ORIGEN, (SELECT  P.TIPO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS TIPO_POLIZA, (SELECT P.NUMERO_POL FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS NUMERO_POL, (SELECT  TO_CHAR(P.FECHA_POL,'DD/MM/YYYY') FROM ERP_POLIZASXFACTURAS P WHERE P.COMPANIA = F.COMPANIA AND P.NUMERO_FE = F.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS FECHA_POL, F.XML, TO_CHAR(F.FECHA_CAP,'DD/MM/YYYY') AS FECHA_CAP, F.FLAG_POLIZA, (SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS C WHERE C.COMPANIA = F.COMPANIA AND C.NUMERO =F.NUMERO AND ROWNUM=1 ) AS DESCRIPCION,(SELECT E.RFC FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS RFC_EMISOR,       (SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=F.COMPANIA AND E.NUMERO = F.NUMERO ) AS NOMBRE_EMISOR,(SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS RFC_RECEPTOR ,(SELECT E.NOMBRE FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) AS NOMBRE_RECEPTOR,(SELECT RFC FROM COMPANIAS WHERE COMPANIA =F.COMPANIA) AS RFC_COMPANIA,(CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN 'Cliente' ELSE 'Proveedor' END) TIPO, (CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN (SELECT CUENTA FROM ERP_CLIENTES WHERE COMPANIA =F.COMPANIA AND RFC = (SELECT E.NOMBRE  FROM ERP_FE_RECEPTOR E  WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND ROWNUM=1)) ELSE (SELECT CUENTA FROM ERP_PROVEEDORES WHERE COMPANIA =F.COMPANIA AND RFC = F.RFC AND ROWNUM = 1) END) CUENTA_CONTABLE, (CASE WHEN F.RFC = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) THEN (SELECT AUXILIAR FROM ERP_CLIENTES WHERE COMPANIA =F.COMPANIA AND RFC = (SELECT E.NOMBRE  FROM ERP_FE_RECEPTOR E  WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND ROWNUM=1)) ELSE (SELECT AUXILIAR FROM ERP_PROVEEDORES WHERE COMPANIA =F.COMPANIA AND RFC = F.RFC AND ROWNUM = 1) END) AUXILIAR_CONTABLE,(SELECT TOTAL_DEDUCCIONES FROM ERP_FE_NOMINA WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS TOTAL_DEDUCCIONES,(SELECT TOTAL_PERCEPCIONES FROM ERP_FE_NOMINA WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS TOTAL_PERCEPCIONES, (SELECT NUM_DIAS_PAGADOS FROM ERP_FE_NOMINA WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS NUM_DIAS_PAGADOS, (SELECT FECHA_PAGO FROM ERP_FE_NOMINA WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS FECHA_PAGO,  (SELECT REGISTRO_PATRONAL FROM ERP_FE_NOMINA_EMISOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS REGISTRO_PATRONAL,(SELECT SALARIO_DIARIO_INT FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS SALARIO_DIARIO_INT, (SELECT CUENTA_BANCARIA FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS CUENTA_BANCARIA, (SELECT PERIODICIDAD_PAGO FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS PERIODICIDAD_PAGO, (SELECT PUESTO FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS PUESTO, (SELECT DEPARTAMENTO FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS DEPARTAMENTO, (SELECT NUM_EMPLEADO FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS NUM_EMPLEADO, (SELECT FECHA_INI_REL_LABORAL FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS FECHA_INI_REL_LABORAL, (SELECT NUM_SEG_SOCIAL FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS NUM_SEG_SOCIAL, (SELECT CURP FROM ERP_FE_NOMINA_RECEPTOR WHERE COMPANIA = F.COMPANIA AND NUMERO = F.NUMERO) AS CURP FROM ERP_FE_COMPROBANTES F WHERE F.COMPANIA = '[compania]'  AND NUMERO LIKE '%[FACTURA]%' AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(F.FECHA,'MM')) <= TO_NUMBER('[periodo_fin]') AND TO_NUMBER(TO_CHAR(F.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND (((SELECT M.RFC FROM ERP_FE_EMISOR M WHERE M.COMPANIA = F.COMPANIA AND M.NUMERO = F.NUMERO) = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) AND F.TIPO_DE_COMPROBANTE IN ('egreso','E')) OR ((SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO) =(SELECT RFC FROM COMPANIAS WHERE COMPANIA = F.COMPANIA) AND F.TIPO_DE_COMPROBANTE IN ('ingreso','I'))) ORDER BY  F.FECHA, FECHA_POL,F.NUMERO DESC

BuscaComplementoPagos=SELECT F.COMPANIA, P.ID AS ID_PAGO,F.NUMERO, F.FOLIO,TO_CHAR (F.FECHA, 'DD/MM/YYYY') AS FECHA, F.TIPO_DE_COMPROBANTE, F.XML, F.PDF, F.UUID, E.RFC AS RFC_EMISOR, E.NOMBRE AS NOMBRE_EMISOR, R.RFC AS RFC_RECEPTOR,R.NOMBRE AS NOMBRE_RECEPTOR, P.CTA_BENEFICIARIO, P.MONTO, P.MONEDA_P,P.FORMA_DE_PAGO_P, TO_CHAR(P.FECHA_PAGO,'DD/MM/YYYY') AS FECHA_PAGO FROM ERP_FE_COMPROBANTES F, ERP_FE_EMISOR E, ERP_FE_RECEPTOR R, ERP_FE_PAGOS P WHERE F.COMPANIA = '[compania]' AND F.TIPO_DE_COMPROBANTE = 'P' AND E.COMPANIA = F.COMPANIA AND E.NUMERO = F.NUMERO AND R.COMPANIA = F.COMPANIA AND R.NUMERO = F.NUMERO AND P.COMPANIA = F.COMPANIA AND P.NUMERO = F.NUMERO AND TO_NUMBER (TO_CHAR (F.FECHA, 'MM')) >= TO_NUMBER ('[periodo]') AND TO_NUMBER (TO_CHAR (F.FECHA, 'MM')) <= TO_NUMBER ('[periodo_fin]') AND TO_NUMBER (TO_CHAR (F.FECHA, 'YYYY')) = TO_NUMBER ('[calendario]')
BuscaFechaSystemaCompl = SELECT TO_CHAR(NVL(MAX(C.FECHA),SYSDATE),'MM') AS PERIODO,TO_CHAR(NVL(MAX(C.FECHA),SYSDATE),'YYYY') AS CALENDARIO FROM ERP_FE_COMPROBANTES C WHERE C.COMPANIA = '[compania]' AND TIPO_DE_COMPROBANTE = 'P'

BuscaComplementoPagosDet=WITH A AS(SELECT D.ID_DOCUMENTO FROM ERP_FE_COMPROBANTES C, ERP_FE_DOC_RELACIONADO D, ERP_FE_PAGOS P WHERE C.COMPANIA = '[compania]' AND C.NUMERO = [numero] AND C.TIPO_DE_COMPROBANTE = 'P' AND P.COMPANIA = C.COMPANIA AND P.NUMERO = C.NUMERO AND P.ID = [idPago] AND D.COMPANIA = P.COMPANIA AND D.NUMERO = P.NUMERO AND D.ID_PAGO = P.ID ) SELECT C.COMPANIA,C.NUMERO,C.FOLIO,TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA,SUBTOTAL,TOTAL,(SELECT SUM(IMPORTE) FROM ERP_FE_IMP_TRASLADOS WHERE COMPANIA = C.COMPANIA AND NUMERO = C.NUMERO AND IMPUESTO = '002') AS IVA, C.TIPO_DE_COMPROBANTE,C.PDF,C.XML,C.UUID,E.RFC AS RFC_EMISOR,E.NOMBRE AS NOMBRE_EMISOR,R.RFC AS RFC_RECEPTOR,R.NOMBRE AS NOMBRE_RECEPTOR FROM ERP_FE_COMPROBANTES C,A,ERP_FE_EMISOR E, ERP_FE_RECEPTOR R WHERE C.COMPANIA = '[compania]' AND C.UUID = A.ID_DOCUMENTO AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND R.COMPANIA = C.COMPANIA AND R.NUMERO = C.NUMERO



BuscaPagos = SELECT (SELECT P.TIPO_POL FROM ERP_POLIZASXPAGOS P WHERE P.COMPANIA = C.COMPANIA AND P.NUMERO_FE = C.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS TIPO_POLIZA_PAGO,(SELECT P.NUMERO_POL FROM ERP_POLIZASXPAGOS P WHERE P.COMPANIA = C.COMPANIA AND P.NUMERO_FE = C.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS NUMERO_POL_PAGO,(SELECT TO_CHAR (P.FECHA_POL, 'DD/MM/YYYY') FROM ERP_POLIZASXPAGOS P WHERE P.COMPANIA = C.COMPANIA AND P.NUMERO_FE = C.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS FECHA_POL_PAGO, (SELECT NUMERO_POL FROM ERP_POLIZASXPAGOS WHERE COMPANIA = C.COMPANIA AND OPERACION IN ('GE','GEN') AND NUMERO_FE = C.NUMERO AND FOLIO = C.FOLIO AND ROWNUM = 1) AS POLIZA, NVL((SELECT SUM(IMPORTE_OPERACION) FROM ERP_SEGUI_DOCUMENTOS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO),0) AS IMPORTE_OPERACION,(SELECT DISTINCT T_OPERACION FROM ERP_SEGUI_DOCUMENTOS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO AND ROWNUM = 1) AS TIPO_OPERACION, (SELECT DISTINCT BANCO FROM ERP_SEGUI_DOCUMENTOS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO AND ROWNUM = 1) AS BANCO,NVL((SELECT SUM(TOT_PESOS) FROM ERP_SEGUI_DOCUMENTOS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO),0) AS TOT_PESOS, C.COMPANIA, C.NUMERO, C.FOLIO, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA, C.SUBTOTAL, C.TOTAL, NVL(C.TIPO_CAMBIO,1) AS TIPO_CAMBIO,NVL((SELECT MONEDA_SAT FROM ERP_CFDI_MONEDAS WHERE MONEDA = C.MONEDA),'MXN') AS MONEDA, C.UUID, NVL(C.PAGO_ACUMULADO_CXP,0) AS PAGO_CXP, TO_CHAR(C.FECHA_PAGO_CXP,'DD/MM/YYYY') AS FECHA_PAGO_CXP, C.ESTATUS_CXP, E.NOMBRE, E.RFC FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND (((SELECT M.RFC FROM ERP_FE_EMISOR M WHERE M.COMPANIA = C.COMPANIA AND M.NUMERO = C.NUMERO) = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = C.COMPANIA) AND C.TIPO_DE_COMPROBANTE IN ('egreso','E')) OR ((SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO) =(SELECT RFC FROM COMPANIAS WHERE COMPANIA = C.COMPANIA) AND C.TIPO_DE_COMPROBANTE IN ('ingreso','I'))) AND TO_NUMBER(TO_CHAR(C.FECHA,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(C.FECHA,'MM')) <= TO_NUMBER('[periodo_fin]') AND TO_NUMBER(TO_CHAR(C.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND (C.ESTATUS_CXP NOT IN ('CANF') OR C.ESTATUS_CXP IS NULL) ORDER BY C.ESTATUS_CXP,C.NUMERO 
BuscaPagosDet = SELECT CAST('CXP' as VARCHAR2(100) ) AS ORIGEN,S.ID_TRANSACCION,S.CUENTA_BANCO,NVL(S.PARIDAD,0) AS PARIDAD_DET, S.COMPANIA AS COMPANIA_DET,S.OBSERVACIONES AS OBSERVACIONES_DET, S.NUMERO_FE AS NUMERO_FE_DET, S.FOLIO AS FOLIO_DET, S.SEC AS SEC_DET, S.USUARIO AS USUARIO_DET, S.T_OPERACION AS T_OPERACION_DET, S.IMPORTE_OPERACION AS IMPORTE_OPERACION_DET, S.BANCO AS BANCO_DET,(SELECT NOMBRE FROM ERP_SAT_BANCOS WHERE CLAVE = S.BANCO) AS NOM_BANCO, TO_CHAR(S.FECHA_PAGO_CXP_FE,'DD/MM/YYYY') AS FECHA_PAGO_CXP_FE_DET, S.TOT_PESOS AS TOT_PESOS_DET FROM ERP_SEGUI_DOCUMENTOS S WHERE S.COMPANIA = '[compania]' AND S.NUMERO_FE = '[numero_fact]' ORDER BY S.SEC

BuscaPagosCXC = SELECT (SELECT P.TIPO_POL FROM ERP_POLIZASXPAGOS P WHERE P.COMPANIA = C.COMPANIA AND P.NUMERO_FE = C.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS TIPO_POLIZA_PAGO, (SELECT P.NUMERO_POL FROM ERP_POLIZASXPAGOS P WHERE P.COMPANIA = C.COMPANIA AND P.NUMERO_FE = C.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS NUMERO_POL_PAGO, (SELECT TO_CHAR (P.FECHA_POL, 'DD/MM/YYYY') FROM ERP_POLIZASXPAGOS P WHERE  P.COMPANIA = C.COMPANIA AND P.NUMERO_FE = C.NUMERO AND P.OPERACION = 'GE' AND ROWNUM = 1) AS FECHA_POL_PAGO,(SELECT NUMERO_POL FROM ERP_POLIZASXPAGOS WHERE COMPANIA = C.COMPANIA AND OPERACION IN ('GE','GEN') AND NUMERO_FE = C.NUMERO AND FOLIO = C.FOLIO AND ROWNUM = 1) AS POLIZA, NVL((SELECT SUM(IMPORTE_OPERACION) FROM ERP_SEGUI_DOCUMENTOS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO),0) AS IMPORTE_OPERACION,(SELECT DISTINCT T_OPERACION FROM ERP_SEGUI_DOCUMENTOS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO AND ROWNUM = 1) AS TIPO_OPERACION, (SELECT DISTINCT BANCO FROM ERP_SEGUI_DOCUMENTOS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO AND ROWNUM = 1) AS BANCO,NVL((SELECT SUM(TOT_PESOS) FROM ERP_SEGUI_DOCUMENTOS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO),0) AS TOT_PESOS, C.COMPANIA, C.NUMERO, C.FOLIO, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA, C.SUBTOTAL, C.TOTAL, NVL(C.TIPO_CAMBIO,1) AS TIPO_CAMBIO,NVL((SELECT MONEDA_SAT FROM ERP_CFDI_MONEDAS WHERE MONEDA = C.MONEDA),'MXN') AS MONEDA, C.UUID, NVL(C.PAGO_ACUMULADO_CXP,0) AS PAGO_CXP, TO_CHAR(C.FECHA_PAGO_CXP,'DD/MM/YYYY') AS FECHA_PAGO_CXP, C.ESTATUS_CXP, E.NOMBRE, E.RFC FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND (((SELECT M.RFC FROM ERP_FE_EMISOR M WHERE M.COMPANIA = C.COMPANIA AND M.NUMERO = C.NUMERO) = (SELECT RFC FROM COMPANIAS WHERE COMPANIA = C.COMPANIA) AND C.TIPO_DE_COMPROBANTE IN ('ingreso','I')) OR ((SELECT E.RFC FROM ERP_FE_RECEPTOR E WHERE E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO) =(SELECT RFC FROM COMPANIAS WHERE COMPANIA = C.COMPANIA) AND C.TIPO_DE_COMPROBANTE IN ('egreso','E'))) AND TO_NUMBER(TO_CHAR(C.FECHA,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(C.FECHA,'MM')) <= TO_NUMBER('[periodo_fin]') AND TO_NUMBER(TO_CHAR(C.FECHA,'YYYY')) = TO_NUMBER('[calendario]') AND (C.ESTATUS_CXP NOT IN ('CANF') OR C.ESTATUS_CXP IS NULL) ORDER BY C.ESTATUS_CXP,C.NUMERO 
BuscaPagosDetCXC = SELECT CAST('CXC' as VARCHAR2(100) )  AS ORIGEN, S.ID_TRANSACCION,S.CUENTA_BANCO,NVL(S.PARIDAD,0) AS PARIDAD_DET, S.COMPANIA AS COMPANIA_DET,S.OBSERVACIONES AS OBSERVACIONES_DET, S.NUMERO_FE AS NUMERO_FE_DET, S.FOLIO AS FOLIO_DET, S.SEC AS SEC_DET, S.USUARIO AS USUARIO_DET, S.T_OPERACION AS T_OPERACION_DET, S.IMPORTE_OPERACION AS IMPORTE_OPERACION_DET, S.BANCO AS BANCO_DET,(SELECT NOMBRE FROM ERP_SAT_BANCOS WHERE CLAVE = S.BANCO) AS NOM_BANCO, TO_CHAR(S.FECHA_PAGO_CXP_FE,'DD/MM/YYYY') AS FECHA_PAGO_CXP_FE_DET, S.TOT_PESOS AS TOT_PESOS_DET FROM ERP_SEGUI_DOCUMENTOS S WHERE S.COMPANIA = '[compania]' AND S.NUMERO_FE = '[numero_fact]' ORDER BY S.SEC


#Otras Pagos

BuscaPagosOtras=SELECT C.COMPANIA,C.ID AS NUMERO, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA, C.BENEFICIARIO AS NOMBRE,C.RFC,C.MONEDA,C.IMPORTE AS SUBTOTAL,C.TOTAL,C.ESTATUS_CXP FROM ERP_CP_OTRAS C WHERE C.COMPANIA = '[compania]' AND TO_NUMBER (TO_CHAR (C.FECHA, 'MM')) >= TO_NUMBER ('[periodo]') AND TO_NUMBER (TO_CHAR (C.FECHA, 'MM')) <= TO_NUMBER ('[periodo_fin]') AND TO_NUMBER (TO_CHAR (C.FECHA, 'YYYY')) = TO_NUMBER ('[calendario]') AND (C.ESTATUS_CXP NOT IN ('CANF') OR C.ESTATUS_CXP IS NULL)
BuscaFechaSystema2Otras = SELECT TO_CHAR(NVL(MAX(C.FECHA),SYSDATE),'MM') AS PERIODO,TO_CHAR(NVL(MAX(C.FECHA),SYSDATE),'YYYY') AS CALENDARIO FROM ERP_CP_OTRAS C WHERE C.COMPANIA = '[compania]'
EstatusPagoOtras = SELECT SUM(S.IMPORTE_OPERACION) AS IMPORTE, SUM(S.TOT_PESOS) AS IMPORTE_PESOS, (C.TOTAL - SUM(S.IMPORTE_OPERACION)) AS TOTAL_A_PAGAR FROM ERP_SEGUI_DOCUMENTOS S, ERP_CP_OTRAS C WHERE S.COMPANIA = '[compania]' AND S.NUMERO_FE = '[numero]' AND C.COMPANIA = S.COMPANIA AND C.ID = S.NUMERO_FE GROUP BY TOTAL 
BuscaPagosOtrasDet = SELECT S.CUENTA_BANCO,NVL(S.PARIDAD,0) AS PARIDAD_DET, S.COMPANIA AS COMPANIA_DET,S.OBSERVACIONES AS OBSERVACIONES_DET, S.NUMERO_FE AS NUMERO_FE_DET, S.FOLIO AS FOLIO_DET, S.SEC AS SEC_DET, S.USUARIO AS USUARIO_DET, S.T_OPERACION AS T_OPERACION_DET, S.IMPORTE_OPERACION AS IMPORTE_OPERACION_DET, S.BANCO AS BANCO_DET,(SELECT NOMBRE FROM ERP_SAT_BANCOS WHERE CLAVE = S.BANCO) AS NOM_BANCO, TO_CHAR(S.FECHA_PAGO_CXP_FE,'DD/MM/YYYY') AS FECHA_PAGO_CXP_FE_DET, S.TOT_PESOS AS TOT_PESOS_DET FROM ERP_SEGUI_DOCUMENTOS S WHERE S.COMPANIA = '[compania]' AND S.NUMERO_FE = '[numero_fact]' AND T_DOC = 'OTR' ORDER BY S.SEC
ActualizaEstatusPagoOtras = SELECT ESTATUS_CXP FROM ERP_CP_OTRAS WHERE COMPANIA = '[compania]' AND ID = '[numero]'
TotalesPagosOtras = SELECT NVL(SUM(D.IMPORTE_OPERACION),0) AS PAGO, C.TOTAL FROM ERP_SEGUI_DOCUMENTOS D, ERP_CP_OTRAS C WHERE C.COMPANIA = '[compania]' AND C.ID = '[numero]' AND D.NUMERO_FE = C.ID AND D.COMPANIA = C.COMPANIA GROUP BY C.TOTAL


FindMetPagosDet = SELECT CLAVE, CONCEPTO FROM ERP_SAT_MET_PAGOS

BuscaBancoSatPagos = SELECT C.CUENTA_BANCO,B.CLAVE, C.NOMBRE, B.CLAVE ||'-'|| C.NOMBRE AS NOMBRE1 FROM ERP_SAT_BANCOS B, ERP_CAT_BANCO C  WHERE C.BANCO_SAT = B.CLAVE AND C.COMPANIA = '[compania]' AND C.ESTATUS = '0' AND  (B.CLAVE like RTRIM('[query]%') OR upper(B.NOMBRE) like upper('%[query]%'))

TotalesPagos = SELECT NVL(SUM(D.IMPORTE_OPERACION),0) AS PAGO, C.TOTAL FROM ERP_SEGUI_DOCUMENTOS D, ERP_FE_COMPROBANTES C WHERE C.COMPANIA = '[compania]' AND C.NUMERO = '[numero]' AND D.NUMERO_FE = C.NUMERO AND D.COMPANIA = C.COMPANIA GROUP BY C.TOTAL
ActualizaEstatusPago = SELECT ESTATUS_CXP FROM ERP_FE_COMPROBANTES WHERE COMPANIA = '[compania]' AND NUMERO = '[numero]'
EstatusPago = SELECT SUM(S.IMPORTE_OPERACION) AS IMPORTE, SUM(S.TOT_PESOS) AS IMPORTE_PESOS, (C.TOTAL - SUM(S.IMPORTE_OPERACION)) AS TOTAL_A_PAGAR FROM ERP_SEGUI_DOCUMENTOS S, ERP_FE_COMPROBANTES C WHERE S.COMPANIA = '[compania]' AND S.NUMERO_FE = '[numero]' AND C.COMPANIA = S.COMPANIA AND C.NUMERO = S.NUMERO_FE GROUP BY TOTAL 

ACTUALIZA_PAGOS = BEGIN ESTATUS_PAGOS('[compania]'); END;
BuscaMonedaPagos = SELECT CODIGO, MONEDA, CODIGO ||'-'|| MONEDA AS NOMBRE FROM ERP_SAT_MONEDAS WHERE (CODIGO like RTRIM('[query]%') OR upper(MONEDA) like upper('%[query]%'))

BuscaExisteRfcCompania = SELECT RFC FROM COMPANIAS WHERE COMPANIA = '[compania]' and RFC = '[rfc]'

#RIA CEDULAS
BuscaCedula= SELECT COMPANIA, CEDULA, NOMBRE, DESCRIPCION  FROM AU_CEDULAS WHERE COMPANIA='[compania]'
BuscaRenglonesDetCedula=SELECT MAX(RENGLON) AS RENGLON FROM AU_CEDULAS_DET WHERE COMPANIA = '[compania]' AND CEDULA = '[cedula]'
BuscaDetCedula = SELECT COMPANIA, CEDULA, RENGLON, COLUMNA, CAMPO FROM AU_CEDULAS_DET WHERE COMPANIA = '[compania]' AND CEDULA = '[cedula]' ORDER BY RENGLON, COLUMNA

#RIA CONCILIACION
CONC_BuscaAuxiliar=SELECT D.COMPANIA,D.FECHA,D.NUMERO,D.TIPO_POLIZA,D.SEC,D.CUENTA,D.CARGOS,D.ABONOS,'' AS ESTATUS FROM DET_POLIZAS D WHERE D.COMPANIA = '[compania]' ORDER BY 1,2,3,4

CopiaCedula=INSERT INTO AU_CEDULAS_DET (COMPANIA,CEDULA,RENGLON,COLUMNA,CAMPO) SELECT COMPANIA, '[cedula_nueva]',RENGLON, COLUMNA, CAMPO FROM AU_CEDULAS_DET WHERE COMPANIA = '[compania]' AND CEDULA = '[cedula]'
BuscaDatosCopiCedula=SELECT COMPANIA, CEDULA, NOMBRE, DESCRIPCION FROM AU_CEDULAS WHERE COMPANIA = '[compania]' AND CEDULA = '[cedula_nueva]'


BuscaPolRelCFDI = select F.COMPANIA as COMPANIA_REL, F.NUMERO_POL AS NUM_POL_REL, TO_CHAR(F.FECHA_POL,'DD/MM/YYYY') AS FECHA_POL_REL, F.TIPO_POL AS TIPO_POL_REL, P.NOMBRE AS NOMBRE_REL, P.CARGOS AS CARGOS_REL, P.ABONOS AS ABONOS_REL from erp_polizasxfacturas F, POLIZAS P where F.compania = '[compania]' AND F.NUMERO_FE = [numero_fe] AND P.COMPANIA = F.COMPANIA AND P.NUMERO = F.NUMERO_POL AND P.TIPO_POLIZA = F.TIPO_POL AND P.FECHA = F.FECHA_POL ORDER BY F.NUMERO_POL, F.FECHA_POL

BuscaPolRelPagosCFDI = select F.COMPANIA as COMPANIA_REL_PAGOS, F.NUMERO_POL AS NUM_POL_REL_PAGOS, TO_CHAR(F.FECHA_POL,'DD/MM/YYYY') AS FECHA_POL_REL_PAGOS, F.TIPO_POL AS TIPO_POL_REL_PAGOS, P.NOMBRE AS NOMBRE_REL_PAGOS, P.CARGOS AS CARGOS_REL_PAGOS, P.ABONOS AS ABONOS_REL_PAGOS from erp_polizasxpagos F, POLIZAS P where F.compania = '[compania]' AND F.NUMERO_FE = [numero_fe] AND P.COMPANIA = F.COMPANIA AND P.NUMERO = F.NUMERO_POL AND P.TIPO_POLIZA = F.TIPO_POL AND P.FECHA = F.FECHA_POL ORDER BY F.NUMERO_POL, F.FECHA_POL


#CUENTAS ORDEN
VerificaCuentasOrden = with a as(SELECT COUNT(*) CUENTA_ORD, COMPANIA, NUMERO, TIPO_POLIZA, FECHA FROM DET_POLIZAS D, CUENTAS C WHERE D.COMPANIA = '[compania]' AND D.FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND D.NUMERO = '[numero]' AND D.TIPO_POLIZA = '[tipo_poliza]' AND C.ESTRUCTURA = D.COMPANIA AND C.CUENTA = D.CUENTA AND C.TIPO = 'O' GROUP BY COMPANIA, NUMERO, TIPO_POLIZA, FECHA),b as(SELECT COUNT(*) CUENTA, COMPANIA, NUMERO, TIPO_POLIZA, FECHA FROM DET_POLIZAS D, CUENTAS C WHERE D.COMPANIA = '[compania]' AND FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND D.NUMERO = '[numero]' AND D.TIPO_POLIZA = '[tipo_poliza]' AND C.ESTRUCTURA = D.COMPANIA AND C.CUENTA = D.CUENTA AND C.TIPO <> 'O' GROUP BY COMPANIA, NUMERO, TIPO_POLIZA, FECHA) select a.CUENTA_ORD, b.CUENTA FROM a, b where a.compania = b.compania and a.tipo_poliza = b.tipo_poliza and a.numero = b.numero and a.fecha = b.fecha

#tesoreria
#validaFolioTes = SELECT DISTINCT F.FOLIO FROM ERP_FE_COMPROBANTES C, ERP_CXP_FOLIOS F WHERE C.COMPANIA = '[compania]' AND F.COMPANIA = C.COMPANIA AND C.ORIGEN = 'CP' AND C.FOLIO_PAGOS IS NOT NULL AND C.ESTATUS_CXP = 'FG' AND F.OPERACION = 'FG' AND F.FOLIO = C.FOLIO_PAGOS AND F.FOLIO = [folio] AND F.NUMERO_FE = C.NUMERO
validaFolioTes=SELECT DISTINCT FOLIO FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND OPERACION = 'FG' AND FOLIO = '[folio]'
buscaEmpleadosTes=SELECT NOMBRE, RFC FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND ORIGEN = 'P' AND UPPER(NOMBRE) LIKE UPPER('%[query]%') AND RFC LIKE '%' || NVL((SELECT E.RFC FROM VI_EMPLEADO_AUT A, EMPLEADOS E WHERE A.COMPANIA = '[compania]' AND A.EMPLEADO = '[usuario]' AND E.NUM_EMPLEADO = A.EMPLEADO AND ROWNUM = 1 AND A.ESTATUS = 'I'),'') || '%' ORDER BY NOMBRE
#BuscaFoliosETesoreria = SELECT DISTINCT F.FOLIO FROM ERP_FE_COMPROBANTES C, ERP_CXP_FOLIOS F WHERE C.COMPANIA = '[compania]' AND F.COMPANIA = C.COMPANIA AND C.ORIGEN = 'CP' AND C.FOLIO_PAGOS IS NOT NULL AND C.ESTATUS_CXP = 'FG' AND F.OPERACION = 'FG' AND F.FOLIO = C.FOLIO_PAGOS AND F.NUMERO_FE = C.NUMERO
BuscaFoliosETesoreria=SELECT DISTINCT FOLIO FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND OPERACION = 'FG'
#BuscaFoliosETesoreriaCAN = SELECT DISTINCT F.FOLIO FROM ERP_FE_COMPROBANTES C, ERP_CXP_FOLIOS F WHERE C.COMPANIA = '[compania]' AND F.COMPANIA = C.COMPANIA AND C.ORIGEN = 'CP' AND C.FOLIO_PAGOS IS NOT NULL AND C.ESTATUS_CXP = 'CAN' AND F.OPERACION = 'CAN' AND F.FOLIO = C.FOLIO_PAGOS AND F.NUMERO_FE = C.NUMERO
BuscaFoliosETesoreriaCAN=WITH A AS(SELECT DISTINCT F.FOLIO FROM ERP_FE_COMPROBANTES C, ERP_CXP_FOLIOS F WHERE C.COMPANIA = '[compania]' AND F.COMPANIA = C.COMPANIA AND C.ORIGEN = 'CP' AND C.FOLIO_PAGOS IS NOT NULL AND C.ESTATUS_CXP = 'CAN' AND F.OPERACION = 'CAN' AND F.FOLIO = C.FOLIO_PAGOS AND F.NUMERO_FE = C.NUMERO AND F.ORIGEN = 'F' UNION SELECT DISTINCT F.FOLIO FROM ERP_CP_OTRAS O, ERP_CXP_FOLIOS F WHERE O.COMPANIA = '[compania]' AND F.COMPANIA = O.COMPANIA AND O.ID = F.NUMERO_FE AND  O.FOLIO_PAGOS = F.FOLIO AND O.ESTATUS_CXP = F.OPERACION AND F.ORIGEN = 'O'  AND F.OPERACION = 'CAN' UNION SELECT DISTINCT F.FOLIO FROM VI_COMISIONES V,ERP_CXP_FOLIOS F WHERE V.COMPANIA = '[compania]' AND V.COMPANIA = F.COMPANIA AND V.COMISION = F.NUMERO_FE AND V.FOLIO_PAGO = F.FOLIO AND V.ESTATUS = F.OPERACION AND F.OPERACION = 'CAN') SELECT DISTINCT A.FOLIO FROM A
#BuscaDatosTesoreria = SELECT NVL(C.PAGO_ACUMULADO_CXP,0) AS PAGO_ACUMULADO_CXP_TES, (CASE WHEN C.ESTATUS_CXP = 'PAR' THEN TO_CHAR((C.PAGO_ACUMULADO_CXP * 100)/C.TOTAL) ELSE CAST('100' as VARCHAR2(100) ) END) AS PORCENTAJE_PAGO_TES, (CASE WHEN C.ESTATUS_CXP = 'PAR' THEN (C.TOTAL - NVL((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0)) - C.PAGO_ACUMULADO_CXP ELSE (C.TOTAL - NVL((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0)) END) as TOTAL_PAGAR_TES,(CASE WHEN C.ESTATUS_CXP = 'PAR' THEN CAST('PAR' as VARCHAR2(100) ) ELSE CAST('PAG' as VARCHAR2(100) ) END) AS TIPO_PAGO_TES,'F' AS ORIGEN, C.COMPANIA as COMPANIA_TES,C.NUMERO as NUMERO_TES,C.FOLIO as FOLIO_TES, C.TOTAL - NVL((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0) as TOTAL_TES,TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_TES,E.NOMBRE as NOMBRE_EMISOR_TES,E.RFC as RFC_EMISOR_TES,NVL((SELECT NOMBRE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as NOMBRE_PROV_TES,NVL((SELECT RFC FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as RFC_PROV_TES,NVL((SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as BANCO_PROV,NVL((SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as CTA_CLABE_PROV,NVL((SELECT MONEDA_SAT FROM ERP_CFDI_MONEDAS WHERE MONEDA = C.MONEDA),'N/A') as MONEDA_TES, NVL(C.MONEDA_PAGO,'N/A') AS MONEDA_PAGO_TES, NVL((SELECT CIE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') AS CIE, NVL((SELECT PAGO_CIE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'') AS PAGO_CIE,  NVL((SELECT REFERENCIA_CIE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'') AS REFERENCIA_CIE, C.PAGO_CIE AS PAGO_CIE_COMPROBANTES, C.REFERENCIA_CIE AS REFERENCIA_CIE_COMPROBANTES FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E  WHERE C.COMPANIA = '[compania]' AND C.NUMERO = '[numero]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO
BuscaDatosTesoreria = SELECT NVL(C.PAGO_ACUMULADO_CXP,0) AS PAGO_ACUMULADO_CXP_TES, (CASE WHEN C.ESTATUS_CXP = 'PAR' THEN TO_CHAR(100 - ((C.PAGO_ACUMULADO_CXP * 100)/C.TOTAL)) ELSE CAST('100' as VARCHAR2(100) ) END) AS PORCENTAJE_PAGO_TES, (CASE WHEN C.ESTATUS_CXP = 'PAR' THEN (C.TOTAL - C.PAGO_ACUMULADO_CXP) ELSE (C.TOTAL - NVL((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0)) END) as TOTAL_PAGAR_TES,'F' AS ORIGEN, C.COMPANIA as COMPANIA_TES,C.NUMERO as NUMERO_TES,C.FOLIO as FOLIO_TES, C.TOTAL as TOTAL_TES,TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_TES,E.NOMBRE as NOMBRE_EMISOR_TES,E.RFC as RFC_EMISOR_TES,NVL((SELECT NOMBRE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as NOMBRE_PROV_TES,NVL((SELECT RFC FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as RFC_PROV_TES,NVL((SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as BANCO_PROV,NVL((SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as CTA_CLABE_PROV,NVL ((SELECT NUMERO_CUENTA FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') AS NUMERO_CUENTA_PROV,NVL ((SELECT CUENTA_VALIDA FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') AS CUENTA_VALIDA_PROV,NVL((SELECT MONEDA_SAT FROM ERP_CFDI_MONEDAS WHERE MONEDA = C.MONEDA),'N/A') as MONEDA_TES, NVL(C.MONEDA_PAGO,'N/A') AS MONEDA_PAGO_TES, NVL((SELECT CIE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') AS CIE, NVL((SELECT PAGO_CIE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'') AS PAGO_CIE,  NVL((SELECT REFERENCIA_CIE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'') AS REFERENCIA_CIE, C.PAGO_CIE AS PAGO_CIE_COMPROBANTES, C.REFERENCIA_CIE AS REFERENCIA_CIE_COMPROBANTES FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E  WHERE C.COMPANIA = '[compania]' AND C.NUMERO = '[numero]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO

#BuscaDatosTesoreriaCAN = SELECT 'F' AS ORIGEN, C.COMPANIA as COMPANIA_TES,C.NUMERO as NUMERO_TES,C.FOLIO as FOLIO_TES, C.TOTAL as TOTAL_TES,TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_TES,E.NOMBRE as NOMBRE_EMISOR_TES,E.RFC as RFC_EMISOR_TES,NVL((SELECT NOMBRE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as NOMBRE_PROV_TES,NVL((SELECT RFC FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as RFC_PROV_TES,NVL((SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as BANCO_PROV,NVL((SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as CTA_CLABE_PROV,NVL((SELECT MONEDA_SAT FROM ERP_CFDI_MONEDAS WHERE MONEDA = C.MONEDA),'N/A') as MONEDA_TES, NVL(C.MONEDA_PAGO,'N/A') AS MONEDA_PAGO_TES, NVL((SELECT CIE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') AS CIE, NVL((SELECT PAGO_CIE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'') AS PAGO_CIE,  NVL((SELECT REFERENCIA_CIE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'') AS REFERENCIA_CIE, C.PAGO_CIE AS PAGO_CIE_COMPROBANTES, C.REFERENCIA_CIE AS REFERENCIA_CIE_COMPROBANTES FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E  WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND C.ESTATUS_CXP IS NOT NULL AND C.ESTATUS_CXP = 'CAN' AND C.FOLIO_PAGOS = '[folio]' AND C.FOLIO_PAGOS IN (SELECT FOLIO FROM ERP_CXP_FOLIOS WHERE COMPANIA = C.COMPANIA AND FOLIO = C.FOLIO_PAGOS AND NUMERO_FE = C.NUMERO AND OPERACION = 'CAN')
BuscaDatosTesoreriaCAN=WITH A AS(SELECT 'F' AS ORIGEN, C.COMPANIA as COMPANIA_TES,C.NUMERO as NUMERO_TES,C.FOLIO as FOLIO_TES, C.TOTAL - NVL((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0) as TOTAL_TES,TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_TES,E.NOMBRE as NOMBRE_EMISOR_TES,E.RFC as RFC_EMISOR_TES,NVL((SELECT NOMBRE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as NOMBRE_PROV_TES,NVL((SELECT RFC FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as RFC_PROV_TES,NVL((SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as BANCO_PROV,NVL((SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') as CTA_CLABE_PROV,NVL((SELECT MONEDA_SAT FROM ERP_CFDI_MONEDAS WHERE MONEDA = C.MONEDA),'N/A') as MONEDA_TES, NVL(C.MONEDA_PAGO,'N/A') AS MONEDA_PAGO_TES, NVL((SELECT CIE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') AS CIE, NVL((SELECT PAGO_CIE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'') AS PAGO_CIE,  NVL((SELECT REFERENCIA_CIE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'') AS REFERENCIA_CIE, C.PAGO_CIE AS PAGO_CIE_COMPROBANTES, C.REFERENCIA_CIE AS REFERENCIA_CIE_COMPROBANTES FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E  WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND C.ESTATUS_CXP IS NOT NULL AND C.ESTATUS_CXP = 'CAN' AND C.FOLIO_PAGOS = '[folio]' AND C.FOLIO_PAGOS IN (SELECT FOLIO FROM ERP_CXP_FOLIOS WHERE COMPANIA = C.COMPANIA AND FOLIO = C.FOLIO_PAGOS AND NUMERO_FE = C.NUMERO AND OPERACION = 'CAN') UNION SELECT 'O' AS ORIGEN,T.COMPANIA AS COMPANIA_TES, T.ID AS NUMERO_TES, '' AS FOLIO_TES, T.TOTAL AS TOTAL_TES, TO_CHAR(T.FECHA,'DD/MM/YYYY') AS FECHA_TES, T.BENEFICIARIO as NOMBRE_EMISOR_TES, T.RFC as RFC_EMISOR_TES, NVL((SELECT NOMBRE FROM ERP_CCLIENTES WHERE COMPANIA = T.COMPANIA AND ORIGEN = 'P' AND RFC = T.RFC AND ROWNUM = 1),'N/A') as NOMBRE_PROV_TES,NVL((SELECT RFC FROM ERP_CCLIENTES WHERE COMPANIA = T.COMPANIA AND ORIGEN = 'P' AND RFC = T.RFC AND ROWNUM = 1),'N/A') as RFC_PROV_TES,NVL((SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = T.COMPANIA AND ORIGEN = 'P' AND RFC = T.RFC AND ROWNUM = 1),'N/A') as BANCO_PROV,NVL((SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = T.COMPANIA AND ORIGEN = 'P' AND RFC = T.RFC AND ROWNUM = 1),'N/A') as CTA_CLABE_PROV,T.MONEDA as MONEDA_TES, T.MONEDA AS MONEDA_PAGO_TES, 'N/A' AS CIE, 0 AS PAGO_CIE,  '' AS REFERENCIA_CIE, 0 AS PAGO_CIE_COMPROBANTES, '' AS REFERENCIA_CIE_COMPROBANTES  FROM ERP_CP_OTRAS T, ERP_CXP_FOLIOS F WHERE T.COMPANIA = '[compania]' AND F.COMPANIA = T.COMPANIA AND T.ID = F.NUMERO_FE AND  T.FOLIO_PAGOS = F.FOLIO AND T.ESTATUS_CXP = F.OPERACION AND F.ORIGEN = 'O'  AND F.OPERACION = 'CAN' AND T.FOLIO_PAGOS = '[folio]' UNION SELECT 'V' AS ORIGEN,V.COMPANIA AS COMPANIA_TES,V.COMISION AS NUMERO_TES, '' AS FOLIO_TES,V.IMPORTE AS TOTA_TES,TO_CHAR(F_INI_COMISION,'DD/MM/YYYY') AS FECHA_TES, E.NOMBRE AS NOMBRE_EMISOR_TES, E.RFC AS RFC_EMISOR_TES, E.NOMBRE AS NOMBRE_PROV_TES, E.RFC AS RFC_PROV_TES, NVL(E.BANCO,'N/A') AS BANCO_PROV, NVL(E.CUENTA_CLABE,'N/A') AS CTA_CLABE_PROV, 'MXN' AS MONEDA_TES, 'MXN' AS MONEDA_PAGO_TES,'N/A' AS CIE,0 AS PAGO_CIE,'' AS REFERENCIA_CIE,0 AS PAGO_CIE_COMPROBANTES,'' AS REFERENCIA_CIE_COMPROBANTES FROM VI_COMISIONES V,EMPLEADOS E, ERP_CXP_FOLIOS F WHERE V.COMPANIA = '[compania]' AND E.NUM_EMPLEADO = V.EMPLEADO AND F.COMPANIA = V.COMPANIA AND V.COMISION = F.NUMERO_FE AND V.ESTATUS = F.OPERACION AND F.ORIGEN = 'V' AND F.OPERACION = 'CAN' AND V.FOLIO_PAGO = '[folio]')SELECT DISTINCT * FROM A ORDER BY A.ORIGEN, A.NUMERO_TES
#BuscaFoliosGenerados=SELECT F.COMPANIA AS COMPANIA_FOL, F.FOLIO AS FOLIO_FOL, F.NUMERO_FE AS NUMERO_FOL, C.FOLIO AS FOLIO_FACT_FOL, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_FACT_FOL, C.TOTAL AS TOTAL_FACT_FOL, E.NOMBRE AS NOMBRE_FOL, E.RFC AS RFC_FOL, F.OPERACION AS ESTATUS_FOL  FROM ERP_CXP_FOLIOS F, ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E  WHERE F.COMPANIA = '[compania]' AND C.COMPANIA = F.COMPANIA AND F.NUMERO_FE = C.NUMERO AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND F.FOLIO = [folio] ORDER BY C.FECHA, C.NUMERO
#BuscaFoliosGenerados=WITH A AS(SELECT COMPANIA, FOLIO, NUMERO_FE, ORIGEN FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND FOLIO = [folio]),B AS(SELECT F.ORIGEN AS ORIGEN_FOL,F.COMPANIA AS COMPANIA_FOL, F.FOLIO AS FOLIO_FOL, F.NUMERO_FE AS NUMERO_FOL, C.FOLIO AS FOLIO_FACT_FOL, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_FACT_FOL, C.TOTAL AS TOTAL_FACT_FOL, E.NOMBRE AS NOMBRE_FOL, E.RFC AS RFC_FOL, F.OPERACION AS ESTATUS_FOL  FROM ERP_CXP_FOLIOS F, ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E, A  WHERE F.COMPANIA = A.COMPANIA AND C.COMPANIA = F.COMPANIA AND F.NUMERO_FE = A.NUMERO_FE AND  F.NUMERO_FE = C.NUMERO AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND F.FOLIO = A.FOLIO AND F.ORIGEN = A.ORIGEN AND A.ORIGEN = 'F' ORDER BY C.FECHA, C.NUMERO),C AS (SELECT C.ORIGEN AS ORIGEN_FOL,O.COMPANIA AS COMPANIA_FOL, O.FOLIO_PAGOS AS FOLIO_FOL, O.ID AS NUMERO_FOL, '' AS FOLIO_FACT_FOL, TO_CHAR(O.FECHA, 'DD/MM/YYYY') AS FECHA_FACT_FOL,O.TOTAL AS TOTAL_FACT_FOL, O.BENEFICIARIO AS NOMBRE_FOL, O.RFC AS RFC_FOL, C.OPERACION AS ESTATUS_FOL  FROM ERP_CP_OTRAS O, ERP_CXP_FOLIOS C, A WHERE O.COMPANIA = A.COMPANIA AND A.COMPANIA = O.COMPANIA AND O.ID = A.NUMERO_FE AND C.NUMERO_FE = O.ID AND C.FOLIO = A.FOLIO AND C.ORIGEN = 'O' ORDER BY O.FECHA, O.ID)SELECT B.COMPANIA_FOL, B.FOLIO_FOL, B.NUMERO_FOL, B.FOLIO_FACT_FOL, B.FECHA_FACT_FOL, B.TOTAL_FACT_FOL, B.NOMBRE_FOL, B.RFC_FOL, B.ESTATUS_FOL, B.ORIGEN_FOL FROM B UNION SELECT C.COMPANIA_FOL, C.FOLIO_FOL, C.NUMERO_FOL, C.FOLIO_FACT_FOL, C.FECHA_FACT_FOL, C.TOTAL_FACT_FOL, C.NOMBRE_FOL, C.RFC_FOL, C.ESTATUS_FOL, C.ORIGEN_FOL FROM C ORDER BY ORIGEN_FOL
#BuscaFoliosGenerados=WITH A AS (SELECT COMPANIA, FOLIO, NUMERO_FE, ORIGEN FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND FOLIO = [folio]),B AS(SELECT F.ORIGEN AS ORIGEN_FOL,F.COMPANIA AS COMPANIA_FOL, F.FOLIO AS FOLIO_FOL, F.NUMERO_FE AS NUMERO_FOL, C.FOLIO AS FOLIO_FACT_FOL, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_FACT_FOL, C.TOTAL - NVL((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0) AS TOTAL_FACT_FOL, E.NOMBRE AS NOMBRE_FOL, E.RFC AS RFC_FOL, F.OPERACION AS ESTATUS_FOL,(SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = E.RFC AND ORIGEN = 'P') AS CUENTA_CLABE_FOL,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = E.RFC AND ORIGEN = 'P') AS BANCO_FOL   FROM ERP_CXP_FOLIOS F, ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E, A  WHERE F.COMPANIA = A.COMPANIA AND C.COMPANIA = F.COMPANIA AND F.NUMERO_FE = A.NUMERO_FE AND  F.NUMERO_FE = C.NUMERO AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND F.FOLIO = A.FOLIO AND F.ORIGEN = A.ORIGEN AND A.ORIGEN = 'F' ORDER BY C.FECHA, C.NUMERO),C AS (SELECT C.ORIGEN AS ORIGEN_FOL,O.COMPANIA AS COMPANIA_FOL, O.FOLIO_PAGOS AS FOLIO_FOL, O.ID AS NUMERO_FOL, '' AS FOLIO_FACT_FOL, TO_CHAR(O.FECHA, 'DD/MM/YYYY') AS FECHA_FACT_FOL,O.TOTAL AS TOTAL_FACT_FOL, O.BENEFICIARIO AS NOMBRE_FOL, O.RFC AS RFC_FOL, C.OPERACION AS ESTATUS_FOL, (SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ORIGEN = 'P') AS CUENTA_CLABE_FOL,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ORIGEN = 'P') AS BANCO_FOL   FROM ERP_CP_OTRAS O, ERP_CXP_FOLIOS C, A WHERE O.COMPANIA = A.COMPANIA AND A.COMPANIA = O.COMPANIA AND O.ID = A.NUMERO_FE AND C.NUMERO_FE = O.ID AND C.FOLIO = A.FOLIO AND C.ORIGEN = 'O' ORDER BY O.FECHA, O.ID)SELECT B.COMPANIA_FOL, B.FOLIO_FOL, B.NUMERO_FOL, B.FOLIO_FACT_FOL, B.FECHA_FACT_FOL, B.TOTAL_FACT_FOL, B.NOMBRE_FOL, B.RFC_FOL, B.ESTATUS_FOL, B.ORIGEN_FOL, B.CUENTA_CLABE_FOL, B.BANCO_FOL FROM B UNION SELECT C.COMPANIA_FOL, C.FOLIO_FOL, C.NUMERO_FOL, C.FOLIO_FACT_FOL, C.FECHA_FACT_FOL, C.TOTAL_FACT_FOL, C.NOMBRE_FOL, C.RFC_FOL, C.ESTATUS_FOL, C.ORIGEN_FOL, C.CUENTA_CLABE_FOL, C.BANCO_FOL FROM C ORDER BY ORIGEN_FOL
#BuscaFoliosGenerados=WITH A AS (SELECT COMPANIA, FOLIO, NUMERO_FE, ORIGEN FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND FOLIO = [folio]),B AS(SELECT F.ORIGEN AS ORIGEN_FOL,F.COMPANIA AS COMPANIA_FOL, F.FOLIO AS FOLIO_FOL, F.NUMERO_FE AS NUMERO_FOL, C.FOLIO AS FOLIO_FACT_FOL, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_FACT_FOL, C.TOTAL - NVL((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0) AS TOTAL_FACT_FOL, E.NOMBRE AS NOMBRE_FOL, E.RFC AS RFC_FOL, F.OPERACION AS ESTATUS_FOL,(SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = E.RFC AND ORIGEN = 'P') AS CUENTA_CLABE_FOL,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = E.RFC AND ORIGEN = 'P') AS BANCO_FOL, C.PAGO_CIE AS PAGO_CIE_FOL, C.REFERENCIA_CIE AS REFERENCIA_CIE_FOL   FROM ERP_CXP_FOLIOS F, ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E, A  WHERE F.COMPANIA = A.COMPANIA AND C.COMPANIA = F.COMPANIA AND F.NUMERO_FE = A.NUMERO_FE AND  F.NUMERO_FE = C.NUMERO AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND F.FOLIO = A.FOLIO AND F.ORIGEN = A.ORIGEN AND A.ORIGEN = 'F' ORDER BY C.FECHA, C.NUMERO),C AS (SELECT C.ORIGEN AS ORIGEN_FOL,O.COMPANIA AS COMPANIA_FOL, O.FOLIO_PAGOS AS FOLIO_FOL, O.ID AS NUMERO_FOL, '' AS FOLIO_FACT_FOL, TO_CHAR(O.FECHA, 'DD/MM/YYYY') AS FECHA_FACT_FOL,O.TOTAL AS TOTAL_FACT_FOL, O.BENEFICIARIO AS NOMBRE_FOL, O.RFC AS RFC_FOL, C.OPERACION AS ESTATUS_FOL, (SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ORIGEN = 'P') AS CUENTA_CLABE_FOL,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ORIGEN = 'P') AS BANCO_FOL, NULL AS PAGO_CIE_FOL, '' AS REFERENCIA_CIE_FOL   FROM ERP_CP_OTRAS O, ERP_CXP_FOLIOS C, A WHERE O.COMPANIA = A.COMPANIA AND A.COMPANIA = O.COMPANIA AND O.ID = A.NUMERO_FE AND C.NUMERO_FE = O.ID AND C.FOLIO = A.FOLIO AND C.ORIGEN = 'O' ORDER BY O.FECHA, O.ID)SELECT B.COMPANIA_FOL, B.FOLIO_FOL, B.NUMERO_FOL, B.FOLIO_FACT_FOL, B.FECHA_FACT_FOL, B.TOTAL_FACT_FOL, B.NOMBRE_FOL, B.RFC_FOL, B.ESTATUS_FOL, B.ORIGEN_FOL, B.CUENTA_CLABE_FOL, B.BANCO_FOL, B.PAGO_CIE_FOL, B.REFERENCIA_CIE_FOL FROM B UNION SELECT C.COMPANIA_FOL, C.FOLIO_FOL, C.NUMERO_FOL, C.FOLIO_FACT_FOL, C.FECHA_FACT_FOL, C.TOTAL_FACT_FOL, C.NOMBRE_FOL, C.RFC_FOL, C.ESTATUS_FOL, C.ORIGEN_FOL, C.CUENTA_CLABE_FOL, C.BANCO_FOL, C.PAGO_CIE_FOL, C.REFERENCIA_CIE_FOL FROM C ORDER BY ORIGEN_FOL

#BuscaFoliosGenerados=WITH A AS (SELECT COMPANIA, FOLIO, NUMERO_FE, ORIGEN FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND FOLIO = [folio]),B AS(SELECT F.ORIGEN AS ORIGEN_FOL,F.COMPANIA AS COMPANIA_FOL, F.FOLIO AS FOLIO_FOL, F.NUMERO_FE AS NUMERO_FOL, C.FOLIO AS FOLIO_FACT_FOL, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_FACT_FOL, C.TOTAL - NVL ((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0) AS TOTAL_FACT_FOL,(CASE WHEN C.TIPO_PAGO = 'PAG' THEN  C.TOTAL - NVL ((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0) WHEN C.TIPO_PAGO = 'PAR' THEN C.TOTAL_A_PAGAR ELSE C.TOTAL - NVL ((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0) END) AS TOTAL_A_PAGAR_FOL, E.NOMBRE AS NOMBRE_FOL, E.RFC AS RFC_FOL, F.OPERACION AS ESTATUS_FOL,(SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = E.RFC AND ORIGEN = 'P' AND ROWNUM < 2) AS CUENTA_CLABE_FOL,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = E.RFC AND ORIGEN = 'P' AND ROWNUM < 2) AS BANCO_FOL, C.PAGO_CIE AS PAGO_CIE_FOL, C.REFERENCIA_CIE AS REFERENCIA_CIE_FOL, C.CONCEPTO_CIE AS CONCEPTO_CIE_FOL   FROM ERP_CXP_FOLIOS F, ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E, A  WHERE F.COMPANIA = A.COMPANIA AND C.COMPANIA = F.COMPANIA AND F.NUMERO_FE = A.NUMERO_FE AND  F.NUMERO_FE = C.NUMERO AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND F.FOLIO = A.FOLIO AND F.ORIGEN = A.ORIGEN AND A.ORIGEN = 'F' ORDER BY C.FECHA, C.NUMERO),C AS (SELECT C.ORIGEN AS ORIGEN_FOL,O.COMPANIA AS COMPANIA_FOL, O.FOLIO_PAGOS AS FOLIO_FOL, O.ID AS NUMERO_FOL, '' AS FOLIO_FACT_FOL, TO_CHAR(O.FECHA, 'DD/MM/YYYY') AS FECHA_FACT_FOL,O.TOTAL AS TOTAL_FACT_FOL, O.TOTAL AS TOTAL_A_PAGAR_FOL, O.BENEFICIARIO AS NOMBRE_FOL, O.RFC AS RFC_FOL, C.OPERACION AS ESTATUS_FOL, (SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ORIGEN = 'P' AND ROWNUM < 2) AS CUENTA_CLABE_FOL,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ORIGEN = 'P' AND ROWNUM < 2) AS BANCO_FOL, (SELECT PAGO_CIE FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ROWNUM = 1) AS PAGO_CIE_FOL,(SELECT REFERENCIA_CIE FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ROWNUM = 1) AS REFERENCIA_CIE_FOL, '' AS CONCEPTO_CIE_FOL   FROM ERP_CP_OTRAS O, ERP_CXP_FOLIOS C, A WHERE O.COMPANIA = A.COMPANIA AND A.COMPANIA = O.COMPANIA AND C.COMPANIA = O.COMPANIA AND O.ID = A.NUMERO_FE AND C.NUMERO_FE = O.ID AND C.FOLIO = A.FOLIO AND C.ORIGEN = 'O' ORDER BY O.FECHA, O.ID),D AS(SELECT F.ORIGEN AS ORIGEN_FOL,F.COMPANIA AS COMPANIA_FOL, F.FOLIO AS FOLIO_FOL, V.COMISION AS NUMERO_FOL, '' AS FOLIO_FACT_FOL,TO_CHAR(F_INI_COMISION,'DD/MM/YYYY') AS FECHA_FACT_FOL,V.IMPORTE AS TOTAL_FACT_FOL,V.IMPORTE AS TOTAL_A_PAGAR_FOL, E.RFC AS RFC_FOL, E.NOMBRE AS NOMBRE_FOL, F.OPERACION AS ESTATUS_FOL, NVL(E.BANCO,'N/A') AS BANCO_FOL, NVL(E.CUENTA_CLABE,'N/A') AS CUENTA_CLABE_FOL,NULL AS PAGO_CIE_FOL,'' AS REFERENCIA_CIE_FOL,'' AS CONCEPTO_CIE_FOL  FROM VI_COMISIONES V,EMPLEADOS E, ERP_CXP_FOLIOS F,A WHERE V.COMPANIA = A.COMPANIA AND E.NUM_EMPLEADO = V.EMPLEADO AND F.COMPANIA = V.COMPANIA AND F.NUMERO_FE = V.COMISION AND F.ORIGEN = 'V' AND F.FOLIO = A.FOLIO AND F.COMPANIA = A.COMPANIA) SELECT B.COMPANIA_FOL, B.FOLIO_FOL, B.NUMERO_FOL, B.FOLIO_FACT_FOL, B.FECHA_FACT_FOL, B.TOTAL_FACT_FOL,B.TOTAL_A_PAGAR_FOL, B.NOMBRE_FOL, B.RFC_FOL, B.ESTATUS_FOL, B.ORIGEN_FOL, B.CUENTA_CLABE_FOL, B.BANCO_FOL, B.PAGO_CIE_FOL, B.REFERENCIA_CIE_FOL, B.CONCEPTO_CIE_FOL FROM B UNION SELECT C.COMPANIA_FOL, C.FOLIO_FOL, C.NUMERO_FOL, C.FOLIO_FACT_FOL, C.FECHA_FACT_FOL, C.TOTAL_FACT_FOL,C.TOTAL_A_PAGAR_FOL, C.NOMBRE_FOL, C.RFC_FOL, C.ESTATUS_FOL, C.ORIGEN_FOL, C.CUENTA_CLABE_FOL, C.BANCO_FOL, C.PAGO_CIE_FOL, C.REFERENCIA_CIE_FOL, C.CONCEPTO_CIE_FOL FROM C UNION SELECT D.COMPANIA_FOL,D.FOLIO_FOL,D.NUMERO_FOL, D.FOLIO_FACT_FOL,D.FECHA_FACT_FOL,D.TOTAL_FACT_FOL,D.TOTAL_A_PAGAR_FOL, D.NOMBRE_FOL,D.RFC_FOL, D.ESTATUS_FOL, D.ORIGEN_FOL,D.CUENTA_CLABE_FOL,D.BANCO_FOL,D.PAGO_CIE_FOL,D.REFERENCIA_CIE_FOL,D.CONCEPTO_CIE_FOL FROM D ORDER BY ORIGEN_FOL
BuscaFoliosGenerados=WITH A AS (SELECT COMPANIA, FOLIO, NUMERO_FE, ORIGEN FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND FOLIO = [folio]),B AS(SELECT F.ORIGEN AS ORIGEN_FOL,F.COMPANIA AS COMPANIA_FOL, F.FOLIO AS FOLIO_FOL, F.NUMERO_FE AS NUMERO_FOL, C.FOLIO AS FOLIO_FACT_FOL, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_FACT_FOL, C.TOTAL - NVL ((SELECT SUM(IMPORTE) FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0) AS TOTAL_FACT_FOL,(CASE WHEN C.TIPO_PAGO = 'PAG' THEN  C.TOTAL - NVL ((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0) WHEN C.TIPO_PAGO = 'PAR' THEN C.TOTAL_A_PAGAR ELSE C.TOTAL - NVL ((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0) END) AS TOTAL_A_PAGAR_FOL, E.NOMBRE AS NOMBRE_FOL, E.RFC AS RFC_FOL, F.OPERACION AS ESTATUS_FOL,(SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = E.RFC AND ORIGEN = 'P' AND ROWNUM < 2) AS CUENTA_CLABE_FOL,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = E.RFC AND ORIGEN = 'P' AND ROWNUM < 2) AS BANCO_FOL,NVL ((SELECT NUMERO_CUENTA FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') AS NUMERO_CUENTA_FOL,NVL ((SELECT CUENTA_VALIDA FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ORIGEN = 'P' AND RFC = E.RFC AND ROWNUM = 1),'N/A') AS CUENTA_VALIDA_FOL, C.PAGO_CIE AS PAGO_CIE_FOL, C.REFERENCIA_CIE AS REFERENCIA_CIE_FOL, C.CONCEPTO_CIE AS CONCEPTO_CIE_FOL   FROM ERP_CXP_FOLIOS F, ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E, A  WHERE F.COMPANIA = A.COMPANIA AND C.COMPANIA = F.COMPANIA AND F.NUMERO_FE = A.NUMERO_FE AND  F.NUMERO_FE = C.NUMERO AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND F.FOLIO = A.FOLIO AND F.ORIGEN = A.ORIGEN AND A.ORIGEN = 'F' ORDER BY C.FECHA, C.NUMERO),C AS (SELECT C.ORIGEN AS ORIGEN_FOL,O.COMPANIA AS COMPANIA_FOL, O.FOLIO_PAGOS AS FOLIO_FOL, O.ID AS NUMERO_FOL, '' AS FOLIO_FACT_FOL, TO_CHAR(O.FECHA, 'DD/MM/YYYY') AS FECHA_FACT_FOL,O.TOTAL AS TOTAL_FACT_FOL, O.TOTAL AS TOTAL_A_PAGAR_FOL, O.BENEFICIARIO AS NOMBRE_FOL, O.RFC AS RFC_FOL, C.OPERACION AS ESTATUS_FOL, (SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ORIGEN = 'P' AND ROWNUM < 2) AS CUENTA_CLABE_FOL,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ORIGEN = 'P' AND ROWNUM < 2) AS BANCO_FOL,NVL ((SELECT NUMERO_CUENTA FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND ORIGEN = 'P' AND RFC = O.RFC AND ROWNUM = 1),'N/A') AS NUMERO_CUENTA_FOL,NVL ((SELECT CUENTA_VALIDA FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND ORIGEN = 'P' AND RFC = O.RFC AND ROWNUM = 1),'N/A') AS CUENTA_VALIDA_FOL, CASE WHEN (O.PAGO_CIE IS NULL OR O.PAGO_CIE = '') THEN (SELECT PAGO_CIE FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ROWNUM = 1) ELSE TO_NUMBER(O.PAGO_CIE) END AS PAGO_CIE_FOL, CASE WHEN (O.REFERENCIA_CIE IS NULL OR O.REFERENCIA_CIE = '') THEN (SELECT REFERENCIA_CIE FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ROWNUM = 1) ELSE O.REFERENCIA_CIE END AS REFERENCIA_CIE_FOL, O.CONCEPTO_CIE AS CONCEPTO_CIE_FOL FROM ERP_CP_OTRAS O, ERP_CXP_FOLIOS C, A WHERE O.COMPANIA = A.COMPANIA AND A.COMPANIA = O.COMPANIA AND C.COMPANIA = O.COMPANIA AND O.ID = A.NUMERO_FE AND C.NUMERO_FE = O.ID AND C.FOLIO = A.FOLIO AND C.ORIGEN = 'O' ORDER BY O.FECHA, O.ID),D AS(SELECT F.ORIGEN AS ORIGEN_FOL,F.COMPANIA AS COMPANIA_FOL, F.FOLIO AS FOLIO_FOL, V.COMISION AS NUMERO_FOL, '' AS FOLIO_FACT_FOL,TO_CHAR(F_INI_COMISION,'DD/MM/YYYY') AS FECHA_FACT_FOL,V.IMPORTE AS TOTAL_FACT_FOL,V.IMPORTE AS TOTAL_A_PAGAR_FOL, E.RFC AS RFC_FOL, E.NOMBRE AS NOMBRE_FOL, F.OPERACION AS ESTATUS_FOL, NVL(E.BANCO,'N/A') AS BANCO_FOL, NVL(E.CUENTA_CLABE,'N/A') AS CUENTA_CLABE_FOL, NVL (E.NUMERO_CUENTA, 'N/A') AS NUMERO_CUENTA_FOL,'1' AS CUENTA_VALIDA_FOL,NULL AS PAGO_CIE_FOL,'' AS REFERENCIA_CIE_FOL,'' AS CONCEPTO_CIE_FOL  FROM VI_COMISIONES V,EMPLEADOS E, ERP_CXP_FOLIOS F,A WHERE V.COMPANIA = A.COMPANIA AND E.NUM_EMPLEADO = V.EMPLEADO AND E.COMPANIA = V.COMPANIA  AND F.COMPANIA = V.COMPANIA AND F.NUMERO_FE = V.COMISION AND F.ORIGEN = 'V' AND F.FOLIO = A.FOLIO AND F.COMPANIA = A.COMPANIA) SELECT B.COMPANIA_FOL, B.FOLIO_FOL, B.NUMERO_FOL, B.FOLIO_FACT_FOL, B.FECHA_FACT_FOL, B.TOTAL_FACT_FOL,B.TOTAL_A_PAGAR_FOL, B.NOMBRE_FOL, B.RFC_FOL, B.ESTATUS_FOL, B.ORIGEN_FOL, B.CUENTA_CLABE_FOL, B.BANCO_FOL,B.NUMERO_CUENTA_FOL,B.CUENTA_VALIDA_FOL, B.PAGO_CIE_FOL, B.REFERENCIA_CIE_FOL, B.CONCEPTO_CIE_FOL FROM B UNION SELECT C.COMPANIA_FOL, C.FOLIO_FOL, C.NUMERO_FOL, C.FOLIO_FACT_FOL, C.FECHA_FACT_FOL, C.TOTAL_FACT_FOL,C.TOTAL_A_PAGAR_FOL, C.NOMBRE_FOL, C.RFC_FOL, C.ESTATUS_FOL, C.ORIGEN_FOL, C.CUENTA_CLABE_FOL, C.BANCO_FOL, C.NUMERO_CUENTA_FOL,C.CUENTA_VALIDA_FOL,C.PAGO_CIE_FOL, C.REFERENCIA_CIE_FOL, C.CONCEPTO_CIE_FOL FROM C UNION SELECT D.COMPANIA_FOL,D.FOLIO_FOL,D.NUMERO_FOL, D.FOLIO_FACT_FOL,D.FECHA_FACT_FOL,D.TOTAL_FACT_FOL,D.TOTAL_A_PAGAR_FOL, D.NOMBRE_FOL,D.RFC_FOL, D.ESTATUS_FOL, D.ORIGEN_FOL,D.CUENTA_CLABE_FOL,D.BANCO_FOL,D.NUMERO_CUENTA_FOL,D.CUENTA_VALIDA_FOL,D.PAGO_CIE_FOL,D.REFERENCIA_CIE_FOL,D.CONCEPTO_CIE_FOL FROM D ORDER BY ORIGEN_FOL
#BuscaFoliosGeneradosCan=WITH A AS (SELECT COMPANIA,FOLIO,NUMERO_FE,ORIGEN FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND FOLIO = [folio]),B AS (  SELECT F.ORIGEN AS ORIGEN_FOL_CAN,F.COMPANIA AS COMPANIA_FOL_CAN, F.FOLIO AS FOLIO_FOL_CAN,F.NUMERO_FE AS NUMERO_FOL_CAN,C.FOLIO AS FOLIO_FACT_FOL_CAN, TO_CHAR (C.FECHA, 'DD/MM/YYYY') AS FECHA_FACT_FOL_CAN, C.TOTAL - NVL ((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)), 0) AS TOTAL_FACT_FOL_CAN,E.NOMBRE AS NOMBRE_FOL_CAN, E.RFC AS RFC_FOL_CAN,(SELECT MOTIVO FROM MOTVO_CANC_CXP WHERE FOLIO_CXP = A.FOLIO AND NUMERO = C.NUMERO AND COMPANIA = C.COMPANIA AND ORIGEN = 'FE') AS MOT_CAN FROM ERP_CXP_FOLIOS F, ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E,A WHERE F.COMPANIA = A.COMPANIA AND C.COMPANIA = F.COMPANIA AND F.NUMERO_FE = A.NUMERO_FE AND F.NUMERO_FE = C.NUMERO AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND F.FOLIO = A.FOLIO AND F.ORIGEN = A.ORIGEN AND A.ORIGEN = 'F' ORDER BY C.FECHA, C.NUMERO), C AS (SELECT C.ORIGEN AS ORIGEN_FOL_CAN, O.COMPANIA AS COMPANIA_FOL_CAN,O.FOLIO_PAGOS AS FOLIO_FOL_CAN,O.ID AS NUMERO_FOL_CAN,'' AS FOLIO_FACT_FOL_CAN, TO_CHAR (O.FECHA, 'DD/MM/YYYY') AS FECHA_FACT_FOL_CAN, O.TOTAL AS TOTAL_FACT_FOL_CAN,O.BENEFICIARIO AS NOMBRE_FOL_CAN,O.RFC AS RFC_FOL_CAN,(SELECT MOTIVO FROM MOTVO_CANC_CXP WHERE FOLIO_CXP = A.FOLIO AND NUMERO = O.ID AND COMPANIA = O.COMPANIA AND ORIGEN = 'OTR') AS MOT_CAN FROM ERP_CP_OTRAS O, ERP_CXP_FOLIOS C, A WHERE O.COMPANIA = A.COMPANIA AND A.COMPANIA = O.COMPANIA AND C.COMPANIA = O.COMPANIA AND O.ID = A.NUMERO_FE AND C.NUMERO_FE = O.ID AND C.FOLIO = A.FOLIO AND C.ORIGEN = 'O' ORDER BY O.FECHA, O.ID),D AS (SELECT F.ORIGEN AS ORIGEN_FOL_CAN, F.COMPANIA AS COMPANIA_FOL_CAN, F.FOLIO AS FOLIO_FOL_CAN,V.COMISION AS NUMERO_FOL_CAN,'' AS FOLIO_FACT_FOL_CAN,TO_CHAR (F_INI_COMISION, 'DD/MM/YYYY') AS FECHA_FACT_FOL_CAN, V.IMPORTE AS TOTAL_FACT_FOL_CAN,E.RFC AS RFC_FOL_CAN, E.NOMBRE AS NOMBRE_FOL_CAN,(SELECT MOTIVO FROM MOTVO_CANC_CXP WHERE FOLIO_CXP = A.FOLIO AND NUMERO = V.COMISION AND COMPANIA = V.COMPANIA AND ORIGEN = 'VIA') AS MOT_CAN FROM VI_COMISIONES V,EMPLEADOS E, ERP_CXP_FOLIOS F,A WHERE V.COMPANIA = A.COMPANIA AND E.NUM_EMPLEADO = V.EMPLEADO AND F.COMPANIA = V.COMPANIA AND F.NUMERO_FE = V.COMISION AND F.ORIGEN = 'V' AND F.FOLIO = A.FOLIO AND F.COMPANIA = A.COMPANIA) SELECT B.COMPANIA_FOL_CAN, B.FOLIO_FOL_CAN, B.NUMERO_FOL_CAN,B.FOLIO_FACT_FOL_CAN, B.FECHA_FACT_FOL_CAN,B.TOTAL_FACT_FOL_CAN,B.NOMBRE_FOL_CAN,B.RFC_FOL_CAN,B.MOT_CAN FROM B UNION SELECT C.COMPANIA_FOL_CAN,C.FOLIO_FOL_CAN,C.NUMERO_FOL_CAN,C.FOLIO_FACT_FOL_CAN, C.FECHA_FACT_FOL_CAN,C.TOTAL_FACT_FOL_CAN,C.NOMBRE_FOL_CAN,C.RFC_FOL_CAN, C.MOT_CAN FROM C UNION SELECT D.COMPANIA_FOL_CAN, D.FOLIO_FOL_CAN,D.NUMERO_FOL_CAN, D.FOLIO_FACT_FOL_CAN,D.FECHA_FACT_FOL_CAN, D.TOTAL_FACT_FOL_CAN,D.NOMBRE_FOL_CAN,D.RFC_FOL_CAN, D.MOT_CAN FROM D ORDER BY NUMERO_FOL_CAN
BuscaFoliosGeneradosCan=WITH A AS (SELECT COMPANIA,FOLIO,NUMERO_FE,ORIGEN FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND FOLIO = [folio]),B AS (  SELECT F.ORIGEN AS ORIGEN_FOL_CAN,F.COMPANIA AS COMPANIA_FOL_CAN, F.FOLIO AS FOLIO_FOL_CAN,F.NUMERO_FE AS NUMERO_FOL_CAN,C.FOLIO AS FOLIO_FACT_FOL_CAN, TO_CHAR (C.FECHA, 'DD/MM/YYYY') AS FECHA_FACT_FOL_CAN, C.TOTAL - NVL ((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)), 0) AS TOTAL_FACT_FOL_CAN,E.NOMBRE AS NOMBRE_FOL_CAN, E.RFC AS RFC_FOL_CAN,(SELECT MOTIVO FROM MOTVO_CANC_CXP WHERE FOLIO_CXP = A.FOLIO AND NUMERO = C.NUMERO AND COMPANIA = C.COMPANIA AND ORIGEN = 'FE') AS MOT_CAN,(SELECT URL FROM MOTVO_CANC_CXP WHERE FOLIO_CXP = A.FOLIO AND NUMERO = C.NUMERO AND COMPANIA = C.COMPANIA AND ORIGEN = 'FE') AS URL_CAN FROM ERP_CXP_FOLIOS F, ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E,A WHERE F.COMPANIA = A.COMPANIA AND F.OPERACION = 'CAN' AND C.COMPANIA = F.COMPANIA AND F.NUMERO_FE = A.NUMERO_FE AND F.NUMERO_FE = C.NUMERO AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND F.FOLIO = A.FOLIO AND F.ORIGEN = A.ORIGEN AND A.ORIGEN = 'F' ORDER BY C.FECHA, C.NUMERO), C AS (SELECT C.ORIGEN AS ORIGEN_FOL_CAN, O.COMPANIA AS COMPANIA_FOL_CAN,O.FOLIO_PAGOS AS FOLIO_FOL_CAN,O.ID AS NUMERO_FOL_CAN,'' AS FOLIO_FACT_FOL_CAN, TO_CHAR (O.FECHA, 'DD/MM/YYYY') AS FECHA_FACT_FOL_CAN, O.TOTAL AS TOTAL_FACT_FOL_CAN,O.BENEFICIARIO AS NOMBRE_FOL_CAN,O.RFC AS RFC_FOL_CAN,(SELECT MOTIVO FROM MOTVO_CANC_CXP WHERE FOLIO_CXP = A.FOLIO AND NUMERO = O.ID AND COMPANIA = O.COMPANIA AND ORIGEN = 'OTR') AS MOT_CAN,(SELECT URL FROM MOTVO_CANC_CXP WHERE FOLIO_CXP = A.FOLIO AND NUMERO = O.ID AND COMPANIA = O.COMPANIA AND ORIGEN = 'OTR') AS URL_CAN FROM ERP_CP_OTRAS O, ERP_CXP_FOLIOS C, A WHERE O.COMPANIA = A.COMPANIA AND C.OPERACION = 'CAN' AND A.COMPANIA = O.COMPANIA AND C.COMPANIA = O.COMPANIA AND O.ID = A.NUMERO_FE AND C.NUMERO_FE = O.ID AND C.FOLIO = A.FOLIO AND C.ORIGEN = 'O' ORDER BY O.FECHA, O.ID),D AS (SELECT F.ORIGEN AS ORIGEN_FOL_CAN, F.COMPANIA AS COMPANIA_FOL_CAN, F.FOLIO AS FOLIO_FOL_CAN,V.COMISION AS NUMERO_FOL_CAN,'' AS FOLIO_FACT_FOL_CAN,TO_CHAR (F_INI_COMISION, 'DD/MM/YYYY') AS FECHA_FACT_FOL_CAN, V.IMPORTE AS TOTAL_FACT_FOL_CAN,E.RFC AS RFC_FOL_CAN, E.NOMBRE AS NOMBRE_FOL_CAN,(SELECT MOTIVO FROM MOTVO_CANC_CXP WHERE FOLIO_CXP = A.FOLIO AND NUMERO = V.COMISION AND COMPANIA = V.COMPANIA AND ORIGEN = 'VIA') AS MOT_CAN,(SELECT URL FROM MOTVO_CANC_CXP WHERE FOLIO_CXP = A.FOLIO AND NUMERO = V.COMISION AND COMPANIA = V.COMPANIA AND ORIGEN = 'VIA') AS URL_CAN FROM VI_COMISIONES V,EMPLEADOS E, ERP_CXP_FOLIOS F,A WHERE V.COMPANIA = A.COMPANIA AND F.OPERACION = 'CAN' AND E.NUM_EMPLEADO = V.EMPLEADO AND F.COMPANIA = V.COMPANIA AND F.NUMERO_FE = V.COMISION AND F.ORIGEN = 'V' AND F.FOLIO = A.FOLIO AND F.COMPANIA = A.COMPANIA) SELECT B.COMPANIA_FOL_CAN, B.FOLIO_FOL_CAN, B.NUMERO_FOL_CAN,B.FOLIO_FACT_FOL_CAN, B.FECHA_FACT_FOL_CAN,B.TOTAL_FACT_FOL_CAN,B.NOMBRE_FOL_CAN,B.RFC_FOL_CAN,B.MOT_CAN,B.URL_CAN FROM B UNION SELECT C.COMPANIA_FOL_CAN,C.FOLIO_FOL_CAN,C.NUMERO_FOL_CAN,C.FOLIO_FACT_FOL_CAN, C.FECHA_FACT_FOL_CAN,C.TOTAL_FACT_FOL_CAN,C.NOMBRE_FOL_CAN,C.RFC_FOL_CAN, C.MOT_CAN,C.URL_CAN FROM C UNION SELECT D.COMPANIA_FOL_CAN, D.FOLIO_FOL_CAN,D.NUMERO_FOL_CAN, D.FOLIO_FACT_FOL_CAN,D.FECHA_FACT_FOL_CAN, D.TOTAL_FACT_FOL_CAN,D.NOMBRE_FOL_CAN,D.RFC_FOL_CAN, D.MOT_CAN,D.URL_CAN FROM D ORDER BY NUMERO_FOL_CAN
#BuscaFoliosGenerados=WITH A AS (SELECT COMPANIA, FOLIO, NUMERO_FE, ORIGEN FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND FOLIO = [folio]),B AS(SELECT F.ORIGEN AS ORIGEN_FOL,F.COMPANIA AS COMPANIA_FOL, F.FOLIO AS FOLIO_FOL, F.NUMERO_FE AS NUMERO_FOL, C.FOLIO AS FOLIO_FACT_FOL, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_FACT_FOL, C.TOTAL - NVL((SELECT IMPORTE FROM ERP_CP_RELACION_FACTURAS WHERE COMPANIA = C.COMPANIA AND (NUM_FACTURA = C.NUMERO OR NUM_DOCUMENTO = C.NUMERO)),0) AS TOTAL_FACT_FOL, E.NOMBRE AS NOMBRE_FOL, E.RFC AS RFC_FOL, F.OPERACION AS ESTATUS_FOL,(SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = E.RFC AND ORIGEN = 'P' AND ROWNUM < 2) AS CUENTA_CLABE_FOL,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = E.RFC AND ORIGEN = 'P' AND ROWNUM < 2) AS BANCO_FOL, C.PAGO_CIE AS PAGO_CIE_FOL, C.REFERENCIA_CIE AS REFERENCIA_CIE_FOL, C.CONCEPTO_CIE AS CONCEPTO_CIE_FOL   FROM ERP_CXP_FOLIOS F, ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E, A  WHERE F.COMPANIA = A.COMPANIA AND C.COMPANIA = F.COMPANIA AND F.NUMERO_FE = A.NUMERO_FE AND  F.NUMERO_FE = C.NUMERO AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND F.FOLIO = A.FOLIO AND F.ORIGEN = A.ORIGEN AND A.ORIGEN = 'F' ORDER BY C.FECHA, C.NUMERO),C AS (SELECT C.ORIGEN AS ORIGEN_FOL,O.COMPANIA AS COMPANIA_FOL, O.FOLIO_PAGOS AS FOLIO_FOL, O.ID AS NUMERO_FOL, '' AS FOLIO_FACT_FOL, TO_CHAR(O.FECHA, 'DD/MM/YYYY') AS FECHA_FACT_FOL,O.TOTAL AS TOTAL_FACT_FOL, O.BENEFICIARIO AS NOMBRE_FOL, O.RFC AS RFC_FOL, C.OPERACION AS ESTATUS_FOL, (SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ORIGEN = 'P' AND ROWNUM < 2) AS CUENTA_CLABE_FOL,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = O.COMPANIA AND RFC = O.RFC AND ORIGEN = 'P' AND ROWNUM < 2) AS BANCO_FOL, NULL AS PAGO_CIE_FOL, '' AS REFERENCIA_CIE_FOL, '' AS CONCEPTO_CIE_FOL   FROM ERP_CP_OTRAS O, ERP_CXP_FOLIOS C, A WHERE O.COMPANIA = A.COMPANIA AND A.COMPANIA = O.COMPANIA AND O.ID = A.NUMERO_FE AND C.NUMERO_FE = O.ID AND C.FOLIO = A.FOLIO AND C.ORIGEN = 'O' ORDER BY O.FECHA, O.ID)SELECT B.COMPANIA_FOL, B.FOLIO_FOL, B.NUMERO_FOL, B.FOLIO_FACT_FOL, B.FECHA_FACT_FOL, B.TOTAL_FACT_FOL, B.NOMBRE_FOL, B.RFC_FOL, B.ESTATUS_FOL, B.ORIGEN_FOL, B.CUENTA_CLABE_FOL, B.BANCO_FOL, B.PAGO_CIE_FOL, B.REFERENCIA_CIE_FOL, B.CONCEPTO_CIE_FOL FROM B UNION SELECT C.COMPANIA_FOL, C.FOLIO_FOL, C.NUMERO_FOL, C.FOLIO_FACT_FOL, C.FECHA_FACT_FOL, C.TOTAL_FACT_FOL, C.NOMBRE_FOL, C.RFC_FOL, C.ESTATUS_FOL, C.ORIGEN_FOL, C.CUENTA_CLABE_FOL, C.BANCO_FOL, C.PAGO_CIE_FOL, C.REFERENCIA_CIE_FOL, C.CONCEPTO_CIE_FOL FROM C ORDER BY ORIGEN_FOL

#BuscaFoliosGenCxp=SELECT DISTINCT FOLIO FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND FOLIO <> -1 ORDER BY FOLIO DESC
BuscaFoliosGenCxp=SELECT DISTINCT FOLIO, TO_CHAR(FECHA_GEN,'YYYY') || '-' || TO_CHAR(FOLIO) AS FOLIO_NOM FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND FOLIO <> -1 UNION SELECT DISTINCT FOLIO, TO_CHAR(FECHA_GEN,'YYYY') || '-' || FOLIO || '-' || 'Cancelado' as FOLIO_NOM FROM ERP_CXP_FOLIOS_LOGS WHERE COMPANIA = '[compania]' AND PROCESO = 'DELETE' AND FOLIO NOT IN (SELECT DISTINCT FOLIO FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND FOLIO <> -1 ) ORDER BY FOLIO DESC

BuscaFoliosGenCxpCan=SELECT DISTINCT FOLIO, TO_CHAR(FECHA_GEN,'YYYY') || '-' || TO_CHAR(FOLIO) AS FOLIO_NOM FROM ERP_CXP_FOLIOS WHERE COMPANIA = '[compania]' AND OPERACION = 'CAN' ORDER BY FOLIO DESC

BuscaDatosRembolso = SELECT 'F' AS ORIGEN, C.COMPANIA as COMPANIA_TES_REM,C.NUMERO as NUMERO_TES_REM,C.FOLIO as FOLIO_TES_REM, C.TOTAL as TOTAL_TES_REM,TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_TES_REM,E.NOMBRE as NOMBRE_EMISOR_TES_REM,E.RFC as RFC_EMISOR_TES_REM,NVL((SELECT MONEDA_SAT FROM ERP_CFDI_MONEDAS WHERE MONEDA = C.MONEDA),'N/A') as MONEDA_TES_REM, NVL(C.MONEDA_PAGO,'N/A') AS MONEDA_PAGO_TES_REM FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E  WHERE C.COMPANIA = '[compania]' AND C.NUMERO = '[numero]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO
BuscaEmpleadosRembolso = SELECT NOMBRE AS EMPLEADO, ID_CLIENTE, CUENTA_CLAVE, BANCO FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND ORIGEN = 'P' AND (CIE <> '1' OR CIE IS NULL)
BuscaDatosTesoreriaOtros = SELECT 'O' AS ORIGEN,T.COMPANIA AS COMPANIA_TES, T.ID AS NUMERO_TES, '' AS FOLIO_TES, T.TOTAL AS TOTAL_TES, TO_CHAR(T.FECHA,'DD/MM/YYYY') AS FECHA_TES, T.BENEFICIARIO as NOMBRE_EMISOR_TES, T.RFC as RFC_EMISOR_TES, NVL((SELECT NOMBRE FROM ERP_CCLIENTES WHERE COMPANIA = T.COMPANIA AND ORIGEN = 'P' AND RFC = T.RFC AND ROWNUM = 1),'N/A') as NOMBRE_PROV_TES,NVL((SELECT RFC FROM ERP_CCLIENTES WHERE COMPANIA = T.COMPANIA AND ORIGEN = 'P' AND RFC = T.RFC AND ROWNUM = 1),'N/A') as RFC_PROV_TES,NVL((SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = T.COMPANIA AND ORIGEN = 'P' AND RFC = T.RFC AND ROWNUM = 1),'N/A') as BANCO_PROV,NVL((SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = T.COMPANIA AND ORIGEN = 'P' AND RFC = T.RFC AND ROWNUM = 1),'N/A') as CTA_CLABE_PROV,NVL ((SELECT NUMERO_CUENTA FROM ERP_CCLIENTES WHERE COMPANIA = T.COMPANIA AND ORIGEN = 'P' AND RFC = T.RFC AND ROWNUM = 1),'N/A') AS NUMERO_CUENTA_PROV,NVL ((SELECT CUENTA_VALIDA FROM ERP_CCLIENTES WHERE COMPANIA = T.COMPANIA AND ORIGEN = 'P' AND RFC = T.RFC AND ROWNUM = 1),'N/A') AS CUENTA_VALIDA_PROV,T.MONEDA as MONEDA_TES, T.MONEDA AS MONEDA_PAGO_TES, 'N/A' AS CIE, '' AS PAGO_CIE,  '' AS REFERENCIA_CIE, '' AS PAGO_CIE_COMPROBANTES, '' AS REFERENCIA_CIE_COMPROBANTES  FROM ERP_CP_OTRAS T WHERE COMPANIA = '[compania]' AND ID = [numero]
BuscaFactRelOtras = SELECT 'F' AS TIPO_GASTO_REL, CAST('FACTURA' as VARCHAR2(100) )  AS NOMBRE_GASTO_REL, 'F' AS ORIGEN_REL,C.COMPANIA AS COMPANIA_REL, C.NUMERO AS NUMERO_REL, C.FOLIO AS FOLIO_REL, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_REL,C.TOTAL AS TOTAL_REL, E.RFC AS RFC_REL, E.NOMBRE AS NOMBRE_REL, C.ESTATUS_CXP AS ESTATUS_CXP_REL,(SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO AND NUMERO_OTRAS = [numero_otras]) AS NUM_RELACION_FE  FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND ORIGEN = 'CP' AND (C.ESTATUS_CXP IS NULL OR C.ESTATUS_CXP = 'CAN' OR C.ESTATUS_CXP = 'REMB' OR C.ESTATUS_CXP = 'ANT') ORDER BY NUM_RELACION_FE, C.NUMERO
BuscaFactRelOtrasDel=SELECT 'F' AS TIPO_GASTO_REL, CAST('FACTURA' as VARCHAR2(100) ) AS NOMBRE_GASTO_REL, 'F' AS ORIGEN_REL,C.COMPANIA AS COMPANIA_REL, C.NUMERO AS NUMERO_REL, C.FOLIO AS FOLIO_REL, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_REL,C.TOTAL AS TOTAL_REL, E.RFC AS RFC_REL, E.NOMBRE AS NOMBRE_REL, C.ESTATUS_CXP AS ESTATUS_CXP_REL, (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO AND NUMERO_OTRAS = [numero_otras]) AS NUM_RELACION_FE FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND ORIGEN = 'CP' AND C.NUMERO IN (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO AND NUMERO_OTRAS = [numero_otras])

BuscaOtrasRelfact = SELECT O.TIPO_GASTO AS TIPO_GASTO_REL,(SELECT NOMBRE FROM ERP_CP_OTRAS_TIPO WHERE COMPANIA = O.COMPANIA AND TIPO = O.TIPO_GASTO) AS NOMBRE_GASTO_REL, 'O' AS ORIGEN_REL,O.COMPANIA AS COMPANIA_REL, O.ID AS NUMERO_REL, '' AS FOLIO_REL, TO_CHAR(O.FECHA,'DD/MM/YYYY') AS FECHA_REL, O.TOTAL AS TOTAL_REL, O.RFC AS RFC_REL, O.BENEFICIARIO AS NOMBRE_REL, O.ESTATUS_CXP AS ESTATUS_CXP_REL, (SELECT NUMERO_OTRAS FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = O.COMPANIA AND NUMERO_OTRAS = O.ID AND NUMERO_FE = [numero_fe]) AS NUM_RELACION_FE FROM ERP_CP_OTRAS O WHERE O.COMPANIA = '[compania]'
BuscaOtrasRelfactDel = SELECT O.TIPO_GASTO AS TIPO_GASTO_REL,(SELECT NOMBRE FROM ERP_CP_OTRAS_TIPO WHERE COMPANIA = O.COMPANIA AND TIPO = O.TIPO_GASTO) AS NOMBRE_GASTO_REL, 'O' AS ORIGEN_REL,O.COMPANIA AS COMPANIA_REL, O.ID AS NUMERO_REL, '' AS FOLIO_REL, TO_CHAR(O.FECHA,'DD/MM/YYYY') AS FECHA_REL, O.TOTAL AS TOTAL_REL, O.RFC AS RFC_REL, O.BENEFICIARIO AS NOMBRE_REL, O.ESTATUS_CXP AS ESTATUS_CXP_REL, (SELECT NUMERO_OTRAS FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = O.COMPANIA AND NUMERO_OTRAS = O.ID AND NUMERO_FE = [numero_fe]) AS NUM_RELACION_FE FROM ERP_CP_OTRAS O WHERE O.COMPANIA = '[compania]' AND O.ID IN (SELECT NUMERO_OTRAS FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = O.COMPANIA AND NUMERO_OTRAS = O.ID AND NUMERO_FE = [numero_fe])

#BuscaFactRelOtrasInfo=SELECT 'F' AS TIPO_GASTO_REL_INFO, CAST('FACTURA' as VARCHAR2(100) ) AS NOMBRE_GASTO_REL_INFO, 'F' AS ORIGEN_REL_INFO,C.COMPANIA AS COMPANIA_REL_INFO, C.NUMERO AS NUMERO_REL_INFO, C.FOLIO AS FOLIO_REL_INFO, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_REL_INFO,C.SUBTOTAL AS SUBTOTAL_REL_INFO,C.TOTAL AS TOTAL_REL_INFO, E.RFC AS RFC_REL_INFO, E.NOMBRE AS NOMBRE_REL_INFO, C.ESTATUS_CXP AS ESTATUS_CXP_REL_INFO, (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO AND NUMERO_OTRAS = [numero_otras]) AS NUM_RELACION_FE_INFO FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND ORIGEN IN ('CP','PRTL') AND C.NUMERO IN (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO AND NUMERO_OTRAS = [numero_otras]) UNION SELECT 'F' AS TIPO_GASTO_REL_INFO, CAST('FACTURA' as VARCHAR2(100) ) AS NOMBRE_GASTO_REL_INFO, 'F' AS ORIGEN_REL_INFO,C.COMPANIA AS COMPANIA_REL_INFO, C.NUMERO AS NUMERO_REL_INFO, C.FOLIO AS FOLIO_REL_INFO, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_REL_INFO,C.SUBTOTAL AS SUBTOTAL_REL_INFO,C.TOTAL AS TOTAL_REL_INFO, E.RFC AS RFC_REL_INFO, E.NOMBRE AS NOMBRE_REL_INFO, C.ESTATUS_CXP AS ESTATUS_CXP_REL_INFO, C.NUMERO AS NUM_RELACION_FE_INFO FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND ORIGEN = 'V' AND C.NUMERO IN (SELECT NUMERO_FE FROM VI_COMPROBACION_COMISION_GAST WHERE COMISION = [numero_otras] AND COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO) ORDER BY NUMERO_REL_INFO
BuscaFactRelOtrasInfo=SELECT 'F' AS TIPO_GASTO_REL_INFO, CAST('FACTURA' as VARCHAR2(100) ) AS NOMBRE_GASTO_REL_INFO, 'F' AS ORIGEN_REL_INFO,C.COMPANIA AS COMPANIA_REL_INFO, C.NUMERO AS NUMERO_REL_INFO, C.FOLIO AS FOLIO_REL_INFO, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_REL_INFO,C.SUBTOTAL AS SUBTOTAL_REL_INFO,C.TOTAL AS TOTAL_REL_INFO, E.RFC AS RFC_REL_INFO, E.NOMBRE AS NOMBRE_REL_INFO, C.ESTATUS_CXP AS ESTATUS_CXP_REL_INFO, C.NUMERO AS NUM_RELACION_FE_INFO,TO_CHAR (C.FECHA, 'YYYY') || '/' || CASE WHEN TO_CHAR (C.FECHA, 'YYYY') < '2018' THEN TO_CHAR (C.FECHA, 'MM') ELSE TO_CHAR (TO_NUMBER (TO_CHAR (C.FECHA, 'MM'))) END || '/' || C.XML AS URL FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND ORIGEN = 'V' AND C.NUMERO IN (SELECT NUMERO_FE FROM VI_COMPROBACION_COMISION_GAST WHERE COMISION = [numero_otras] AND COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO) UNION SELECT 'G' AS TIPO_GASTO_REL_INFO, CAST('GASTO CAPTURADO' as VARCHAR2(100) ) AS NOMBRE_GASTO_REL_INFO, 'V' AS ORIGEN_REL_INFO, G.COMPANIA AS COMPANIA_REL_INFO, G.SEC AS NUMERO_REL_INFO, '' AS FOLIO_REL_INFO, G.F_COMPROBANTE AS FECHA_REL_INFO,G.IMPORTE_PESOS AS SUBTOTAL_REL_INFO,G.TOT_GTO_PESOS AS TOTAL_REL_INFO, G.RFC_PROV AS RFC_REL_INFO, (SELECT NOMBRE FROM VI_CONC_GASTOS WHERE CONC_GASTO = G.CONC_GASTO AND COMPANIA = G.COMPANIA) AS NOMBRE_REL_INFO, '' AS ESTATUS_CXP_REL_INFO, G.COMISION AS NUM_RELACION_FE_INFO,(SELECT A.COMISION || '/' || A.NOMBRE FROM VI_COMPROBACION_ARCHIVOS A WHERE A.COMPANIA = G.COMPANIA AND A.COMISION = G.COMISION AND A.SEC = G.SEC) AS URL FROM VI_COMPROBACION_COMISION_GAST G WHERE G.COMPANIA = '[compania]' AND G.COMISION = [numero_otras] AND G.NUMERO_FE IS NULL UNION SELECT 'F' AS TIPO_GASTO_REL_INFO, CAST('FACTURA' as VARCHAR2(100) ) AS NOMBRE_GASTO_REL_INFO, 'F' AS ORIGEN_REL_INFO,C.COMPANIA AS COMPANIA_REL_INFO, C.NUMERO AS NUMERO_REL_INFO, C.FOLIO AS FOLIO_REL_INFO, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_REL_INFO,C.SUBTOTAL AS SUBTOTAL_REL_INFO,C.TOTAL AS TOTAL_REL_INFO, E.RFC AS RFC_REL_INFO, E.NOMBRE AS NOMBRE_REL_INFO, C.ESTATUS_CXP AS ESTATUS_CXP_REL_INFO, (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO AND NUMERO_OTRAS = [numero_otras]) AS NUM_RELACION_FE_INFO, '' AS URL FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND ORIGEN IN ('CP','PRTL') AND C.NUMERO IN (SELECT NUMERO_FE FROM ERP_CXP_FACTURASXOTRAS WHERE COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO AND NUMERO_OTRAS = [numero_otras]) ORDER BY TIPO_GASTO_REL_INFO
BuscaFactRelViaticInfo=SELECT 'F' AS TIPO_GASTO_COMP_VIA, CAST('FACTURA' as VARCHAR2(100) ) AS NOMBRE_GASTO_COMP_VIA, 'F' AS ORIGEN_COMP_VIA,C.COMPANIA AS COMPANIA_COMP_VIA, C.NUMERO AS NUMERO_COMP_VIA, C.FOLIO AS FOLIO_COMP_VIA, TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA_COMP_VIA, (SELECT IMPORTE_PESOS FROM VI_COMPROBACION_COMISION WHERE COMISION = [comision] AND COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO) AS SUBTOTAL_COMP_VIA, (SELECT TOT_GTO_PESOS FROM VI_COMPROBACION_COMISION WHERE COMISION = [comision] AND COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO) AS TOTAL_COMP_VIA, E.RFC AS RFC_COMP_VIA, E.NOMBRE AS NOMBRE_COMP_VIA, C.ESTATUS_CXP AS ESTATUS_CXP_COMP_VIA, C.NUMERO AS NUM_RELACION_COMP_VIA FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND ORIGEN = 'V' AND C.NUMERO IN (SELECT NUMERO_FE FROM VI_COMPROBACION_COMISION WHERE COMISION = [comision] AND COMPANIA = C.COMPANIA AND NUMERO_FE = C.NUMERO) UNION SELECT 'G' AS TIPO_GASTO_COMP_VIA, CAST('GASTO CAPTURADO' as VARCHAR2(100) ) AS NOMBRE_GASTO_COMP_VIA, 'V' AS ORIGEN_COMP_VIA, G.COMPANIA AS COMPANIA_COMP_VIA, G.SEC AS NUMERO_COMP_VIA, '' AS FOLIO_COMP_VIA, G.F_COMPROBANTE AS FECHA_COMP_VIA,G.IMPORTE_PESOS AS SUBTOTAL_COMP_VIA,G.TOT_GTO_PESOS AS TOTAL_COMP_VIA, G.RFC_PROV AS RFC_COMP_VIA, (SELECT NOMBRE FROM VI_CONC_GASTOS WHERE CONC_GASTO = G.CONC_GASTO AND COMPANIA = G.COMPANIA) AS NOMBRE_COMP_VIA, '' AS ESTATUS_CXP_COMP_VIA, G.COMISION AS NUM_RELACION_COMP_VIA FROM VI_COMPROBACION_COMISION G WHERE G.COMPANIA = '[compania]' AND G.COMISION = [comision] AND G.NUMERO_FE IS NULL 

BuscaOtrasArchivos=SELECT COMPANIA AS COMPANIA_OTR_ARC,ID AS ID_OTR_ARC,SEC AS SEC_OTR_ARC, PATH AS PATH_OTR_ARC,URL AS URL_OTR_ARC,NOMBRE AS NOMBRE_OTR_ARC, DESCRIPCION AS DESCRIPCION_OTR_ARC FROM OTRAS_ARCHIVOS WHERE COMPANIA = '[compania]' AND ID = [numero_otras]
#BuscaPermisosOtrosGastos=SELECT ESTATUS FROM VI_EMPLEADO_AUT WHERE COMPANIA = '[compania]' AND EMPLEADO = '[usuario]'
BuscaPermisosOtrosGastos=SELECT A.ESTATUS, E.RFC FROM VI_EMPLEADO_AUT A, EMPLEADOS E WHERE A.COMPANIA = '[compania]' AND A.EMPLEADO = '[usuario]' AND E.NUM_EMPLEADO = A.EMPLEADO AND ROWNUM = 1


#Proveedores
RIABuscaProveedores=SELECT valida_prov(P.RFC,P.T_PERSONA, P.T_CLIEPROV,P.BANCO, P.NUMERO_CUENTA, P.CUENTA_CLAVE, P.CUENTA, P.CORREO) AS MGS_ERR,P.PASSWORD,P.CUENTA_VALIDA, P.ESTATUS,P.SWIFT,P.IBAN,P.TIPO_CUENTA, P.COMPANIA, P.ID_CLIENTE, P.ORIGEN, P.NOMBRE, P.RFC, P.ACT_ECONOMICA, P.F_ALTA, P.RAZON_SOCIAL,P.CUENTA_GASTO, P.PAPELERIA, P.T_PERSONA, P.T_CLIEPROV, P.T_TERCERO,P.CTO_CTO_DEFAULT, P.T_OPERACION, P.ID_FISCAL, P.NOMBRE_EXTRANJERO, P.PAIS_RESIDENCIA, P.NACIONALIDAD, P.FORMA_PAGO, P.BANCO, P.NUMERO_CUENTA, P.CUENTA_CLAVE, P.SALDO_INICIAL, P.DIAS_CREDITO, P.CONCEPTO_DEFAULT, P.AUXILIAR, P.CUENTA, P.CIE, P.PAGO_CIE, P.REFERENCIA_CIE, P.CUENTA_IVA,P.CUENTA_IVA_PAGO,P.CUENTA_COMPLEMENTARIA, P.CORREO, P.TELEFONO, P.TIPO_POLIZA, P.BANCO_PAGO,P.T_OPERACION_DIOT, (SELECT CALLE FROM ERP_PROV_DIRECCION WHERE COMPANIA = P.COMPANIA AND ID_PROVEEDOR = P.ID_CLIENTE) AS CALLE, (SELECT NO_EXTERIOR FROM ERP_PROV_DIRECCION WHERE COMPANIA = P.COMPANIA AND ID_PROVEEDOR = P.ID_CLIENTE) AS NO_EXTERIOR, (SELECT NO_INTERIOR FROM ERP_PROV_DIRECCION WHERE COMPANIA = P.COMPANIA AND ID_PROVEEDOR = P.ID_CLIENTE) AS NO_INTERIOR, (SELECT COLONIA FROM ERP_PROV_DIRECCION WHERE COMPANIA = P.COMPANIA AND ID_PROVEEDOR = P.ID_CLIENTE) AS COLONIA, (SELECT ESTADO FROM ERP_PROV_DIRECCION WHERE COMPANIA = P.COMPANIA AND ID_PROVEEDOR = P.ID_CLIENTE) AS ESTADO, (SELECT PAIS FROM ERP_PROV_DIRECCION WHERE COMPANIA = P.COMPANIA AND ID_PROVEEDOR = P.ID_CLIENTE) AS PAIS,(SELECT CP FROM ERP_PROV_DIRECCION WHERE COMPANIA = P.COMPANIA AND ID_PROVEEDOR = P.ID_CLIENTE) AS CP, (SELECT DELEGACION FROM ERP_PROV_DIRECCION WHERE COMPANIA = P.COMPANIA AND ID_PROVEEDOR = P.ID_CLIENTE) AS DELEGACION, P.VIATICO FROM ERP_CCLIENTES P WHERE P.COMPANIA ='[compania]' AND P.ID_CLIENTE LIKE '%[id]%' AND ORIGEN = 'P' ORDER BY P.NOMBRE
BuscaEstadoProv=SELECT ESTADO, NOMBRE FROM ESTADOS WHERE PAIS = '[pais]' ORDER BY NOMBRE
buscaCtaProv = select CUENTA_ALIAS ,cuenta, cuenta_alias ||'-'||nombre as nombre from cuentas where estructura = '[compania]' and (cuenta_ALIAS like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%')) AND AFECTABLE = 'S'
BuscaBancoSatProv = SELECT  B.CLAVE, B.NOMBRE, B.CLAVE ||'-'|| B.NOMBRE AS NOMBRE1 FROM ERP_SAT_BANCOS B WHERE (B.CLAVE like RTRIM('[query]%') OR upper(B.NOMBRE) like upper('%[query]%'))
BuscaPaisProv = SELECT PAIS, NOMBRE FROM PAISES ORDER BY NOMBRE
BuscaProductosProv = SELECT COMPANIA, PROVEEDOR, ID_PRODUCTO, NOMBRE,CODIGO, UNIDAD_MEDIDA, PRECIO_SIN_IVA, CODIGO_PROVEEDOR FROM ERP_PROV_PRODUCTOS WHERE COMPANIA = '[compania]' AND PROVEEDOR = '[proveedor]'
BuscaCboProveedor=SELECT RFC AS RFC_CBO,ID_CLIENTE AS ID_CLIENTE_CBO, NOMBRE AS NOMBRE_CBO, ID_CLIENTE || '-' || NOMBRE AS NOMBRE1_CBO FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND ORIGEN = 'P' AND (UPPER(ID_CLIENTE) LIKE UPPER('%[query]%') OR UPPER(NOMBRE) LIKE UPPER('%[query]%')) UNION SELECT '' AS RFC_CBO,'' AS ID_CLIENTE_CBO, 'TODOS' AS NOMBRE_CBO, 'TODOS' AS NOMBRE1_CBO FROM DUAL order by ID_CLIENTE_CBO DESC

BuscaImporteLetra=SELECT TOTAL_LETRA FROM ERP_FE_COMPROBANTES WHERE COMPANIA = '[compania]' AND NUMERO = '[numero]'
BuscaPermisosProveedores = SELECT PE_PERMISOS, PE_GPOUSU FROM GENTPE WHERE PE_GPOUSU = (SELECT US_GRUPO FROM GENTUS WHERE US_USUARIO = (SELECT UC_USUARIO FROM GENTUC WHERE UC_COMPANIA = '[compania]' AND UC_USUARIO = '[usuario]') AND US_CVESIS = 'empres' AND US_FECHA_BAJA IS NULL) AND PE_CVESIS = 'empres' AND PE_CVEOPC = 'm15c2000'

BuscatTercero=SELECT TIPO,NOMBRE FROM AF_TIPO_TERCERO WHERE COMPANIA = '[compania]'
BuscatOperacion=SELECT ID, NOMBRE FROM ERP_SAT_TRANSACCION_TIPO
BuscatOperacionDiot=SELECT TIPO,NOMBRE FROM AF_TIPO_OPERACION WHERE COMPANIA = '[compania]'
BuscaConceptoD=SELECT CONCEPTO,CONCEPTO ||'-'||NOMBRE as NOMBRE FROM ERP_CP_CONC_PAGO WHERE COMPANIA = '[compania]'

GENERA_EMPLEADO_VIATIC = BEGIN GENERA_VIATICO('[compania]', '[cliente]', '[rfc]','[banco]','[cuenta]','[cuentaClabe]','[proceso]'); END;

GENERA_REEMB_VIATIC = BEGIN GENERA_REEMB_VIATIC('[COMPANIA]', '[COMISION]','[ID]',[IMPORTE]); END;

GENERA_REEMB_OTRAS = BEGIN GENERA_REEMB_OTRAS('[COMPANIA]', '[COMISION]','[ID]',[IMPORTE]); END;
#Clientes

BuscaClientesGrid=SELECT valida_prov(RFC,T_PERSONA, T_CLIEPROV,BANCO, NUMERO_CUENTA, CUENTA_CLABE, CUENTA, CORREO) AS MGS_ERR,COMPANIA, ID_CLIENTE, ORIGEN, NOMBRE, RFC, TO_CHAR(F_ALTA,'DD/MM/YYYY') AS F_ALTA, RAZON_SOCIAL, T_PERSONA, T_CLIEPROV,AUXILIAR,CTO_CTO, CUENTA, BANCO, NUMERO_CUENTA, CUENTA_CLABE,CORREO, CUENTA_COMPLEMENTARIA,CUENTA_INGRESO FROM ERP_CLIENTES WHERE COMPANIA = '[compania]' AND ORIGEN = 'C' AND ID_CLIENTE LIKE '%[cliente]%' ORDER BY NOMBRE

BuscaClientesGridFalt=SELECT '[compania]' AS COMPANIA_FALT, ID_CLIENTE AS ID_CLIENTE_FALT, 'C' AS ORIGEN_FALT, NOMBRE_COMERCIAL AS NOMBRE_FALT, RFC AS RFC_FALT, TO_CHAR(SYSDATE,'DD/MM/YYYY') AS F_ALTA_FALT, NOMBRE_RAZON_SOCIAL AS RAZON_SOCIAL_FALT, '' AS T_PERSONA_FALT, '' AS T_CLIEPROV_FALT,'' AS AUXILIAR_FALT,'' AS CTO_CTO_FALT, '' AS CUENTA_FALT, '' AS BANCO_FALT, '' AS NUMERO_CUENTA_FALT, '' AS CUENTA_CLABE_FALT,'' AS CORREO_FALT FROM R_CLIENTES@RADM_DBLINK WHERE ID_COMPANIA = (SELECT COMPANIA_CXC FROM COMPANIAS WHERE COMPANIA = '[compania]') AND ID_CLIENTE LIKE '%[cliente]%' AND (RFC NOT IN (SELECT RFC FROM ERP_CLIENTES WHERE COMPANIA = '[compania]' AND ORIGEN = 'C') AND NOMBRE_RAZON_SOCIAL NOT IN (SELECT RAZON_SOCIAL FROM ERP_CLIENTES WHERE COMPANIA = '[compania]' AND ORIGEN = 'C')) ORDER BY NOMBRE_COMERCIAL

BuscaCboClientesFalt=SELECT ID_CLIENTE AS ID_CLIENTE_CBO, NOMBRE_RAZON_SOCIAL AS NOMBRE_CBO, ID_CLIENTE || '-' || NOMBRE_RAZON_SOCIAL AS NOMBRE1_CBO, RFC AS RFC_CBO FROM R_CLIENTES@RADM_DBLINK WHERE ID_COMPANIA = (SELECT COMPANIA_CXC FROM COMPANIAS WHERE COMPANIA = '[compania]') and (ID_CLIENTE LIKE '%[query]%' OR UPPER(NOMBRE_RAZON_SOCIAL) LIKE UPPER('%[query]%')) AND (RFC NOT IN (SELECT RFC FROM ERP_CLIENTES WHERE COMPANIA = '[compania]' AND ORIGEN = 'C') AND NOMBRE_RAZON_SOCIAL NOT IN (SELECT RAZON_SOCIAL FROM ERP_CLIENTES WHERE COMPANIA = '[compania]' AND ORIGEN = 'C')) UNION SELECT null AS ID_CLIENTE_CBO, 'TODOS' AS NOMBRE_CBO, '' AS NOMBRE1_CBO, '' AS RFC_CBO FROM DUAL ORDER BY ID_CLIENTE_CBO DESC

BuscaCboClientes=SELECT ID_CLIENTE AS ID_CLIENTE_CBO, NOMBRE AS NOMBRE_CBO, ID_CLIENTE || '-' || NOMBRE AS NOMBRE1_CBO, RFC AS RFC_CBO FROM ERP_CLIENTES WHERE COMPANIA = '[compania]' and (ID_CLIENTE LIKE '%[query]%' OR UPPER(NOMBRE) LIKE UPPER('%[query]%')) UNION SELECT '' AS ID_CLIENTE_CBO, 'TODOS' AS NOMBRE_CBO, '' AS NOMBRE1_CBO, '' AS RFC_CBO FROM DUAL ORDER BY ID_CLIENTE_CBO DESC
BuscaCTOClie=SELECT CTO_CTO, NOMBRE, CTO_CTO || '-' || NOMBRE AS NOMBRE1 FROM ERP_CTO_CTO WHERE COMPANIA = '[compania]' AND (CTO_CTO like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%'))
BuscaMaxClienteComp=SELECT NVL(MAX(TO_NUMBER(ID_CLIENTE)),0) + 1 AS ID_CLIENTE FROM ERP_CLIENTES WHERE COMPANIA = '[compania]'
BuscaMaxProveedorComp=SELECT NVL(MAX(TO_NUMBER(ID_CLIENTE)),0) + 1 AS ID_CLIENTE FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]'
BuscaPermisosClientes = SELECT PE_PERMISOS, PE_GPOUSU FROM GENTPE WHERE PE_GPOUSU = (SELECT US_GRUPO FROM GENTUS WHERE US_USUARIO = (SELECT UC_USUARIO FROM GENTUC WHERE UC_COMPANIA = '[compania]' AND UC_USUARIO = '[usuario]' AND ROWNUM=1) AND US_CVESIS = 'empres' AND US_FECHA_BAJA IS NULL AND ROWNUM = 1) AND PE_CVESIS = 'empres' AND PE_CVEOPC = 'm15c2001'
BuscaPermisosComponentes=SELECT COMPONENTE, READ_ONLY, HIDDEN, ALLOW_BLACK, TIPO FROM ERP_PERMISOS_APLI WHERE COMPANIA = '[compania]' AND USUARIO = '[usuario]' AND APLICACION = 'AppClientes'
BuscaPermisosComponentesProv=SELECT COMPONENTE, READ_ONLY, HIDDEN, ALLOW_BLACK, TIPO FROM ERP_PERMISOS_APLI WHERE COMPANIA = '[compania]' AND USUARIO = '[usuario]' AND APLICACION = 'AppProveedores'
BuscaPermisosComponentesCXP=SELECT COMPONENTE, READ_ONLY, HIDDEN, ALLOW_BLACK, TIPO FROM ERP_PERMISOS_APLI WHERE COMPANIA = '[compania]' AND USUARIO = '[usuario]' AND APLICACION = 'AppCXPFacturas'
BuscaPermisosComponentesOrden=SELECT COMPONENTE, READ_ONLY, HIDDEN, ALLOW_BLACK, TIPO FROM ERP_PERMISOS_APLI WHERE COMPANIA = '[compania]' AND USUARIO = '[usuario]' AND APLICACION = 'AppOrdenCompra'



permisosTok=SELECT componente FROM ERP_PERMISOS_APLI WHERE COMPANIA = '[compania]' AND TIPO = 'TOK' AND HIDDEN = '0' AND USUARIO = '[usuario]'

#VIATICOS
CONTA_INSERTA_VIATICOS = BEGIN CONTA_INSERTA_VIATICOS('[COMPANIA]', '[COMISION]', '[CONCEPTO]','[NUMERO]','[ORIGEN]'); END;
#COMPANIA FIJA PARA PRUEBAS
BuscaViaticos=SELECT V.REEMBOLSO,V.COMPANIA AS COMPANIA_VIATIC, V.COMISION AS NUMERO_VIATIC, 'V' AS T_GASTO_VIATIC, CAST('VIATICOS' as VARCHAR2(100) ) AS NOMBRE_T_GASTO_VIATIC, TO_CHAR(F_INI_COMISION,'DD/MM/YYYY') AS FECHA_VIATIC, E.RFC AS RFC_EMISOR_VIATIC, E.NOMBRE AS NOMBRE_EMISOR_VIATIC, V.OBJETIVO AS DESCRIPCION_VIATIC, V.IMPORTE AS SUBTOTAL_VIATIC, V.IMPORTE AS  TOTAL_VIATIC, (SELECT CTO_CTO FROM ERP_CTO_CTO WHERE COMPANIA = V.COMPANIA AND CTO_CTO = V.DEPARTAMENTO) AS CC_VIATIC, (SELECT NOMBRE FROM ERP_CTO_CTO WHERE COMPANIA = V.COMPANIA AND CTO_CTO = V.DEPARTAMENTO) AS NOMCC_VIATIC, V.ESTATUS AS ESTATUS_CXP_VIATIC,NVL(E.BANCO,'N/A') AS BANCO_VIATIC, NVL((SELECT NOMBRE FROM ERP_SAT_BANCOS WHERE CLAVE = E.BANCO),'N/A') AS NOM_BANCO_VIATIC, NVL(E.CUENTA_CLABE,'N/A') AS CUENTA_CLABE_VIATIC FROM VI_COMISIONES V,EMPLEADOS E WHERE V.COMPANIA = '[compania]' AND E.NUM_EMPLEADO = V.EMPLEADO AND E.COMPANIA = V.COMPANIA AND TO_CHAR(V.F_INI_COMISION,'YYYY') = '[calendario]' AND TO_NUMBER(TO_CHAR(V.F_INI_COMISION,'MM')) >= TO_NUMBER('[periodo]') AND TO_NUMBER(TO_CHAR(V.F_INI_COMISION,'MM')) <= TO_NUMBER('[periodoFinal]')
CONTA_ACTUALIZA_VIATICOS = BEGIN CONTA_ACTUALIZA_EST_VIATICOS('[COMPANIA]', '[COMISION]', '[TIPO]',[FOLIO_PAGO]); END;

BuscaRfcComp = SELECT RFC FROM COMPANIAS WHERE COMPANIA = '[compania]'

#Portal para proveedores
PortalFacturasProveedor=SELECT (SELECT B.RAZON_SOCIAL FROM ERP_CCLIENTES L, ERP_SAT_BANCOS B WHERE L.COMPANIA = C.COMPANIA AND L.RFC = C.RFC AND B.CLAVE = L.BANCO AND ROWNUM = 1) AS RAZON_SOCIAL,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = C.RFC AND ROWNUM = 1) AS BANCO,(SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = C.RFC AND ROWNUM = 1) AS CUENTA_CLABE,(SELECT NUMERO_CUENTA FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = C.RFC AND ROWNUM = 1) AS NUMERO_CUENTA, C.COMPANIA, NVL(C.DESCRIPCION_CANCELACION,''),NVL(TO_CHAR (C.FECHA_PAGO_CXP, 'DD/MM/YYYY'),'') AS FECHA_PAGO_CXP_FE,NVL((SELECT COMENTARIOS FROM ERP_CXP_FOLIOS WHERE COMPANIA = C.COMPANIA AND FOLIO = C.FOLIO_PAGOS AND ORIGEN = 'F' AND NUMERO_FE = C.NUMERO),'') AS DESCRIPCION_PAGOS ,(SELECT O.NOMBRE FROM COMPANIAS O WHERE O.COMPANIA=C.COMPANIA) NOMBRE, (SELECT O2.RFC FROM COMPANIAS O2 WHERE O2.COMPANIA=C.COMPANIA) RFC_EMPRESA,(SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=C.COMPANIA AND E.RFC=C.RFC AND ROWNUM=1) PROVEEDOR, C.NUMERO, C.FOLIO, TO_CHAR (C.FECHA, 'DD/MM/YYYY') AS FECHA, C.SERIE, C.SUBTOTAL, C.TOTAL, C.TIPO_CAMBIO, C.TIPO_DE_COMPROBANTE, C.DESCUENTO, C.MONEDA, C.IDCONCGASTO, C.ORIGEN,C.TIPO_POLIZA, C.NUMERO_POL, TO_CHAR (C.FECHA_POL, 'DD/MM/YYYY') AS FECHA_POL, C.XML, TO_CHAR (C.FECHA_CAP, 'DD/MM/YYYY') AS FECHA_CAP, C.DIR_PDF, C.DIR_XML, C.RFC, C.UUID, C.USUARIO, C.CONCEPTO_CXP, TO_CHAR (C.FECHA_VENC_CXP, 'DD/MM/YYYY') AS FECHA_VENC_CXP, TO_CHAR (C.FECHA_PAGO_CXP, 'DD/MM/YYYY') AS FECHA_PAGO_CXP, C.ESTATUS_CXP, C.MONEDA_PAGO, C.PAGO_CIE, C.REFERENCIA_CIE, C.TOTAL_LETRA FROM ERP_FE_COMPROBANTES C WHERE C.COMPANIA = '[compania]' AND C.RFC = '[usuario]' ORDER BY C.FECHA DESC
PortalDatosProveedor =SELECT C.RFC,C.NOMBRE AS PROVEEDOR ,C.COMPANIA,CO.NOMBRE,CO.RFC as RFC_EMPRESA FROM ERP_CCLIENTES C,COMPANIAS CO WHERE C.COMPANIA ='[compania]' AND C.RFC = '[usuario]' AND CO.COMPANIA =C.COMPANIA
PortalDatosProveedorExt =SELECT C.ID_CLIENTE,C.TIPO_CUENTA,C.USUARIO,C.RFC,C.NOMBRE AS PROVEEDOR ,C.COMPANIA,CO.NOMBRE,CO.RFC as RFC_EMPRESA FROM ERP_CCLIENTES C,COMPANIAS CO WHERE C.COMPANIA ='[compania]' AND C.USUARIO = '[usuario]' AND CO.COMPANIA =C.COMPANIA
PortalFacturasProveedorExt=SELECT (SELECT B.RAZON_SOCIAL FROM ERP_CCLIENTES L, ERP_SAT_BANCOS B WHERE L.COMPANIA = C.COMPANIA AND L.RFC = C.RFC AND B.CLAVE = L.BANCO AND ROWNUM = 1) AS RAZON_SOCIAL,(SELECT BANCO FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = C.RFC AND ROWNUM = 1) AS BANCO,(SELECT CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = C.RFC AND ROWNUM = 1) AS CUENTA_CLABE,(SELECT NUMERO_CUENTA FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND RFC = C.RFC AND ROWNUM = 1) AS NUMERO_CUENTA, C.COMPANIA, NVL(C.DESCRIPCION_CANCELACION,''),NVL(TO_CHAR (C.FECHA_PAGO_CXP, 'DD/MM/YYYY'),'') AS FECHA_PAGO_CXP_FE,NVL((SELECT COMENTARIOS FROM ERP_CXP_FOLIOS WHERE COMPANIA = C.COMPANIA AND FOLIO = C.FOLIO_PAGOS AND ORIGEN = 'F' AND NUMERO_FE = C.NUMERO),'') AS DESCRIPCION_PAGOS ,(SELECT O.NOMBRE FROM COMPANIAS O WHERE O.COMPANIA=C.COMPANIA) NOMBRE, (SELECT O2.RFC FROM COMPANIAS O2 WHERE O2.COMPANIA=C.COMPANIA) RFC_EMPRESA,(SELECT E.NOMBRE FROM ERP_FE_EMISOR E WHERE E.COMPANIA=C.COMPANIA AND E.RFC=C.RFC AND ROWNUM=1) PROVEEDOR, C.NUMERO, C.FOLIO, TO_CHAR (C.FECHA, 'DD/MM/YYYY') AS FECHA, C.SERIE, C.SUBTOTAL, C.TOTAL, C.TIPO_CAMBIO, C.TIPO_DE_COMPROBANTE, C.DESCUENTO, C.MONEDA, C.IDCONCGASTO, C.ORIGEN,C.TIPO_POLIZA, C.NUMERO_POL, TO_CHAR (C.FECHA_POL, 'DD/MM/YYYY') AS FECHA_POL, C.XML, TO_CHAR (C.FECHA_CAP, 'DD/MM/YYYY') AS FECHA_CAP, C.DIR_PDF, C.DIR_XML, C.RFC, C.UUID, C.USUARIO, C.CONCEPTO_CXP, TO_CHAR (C.FECHA_VENC_CXP, 'DD/MM/YYYY') AS FECHA_VENC_CXP, TO_CHAR (C.FECHA_PAGO_CXP, 'DD/MM/YYYY') AS FECHA_PAGO_CXP, C.ESTATUS_CXP, C.MONEDA_PAGO, C.PAGO_CIE, C.REFERENCIA_CIE, C.TOTAL_LETRA FROM ERP_FE_COMPROBANTES C WHERE C.COMPANIA = '[compania]' AND C.RFC = (SELECT RFC FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' and USUARIO = '[usuario]') ORDER BY C.FECHA DESC
avisosPortal=SELECT AVISO FROM ERP_PORTAL_AVISOS WHERE COMPANIA = '[compania]' AND TO_DATE(TO_CHAR(SYSDATE,'DD/MM/YYYY'),'DD/MM/YYYY') BETWEEN TO_DATE(TO_CHAR(FECHA_INI,'DD/MM/YYYY'),'DD/MM/YYYY') AND TO_DATE(TO_CHAR(FECHA_FIN,'DD/MM/YYYY'),'DD/MM/YYYY') AND ESTATUS = 'A' ORDER BY ID
verificaUsuarioPortal=SELECT USUARIO FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' and usuario = '[usuarioPor]'
BuscaIdProv = SELECT ID_CLIENTE FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND RFC = '[rfc]'
BuscaIdProvUsr = SELECT ID_CLIENTE FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND USUARIO = '[usuario]'
PortalValidaCarga=SELECT valida_carga_facturas('[compania]','[parametro]') AS MSG_VALIDA FROM DUAL

CONTA_INSERTA_FECHAVENC = BEGIN CONTA_ACTUALIZA_FEC_VENC('[compania]', [numero],'[idCliente]','[origen]'); END;


BuscaFolioOrden=SELECT IMPORTE FROM ERP_CXP_ORDEN_COMPRA WHERE COMPANIA = '[compania]' AND IMPORTE = [total] AND CALENDARIO = [calendario] AND PERIODO = [periodo] AND ESTATUS = 'A' AND RFC = '[rfc]'

PortalCxpOtras=SELECT COMPANIA AS COMPANIA_OTROS, ID AS NUMERO_OTROS, TO_CHAR(FECHA,'DD/MM/YYYY') AS FECHA_OTROS,TO_CHAR(FECHA_VENC_CXP,'DD/MM/YYYY') AS FECHA_VENC_CXP_OTRAS, RFC AS RFC_EMISOR_OTROS, BENEFICIARIO AS NOMBRE_EMISOR_OTROS, DESCRIPCION AS DESCRIPCION_OTROS,IMPORTE AS SUBTOTAL_OTROS, TOTAL AS TOTAL_OTROS,MONEDA AS MONEDA_OTROS, OTROS_IMPUESTOS AS OTROS_IMPUESTOS_OTROS, IVA AS IVA_OTROS, TIPO_CAMBIO AS TIPO_CAMBIO_OTROS, ARCHIVO,RUTA, ESTATUS_CXP AS ESTATUS_CXP_OTROS FROM ERP_CP_OTRAS  WHERE COMPANIA = '[compania]' AND TIPO_GASTO = 'X' AND RFC = (SELECT RFC FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND USUARIO = '[usuario]' AND ROWNUM = 1) ORDER BY ID

#WS Intercos

BuscaCompaniaIntercos=SELECT COMPANIA FROM COMPANIAS WHERE RFC = '[rfcReceptor]' AND COMPANIA_CXC IS NOT NULL

#Polizas Pagos

BuscaPagosParciales=SELECT IMPORTE_OPERACION,OBSERVACIONES, BANCO, TO_CHAR(FECHA_PAGO_CXP_FE,'DD/MM/YYYY') AS FECHA_PAGO,CUENTA_BANCO FROM ERP_SEGUI_DOCUMENTOS WHERE COMPANIA = '[compania]' AND NUMERO_FE = [numero] ORDER BY SEC

#Pagos de Notas

BuscaPagosTot=SELECT NVL(SUM(IMPORTE_OPERACION),0) AS SUM_IMPORTE FROM ERP_SEGUI_DOCUMENTOS WHERE COMPANIA = '[compania]' AND NUMERO_FE = [numero] AND T_DOC = 'FE' AND ORIGEN = 'P' AND SERIE = 'A'

#Token

BuscaIdToken=SELECT ID_CEL FROM TOK_USUARIOS WHERE ID_CEL = '[idCel]'
CONTA_CREATE_TOKEN=BEGIN CONTA_CREATE_TOKEN('[idCel]'); END;
BuscaToken=SELECT TOK_ID FROM TOK_ID WHERE ID_CEL = '[idCel]' and TOK_HORA = (SELECT MAX(TOK_HORA) FROM TOK_ID WHERE ID_CEL = '[idCel]') AND ROWNUM = 1
ValidaToken=SELECT ID_CEL,TOK_ID,ROUND((SYSDATE-TOK_HORA)*24, 2)*60 "DIFERENECIA" FROM TOK_ID WHERE TOK_ID = '[idTok]'
InsertaTokenFolio=INSERT INTO TOK_ID_AUTO (TOK_ID,FOLIO_AUT) VALUES ('[TOK_ID]',[FOLIO_AUT])


BuscaPermisosPortal=SELECT COMPONENTE, READ_ONLY, HIDDEN, ALLOW_BLACK, TIPO FROM ERP_PERMISOS_APLI WHERE COMPANIA = '[compania]' AND APLICACION = 'AppPortal' AND USUARIO = 'PROV'

InsertaCorreoProvBan=INSERT INTO CORREO_ENVIO_PROV (COMPANIA,USUARIO,ENVIO,TIPO,CUENTA_CLABE,BANCO,NUMERO_CUENTA) VALUES ('[compania]','[usuario]','0','2','[ctaClabe]','[banco]','[ctaNum]')
InsertaCorreoProvBanExt=INSERT INTO CORREO_ENVIO_PROV (COMPANIA,USUARIO,ENVIO,TIPO,IBAN,SWIFT) VALUES ('[compania]','[usuario]','0','2','[iban]','[swift]')


BuscaDatosBancarios=SELECT BANCO,NUMERO_CUENTA,CUENTA_CLAVE FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND USUARIO = '[usuario]'
BuscaDatosBancariosExt=SELECT IBAN,SWIFT FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND USUARIO = '[usuario]'


#Axiliar tpq
BuscaTransXFolioT=SELECT  RFC_EMISOR,   UUID, RFC_RECEPTOR, MET_PAGO_AUX, MONTO_TOTAL, MONEDA, TIPO_CAMBIO FROM ERP_FE_CARGA_CFDI WHERE NUM_UN_IDEN_POL = '[numIde]' AND COMPANIA2 = '[compania]'
BuscaPolizasT=SELECT COMPANIA, REFERENCIA, NUMIDENPOL, TO_CHAR(FECHA,'yyyy-MM-dd') AS FECHA FROM ERP_CARGA_POLIZAS_RELACION WHERE TO_CHAR(FECHA,'MM') = '[periodo]' AND TO_CHAR(FECHA,'YYYY') = '[calendario]' AND COMPANIA = '[compania]'

PermisosCfdi=SELECT COMPONENTE,HIDDEN FROM ERP_PERMISOS_APLI WHERE COMPANIA = '[compania]' AND USUARIO = '[usuario]' AND TIPO = 'GRID' AND APLICACION = 'AppCargaFE2'

#Datos default

BuscaDatosDefault=SELECT CONCEPTO_DEFAULT, CTO_CTO_DEFAULT FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND RFC = '[rfc]'


BuscaTipoPolSat=SELECT TIPO_SAT FROM TIPOS_POLIZAS WHERE TIPO_POLIZA = '[tipoPoliza]' AND COMPANIA = '[compania]'

#ARCHIVOS CXP

GetArchivosTesoreria=SELECT COMPANIA AS COMPANIA_CXP, FOLIO AS FOLIO_CXP, SEC AS SEC_CXP, PATH AS PATH_CXP, URL AS URL_CXP, NOMBRE AS NOMBRE_CXP FROM ERP_FOLIO_CXP_ARCHIVOS WHERE COMPANIA = '[compania]' AND FOLIO = [folio]

#Orden Compra
BuscaProveedorOrden=SELECT RFC, NOMBRE, ID_CLIENTE FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND UPPER(NOMBRE) LIKE UPPER('%[query]%')
BuscaOrdenCompra=SELECT O.NOMBRE, O.DESCRIPCION,O.ID, O.COMPANIA, O.FOLIO, O.CALENDARIO,O.PERIODO,O.IMPORTE,O.USUARIO,O.ESTATUS,(SELECT NOMBRE FROM ERP_ORDEN_ESTATUS WHERE ID = O.ESTATUS AND O.ESTATUS IS NOT NULL) AS ESTATUS_NOM,O.RFC,O.ID_PROVEEDOR,O.USUARIO_AUTORIZO,O.USUARIO_COMPRADOR,O.CONDICIONES_PAGO,TO_CHAR(O.FECHA_ORDEN,'DD/MM/YYYY') AS FECHA_ORDEN,TO_CHAR(O.FECHA_REQUERIDA,'DD/MM/YYYY') AS FECHA_REQUERIDA,O.CLASIFICACION,O.TOTAL,O.TOTAL_PENDIENTE,O.ID_ALMACEN,O.CTO_CTO FROM ERP_ORDEN_COMPRA O WHERE O.COMPANIA = '[compania]' ORDER BY O.ID DESC
BuscaDetOrdenCompra = SELECT (SELECT COUNT(*) FROM ERP_ORDENXFACTURA WHERE COMPANIA = D.COMPANIA AND ID_ORDEN = D.ID_ORDEN_COMPRA AND ID_ORDEN_DET = D.LINEA) AS FACT_REL,(SELECT ID_PEDIDO FROM ERP_ORDENXPEDIDOS WHERE COMPANIA = D.COMPANIA AND ORDEN_COMPRA = D.ID_ORDEN_COMPRA AND LINEA = D.LINEA) AS ID_PEDIDO,D.ID,D.ESTATUS_LINEA,D.LINEA,D.ID_ORDEN_COMPRA,D.COMPANIA,D.ID_PRODUCTO,D.DESCRIPCION,D.CANTIDAD_PEDIDA,D.CANTIDAD_LLEGO,D.PRECIO_UNITARIO,D.IVA,D.TOTAL,D.IMPORTE_COTIZACION,D.ID_ALMACEN,D.ID_ESTATUS,(SELECT NOMBRE FROM ERP_ORDEN_ESTATUS_DET WHERE ID = D.ID_ESTATUS) AS NOM_ESTATUS,D.ID_PRIORIDAD FROM ERP_ORDEN_COMPRA_DET D WHERE D.COMPANIA = '[compania]' AND D.ID_ORDEN_COMPRA = '[id]'
BuscaAlamcen = SELECT ID, NOMBRE , ID || '-' || NOMBRE AS NOMBRE1 FROM ERP_ALMACEN WHERE COMPANIA = '[compania]'
BuscaProductos = SELECT ID,NOMBRE FROM ERP_ALM_PRODUCTOS WHERE COMPANIA = '[compania]' AND (ID LIKE '%[query]%' OR UPPER(NOMBRE) LIKE UPPER('%[query]%')) ORDER BY NOMBRE
BuscaRelOrdenXFacturas = WITH A AS (SELECT (SELECT ESTATUS_CXP FROM ERP_ORDENXFACTURA WHERE COMPANIA = '[compania]' AND ID_ORDEN = [idOrden] AND NUMERO_FE = O.ID AND ID_ORDEN_DET = [idOrdenDet]) AS ESTATUS_CXP,O.COMPANIA,O.ARCHIVO,(SELECT NOMBRE FROM ERP_ORDEN_ARCHIVOS WHERE COMPANIA = '[compania]' AND ORDEN_COMPRA = [idOrden] AND NUMERO = O.ID AND ORIGEN = 'OTR') AS ARCHIVO_ORDEN, (SELECT ID_ORDEN FROM ERP_ORDENXFACTURA WHERE COMPANIA = '[compania]' AND ID_ORDEN = [idOrden] AND NUMERO_FE = O.ID AND ID_ORDEN_DET = [idOrdenDet]) AS ID_ORDEN,(SELECT ID_ORDEN_DET FROM ERP_ORDENXFACTURA WHERE COMPANIA = '[compania]' AND ID_ORDEN = [idOrden] AND NUMERO_FE = O.ID AND ID_ORDEN_DET = [idOrdenDet]) AS ID_ORDEN_DET, O.ID AS NUMERO_FE,'OTR' AS ORIGEN,TO_CHAR(O.FECHA,'DD/MM/YYYY') as FECHA, O.BENEFICIARIO AS NOM_PROVEEDOR,O.MONEDA,O.IMPORTE AS SUBTOTAL,O.IVA, O.TOTAL, O.DESCRIPCION AS CONCEPTO FROM ERP_CP_OTRAS O WHERE O.COMPANIA = '[compania]' AND O.TIPO_GASTO = 'X' AND O.ID_PROVEEDOR = '[idProveedor]' AND (O.ESTATUS_CXP = '' OR O.ESTATUS_CXP IS NULL) AND O.ID IN (SELECT NUMERO FROM ERP_ORDEN_ARCHIVOS WHERE COMPANIA  = O.COMPANIA AND NUMERO = O.ID AND ORDEN_COMPRA = [idOrden] AND ORIGEN = 'OTR')), B AS (SELECT (SELECT ESTATUS_CXP FROM ERP_ORDENXFACTURA WHERE COMPANIA = '[compania]' AND ID_ORDEN = [idOrden] AND NUMERO_FE = C.NUMERO AND ID_ORDEN_DET = [idOrdenDet]) AS ESTATUS_CXP,C.XML AS ARCHIVO,C.COMPANIA,(SELECT NOMBRE FROM ERP_ORDEN_ARCHIVOS WHERE COMPANIA = '[compania]' AND ORDEN_COMPRA = [idOrden] AND NUMERO = C.NUMERO AND ORIGEN = 'FE') AS ARCHIVO_ORDEN,(SELECT ID_ORDEN FROM ERP_ORDENXFACTURA WHERE COMPANIA = '[compania]' AND ID_ORDEN = [idOrden] AND NUMERO_FE = C.NUMERO AND ID_ORDEN_DET = [idOrdenDet]) AS ID_ORDEN,(SELECT ID_ORDEN_DET FROM ERP_ORDENXFACTURA WHERE COMPANIA = '[compania]' AND ID_ORDEN = [idOrden] AND NUMERO_FE = C.NUMERO AND ID_ORDEN_DET = [idOrdenDet]) AS ID_ORDEN_DET,C.NUMERO AS NUMERO_FE,'FE' AS ORIGEN,TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA,E.NOMBRE AS NOM_PROVEEDOR,C.MONEDA,C.SUBTOTAL,(SELECT SUM(IMPORTE) FROM ERP_FE_IMP_TRASLADOS WHERE COMPANIA = C.COMPANIA AND NUMERO = C.NUMERO AND IMPUESTO = '002') AS IVA,C.TOTAL,(SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS WHERE COMPANIA = C.COMPANIA AND NUMERO = C.NUMERO AND ROWNUM = 1) AS CONCEPTO FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E WHERE C.COMPANIA = '[compania]' AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND E.RFC = (SELECT RFC FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ID_CLIENTE = '[idProveedor]') AND C.NUMERO IN (SELECT NUMERO FROM ERP_ORDEN_ARCHIVOS WHERE COMPANIA  = C.COMPANIA AND NUMERO = C.NUMERO AND ORDEN_COMPRA = [idOrden] AND ORIGEN = 'FE')) SELECT A.ESTATUS_CXP,A.ARCHIVO,A.COMPANIA,A.ARCHIVO_ORDEN, A.ID_ORDEN,A.ID_ORDEN_DET,A.NUMERO_FE,A.ORIGEN,A.FECHA,A.NOM_PROVEEDOR,A.MONEDA,A.SUBTOTAL,A.IVA,A.TOTAL,A.CONCEPTO FROM A UNION SELECT B.ESTATUS_CXP,B.ARCHIVO,B.COMPANIA,B.ARCHIVO_ORDEN,B.ID_ORDEN,B.ID_ORDEN_DET,B.NUMERO_FE,B.ORIGEN,B.FECHA,B.NOM_PROVEEDOR,B.MONEDA,B.SUBTOTAL,B.IVA,B.TOTAL,B.CONCEPTO FROM B
BuscaRelOrdenCXP=WITH A AS (SELECT F.ESTATUS_CXP,O.COMPANIA,O.ARCHIVO,(SELECT NOMBRE FROM ERP_ORDEN_ARCHIVOS WHERE COMPANIA = '[compania]' AND ORDEN_COMPRA = [idOrden] AND NUMERO = O.ID AND ORIGEN = 'OTR') AS ARCHIVO_ORDEN, F.ID_ORDEN,F.ID_ORDEN_DET, O.ID AS NUMERO_FE,'OTR' AS ORIGEN,TO_CHAR(O.FECHA,'DD/MM/YYYY') as FECHA, O.BENEFICIARIO AS NOM_PROVEEDOR,O.MONEDA,O.IMPORTE AS SUBTOTAL,O.IVA, O.TOTAL, O.DESCRIPCION AS CONCEPTO FROM ERP_CP_OTRAS O,ERP_ORDENXFACTURA F WHERE O.COMPANIA = '[compania]' AND F.COMPANIA = O.COMPANIA AND ID_ORDEN = [idOrden] AND F.NUMERO_FE = O.ID AND ID_ORDEN_DET = [idOrdenDet] AND O.TIPO_GASTO = 'X' AND O.ID_PROVEEDOR = '[idProveedor]' AND (O.ESTATUS_CXP = '' OR O.ESTATUS_CXP IS NULL) AND O.ID IN (SELECT NUMERO FROM ERP_ORDEN_ARCHIVOS WHERE COMPANIA  = O.COMPANIA AND NUMERO = O.ID AND ORDEN_COMPRA = [idOrden] AND ORIGEN = 'OTR')), B AS (SELECT F.ESTATUS_CXP,C.XML AS ARCHIVO,C.COMPANIA,(SELECT NOMBRE FROM ERP_ORDEN_ARCHIVOS WHERE COMPANIA = '[compania]' AND ORDEN_COMPRA = [idOrden] AND NUMERO = C.NUMERO AND ORIGEN = 'FE') AS ARCHIVO_ORDEN, F.ID_ORDEN,F.ID_ORDEN_DET,C.NUMERO AS NUMERO_FE,'FE' AS ORIGEN,TO_CHAR(C.FECHA,'DD/MM/YYYY') AS FECHA,E.NOMBRE AS NOM_PROVEEDOR,C.MONEDA,C.SUBTOTAL,(SELECT SUM(IMPORTE) FROM ERP_FE_IMP_TRASLADOS WHERE COMPANIA = C.COMPANIA AND NUMERO = C.NUMERO AND IMPUESTO = '002') AS IVA,C.TOTAL,(SELECT DESCRIPCION FROM ERP_FE_CONCEPTOS WHERE COMPANIA = C.COMPANIA AND NUMERO = C.NUMERO AND ROWNUM = 1) AS CONCEPTO FROM ERP_FE_COMPROBANTES C, ERP_FE_EMISOR E,ERP_ORDENXFACTURA F WHERE  C.COMPANIA = '[compania]' AND F.COMPANIA = C.COMPANIA AND F.ID_ORDEN = [idOrden] AND F.NUMERO_FE = C.NUMERO AND F.ID_ORDEN_DET = [idOrdenDet] AND E.COMPANIA = C.COMPANIA AND E.NUMERO = C.NUMERO AND E.RFC = (SELECT RFC FROM ERP_CCLIENTES WHERE COMPANIA = C.COMPANIA AND ID_CLIENTE = '[idProveedor]') AND C.NUMERO IN (SELECT NUMERO FROM ERP_ORDEN_ARCHIVOS WHERE COMPANIA  = C.COMPANIA AND NUMERO = C.NUMERO AND ORDEN_COMPRA = [idOrden] AND ORIGEN = 'FE')) SELECT A.ESTATUS_CXP,A.ESTATUS_CXP AS ESTATUS_CXP2,A.ARCHIVO,A.COMPANIA,A.ARCHIVO_ORDEN,A.ID_ORDEN,A.ID_ORDEN_DET,A.NUMERO_FE,A.ORIGEN,A.FECHA,A.NOM_PROVEEDOR,A.MONEDA,A.SUBTOTAL,A.IVA,A.TOTAL,A.CONCEPTO FROM A UNION SELECT B.ESTATUS_CXP,B.ESTATUS_CXP as ESTATUS_CXP2,B.ARCHIVO,B.COMPANIA,B.ARCHIVO_ORDEN,B.ID_ORDEN,B.ID_ORDEN_DET,B.NUMERO_FE,B.ORIGEN,B.FECHA,B.NOM_PROVEEDOR,B.MONEDA,B.SUBTOTAL,B.IVA,B.TOTAL,B.CONCEPTO FROM B
BuscaOrdenCompraId=SELECT ID FROM ERP_ORDEN_COMPRA WHERE COMPANIA  = '[compania]' AND RFC = '[rfc]' and ID = [orden] AND ESTATUS = 'AU'
BuscaOrdenCompraIdExt=SELECT ID FROM ERP_ORDEN_COMPRA WHERE COMPANIA  = '[compania]' AND ID_PROVEEDOR = '[idClienta]' and ID = [orden] AND ESTATUS = 'AU'
InsertaArchivoOrden= INSERT INTO ERP_ORDEN_ARCHIVOS (COMPANIA,ORDEN_COMPRA,ORIGEN,NUMERO,PATH,URL,NOMBRE) VALUES ('[COMPANIA]',[ORDEN_COMPRA],'[ORIGEN]',[NUMERO],'[PATH]','[URL]','[NOMBRE]')
BuscaImportesOrdenDet=SELECT NVL(SUM(SUBTOTAL),0) AS SUBTOTAL,NVL(SUM(IVA),0) AS IVA,NVL(SUM(TOTAL),0) AS TOTAL FROM ERP_ORDENXFACTURA WHERE COMPANIA = '[compania]' AND ID_ORDEN = '[idOrden]' AND ID_ORDEN_DET = '[idOrdenDet]'
BuscaImportesOrden=SELECT NVL(SUM(SUBTOTAL),0) AS SUBTOTAL,NVL(SUM(IVA),0) AS IVA,NVL(SUM(TOTAL),0) AS TOTAL FROM ERP_ORDENXFACTURA WHERE COMPANIA = '[compania]' AND ID_ORDEN = '[idOrden]'
BuscaPedidos=SELECT P.DESCRIPCION,P.CONC_GASTO,(SELECT NOMBRE FROM ERP_CP_CONC_PAGO WHERE COMPANIA = P.COMPANIA AND CONCEPTO = P.CONC_GASTO) AS NOMBRE_CONCEPTO, P.COMPANIA, P.ID, P.ID_PRODUCTO,(SELECT ID || '-' || NOMBRE FROM ERP_ALM_PRODUCTOS WHERE COMPANIA = P.COMPANIA AND ID =P.ID_PRODUCTO) AS NOMBRE_PRODUCT,P.CANTIDAD,P.USUARIO,P.CTO_CTO,P.FECHA_CAP,P.ESTATUS, TO_CHAR(P.FECHA_CANCELA,'DD/MM/YYYY') AS FECHA_CANCELA,P.MOTIVO_CANCELA,TO_CHAR(P.FECHA_ENTREGA,'DD/MM/YYYY') AS FECHA_ENTREGA,P.SEC,P.AUTORIZO FROM ERP_PEDIDOS P WHERE P.COMPANIA = '[compania]' AND P.ESTATUS = 'A'
BuscaCotizacionProducto=SELECT NVL(IMPORTE_COTIZACION,0) AS IMPORTE_COTIZACION FROM ERP_ALM_PRODUCTOS WHERE COMPANIA = '[compania]' AND ID = [idProducto]
ActualizaPedidos=UPDATE ERP_PEDIDOS SET ESTATUS  = '[estatus]' WHERE COMPANIA = '[compania]' AND ID = [id]
ActualizaPedidosCan=UPDATE ERP_PEDIDOS P SET P.ESTATUS  = '[estatus]' WHERE P.COMPANIA = '[compania]' AND P.ID IN (SELECT ID_PEDIDO FROM ERP_ORDENXPEDIDOS WHERE ORDEN_COMPRA = [ordenCompra] AND COMPANIA  = P.COMPANIA) 
BuscaImportesFactura=SELECT C.TOTAL,C.SUBTOTAL,NVL((SELECT SUM(IMPORTE) FROM ERP_FE_IMP_TRASLADOS WHERE COMPANIA = C.COMPANIA AND NUMERO = C.NUMERO AND IMPUESTO = '002'),0) AS IVA FROM ERP_FE_COMPROBANTES C WHERE C.COMPANIA = '[compania]' AND C.NUMERO = [numero]
BuscaRFCEmpresa=SELECT COMPANIA,NOMBRE,RFC FROM COMPANIAS WHERE COMPANIA = '[compania]'
BuscaDatosProveedorOrden=SELECT ID_CLIENTE,RFC,NOMBRE FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND RFC = '[rfc]'
BuscaArchivosPedidos=SELECT COMPANIA,ID_PEDIDO,ID,NOMBRE,DESCRIPCION,URL,PATH,NOMBRE_ARCHIVO,USUARIO FROM ERP_PEDIDOS_ARCHIVOS WHERE COMPANIA = '[compania]' AND ID_PEDIDO = [id]
BuscaCompaniaPortal=SELECT COMPANIA,NOMBRE FROM COMPANIAS WHERE UPPER(NOMBRE) LIKE UPPER('%[query]%') AND COMPANIA_PORTAL = 'UNISRG'

insertLogWsOrden=INSERT INTO ERP_ORDEN_WS_LOG (COMPANIA,ID_PROCESO,ID_ORDEN_WS,ID_LINEA_WS,ESTATUS,MSG) VALUES ('[compania]','[idProceso]','[idOrden]','[linea]','[estatus]','[msg]')
