PolizasFovi_Anios=SELECT DISTINCT CALENDARIO AS CALENDARIO, CALENDARIO AS CALENDARIO_NAME FROM CALENDARIOS_CON WHERE COMPANIA = '[compania]' ORDER BY 1 DESC
PolizasFovi_datos= SELECT P.HORA AS HORA, P.COMPANIA AS COMPANIA, C_COSTOS||'-'||C_COSTOS.NOMBRE AS CTO, P.NUMERO AS NUMERO, P.ESTATUS AS ESTATUS, P.TIPO_POLIZA||'-'||T.NOMBRE AS TIPO, TO_CHAR(P.FECHA,'DD-MM-YYYY') AS FECHA, P.NOMBRE AS NOMBRE, P.DIVISA||'-'||D.NOMBRE AS DIVISA, P.PARIDAD AS PARIDAD, P.FUENTE AS FUENTE, P.REFERENCIA AS REFERENCIA, P.CARGOS_BASE AS CARGOS_BASE, P.ABONOS_BASE AS ABONOS_BASE, P.CARGOS AS CARGOS , P.ABONOS AS ABONOS FROM POLIZAS P, DIVISAS D, TIPOS_POLIZAS T, C_COSTOS WHERE SUBSTR(NUMERO,1,2) = C_COSTOS.C_COSTOS AND C_COSTOS.COMPANIA = '[compania]' AND P.DIVISA = D.DIVISA AND P.TIPO_POLIZA = T.TIPO_POLIZA AND T.COMPANIA = P.COMPANIA AND TO_CHAR(P.FECHA,'YYYY') = '[calendario]' AND SUBSTR(P.NUMERO,1,2) LIKE '[ccostos]%' AND P.TIPO_POLIZA = '[tipo_poliza]' AND P.COMPANIA = '[compania]' ORDER BY P.TIPO_POLIZA, P.NUMERO
PolizasFovi_DetPolizas_datos= select d.NUMERO || d.tipo_poliza || to_char(d.fecha,'ddmmyyyy') || D.SEC AS ID,d.hora, d.sec, d.c_costos AS CC, d.cto_trabajo AS CT, d.cuenta, d.descripcion, d.referencia, d.cheque, d.rfc, d.cargos_base, d.abonos_base, d.cargos, d.abonos,C.NOMBRE AS NOMCUENTA,d.REFERENCIA2, to_char(fecha_documento,'DD/MM/YYYY') AS FECHA_DOCUMENTO  from det_polizas d, CUENTAS C where d.compania = '[compania]' and d.tipo_poliza = '[tipo_poliza]' and d.fecha = to_date('[fecha]','dd/mm/yyyy') and d.numero = '[numero]' AND C.CUENTA=D.CUENTA AND C.estructura in (select estructura from companias where compania = '[compania]') ORDER BY D.SEC
PolizasFovi_CCostos=select distinct CTO_CTO as CTO, CTO_CTO||'-'||NOMBRE AS CTO_NAME from ERP_CTO_CTO where compania = '[compania]'  UNION ALL SELECT '', 'SIN CENTRO DE COSTO' AS SC FROM DUAL order by 1

CuentaRegistros=SELECT COUNT(*) as TOTAL FROM  det_polizas d, CUENTAS C where d.compania = '[compania]' and d.tipo_poliza = '[tipo_poliza]' and d.fecha = to_date('[fecha]','dd/mm/yyyy') and d.numero = '[numero]' AND C.CUENTA=D.CUENTA AND C.estructura in (select estructura from companias where compania = '[compania]') 

SumCargosAbonos=SELECT distinct SUM(d.cargos) AS SUM_CARGOS, SUM(d.abonos) AS SUM_ABONOS  FROM det_polizas d, CUENTAS C where d.compania = '[compania]' and d.tipo_poliza = '[tipo_poliza]' and d.fecha = to_date('[fecha]','dd/mm/yyyy') and d.numero = '[numero]' AND C.CUENTA=D.CUENTA AND C.estructura in (select estructura from companias where compania = '[compania]') 


PolizasFovi_Cuentas =select cuenta, nombre as nombre from cuentas where estructura in (select estructura from companias where compania = '[compania]') and afectable = 'S' and (cuenta like RTRIM('[query]%') OR upper(NOMBRE) like upper('%[query]%')) order by 1
PolizasFovi_Periodos=select periodo from periodos_con where compania = '[compania]' and to_date('[FECHA]', 'yyyy-mm-dd') between fecha_ini and fecha_fin and estatus = 0
BuscaPoliza = SELECT NUMERO || tipo_poliza || to_char(fecha,'ddmmyyyy') AS ID, NUMERO, to_char(fecha,'dd/mm/yyyy') AS FECHA  FROM POLIZAS WHERE HORA ='[HORA]' AND COMPANIA='[compania]' AND TIPO_POLIZA = '[TIPO]'
BuscaPolizaDet = SELECT NUMERO || tipo_poliza || to_char(fecha,'ddmmyyyy')|| SEC AS ID, NUMERO, to_char(fecha,'dd/mm/yyyy') AS FECHA  FROM DET_POLIZAS WHERE  COMPANIA='[compania]' AND TIPO_POLIZA = '[TIPO]' AND NUMERO ='[NUMERO]' AND HORA ='[HORA]' ORDER BY SEC
BuscaCuentaCorrecta = select cuenta, nombre as nombre from cuentas where afectable = 'S' and cuenta like RTRIM('[CUENTA]%') and estructura in (select estructura from companias where compania = '[compania]') order by 1
PolizasFovi_RFC = SELECT NOMBRE, RFC FROM ERP_CCLIENTES WHERE COMPANIA = '[compania]' AND ORIGEN  = 'P' AND RFC LIKE UPPER ('[query]%')
TiposPolizas = SELECT TIPO_POLIZA, NOMBRE, TIPO_POLIZA || '-' || NOMBRE AS NOMBRE1 FROM TIPOS_POLIZAS WHERE COMPANIA = '[compania]'

CONTA_INSERTA_POLIZAS_FOVI= BEGIN CONTA_INSERTA_POLIZAS_FOVI('[HORA]', '[compania]', '[CC]', '[NUMERO]', '[ESTATUS]', '[TIPO]', TO_DATE('[FECHA]','yyyy-mm-dd'), '[NOMBRE]', '[DIVISA]', '[PARIDAD]', '[FUENTE]', '[REFERENCIA]', [CARGOS_BASE], [ABONOS_BASE], [CARGOS], [ABONOS], '[OPERACION]', '[usuario]'); END;
CONTA_INSERTA_DETPOLIZAS_FOVI= BEGIN CONTA_INSERTA_DETPOLIZAS_FOVI2('[compania]', '[NUMERO]', '[TIPO]', TO_DATE('[FECHA]','dd/mm/yyyy'), '[HORA]', '[SEC]', '[CC]', '[CT]', '[CUENTA]','[DESCRIPCION]', '[REFERENCIA]', '[CHEQUE]', '[RFC]', [CARGOS], [ABONOS], [CARGOS], [ABONOS], '[OPERACION]', '[usuario]','[REFERENCIA2]','[FECHA_DOCUMENTO]'); END;

PolizasFovi_CCostos=select distinct CTO_CTO as CTO, CTO_CTO||'-'||NOMBRE AS CTO_NAME from ERP_CTO_CTO where compania = '[compania]'  UNION ALL SELECT '', 'SIN CENTRO DE COSTO' AS SC FROM DUAL order by 1
PolizasFovi_datos_busfecha=select  P.NUMERO || p.tipo_poliza || to_char(p.fecha,'ddmmyyyy') AS ID,p.hora,p.compania,cto.cto_cto||'-'||cto.nombre,p.numero,p.estatus,p.tipo_poliza||'-'||t.nombre AS TIPO,to_char(p.fecha,'dd/mm/yyyy') AS FECHA,p.nombre,p.divisa||'-'||d.nombre,p.paridad,p.fuente,p.referencia,p.cargos_base,p.abonos_base,p.cargos,p.abonos from polizas p, erp_divisas d, tipos_polizas t, ERP_CTO_CTO cto where  p.compania = '[compania]' and    p.tipo_poliza = '[tipo_poliza]'  and t.compania = p.compania and t.tipo_poliza = p.tipo_poliza and  to_char(p.fecha,'yyyy') = '[calendario]' and d.divisa = p.divisa and p.fecha BETWEEN to_date('[fec_ini]','dd/mm/yyyy') and to_date('[fec_fin]','dd/mm/yyyy') and cto.compania = p.compania and cto.cto_cto IN (SELECT DISTINCT det2.C_COSTOS FROM DET_POLIZAS det2 WHERE det2.COMPANIA = '[compania]' AND det2.TIPO_POLIZA = '[tipo_poliza]' AND det2.FECHA = P.FECHA AND det2.NUMERO=P.NUMERO AND det2.c_costos like '[ccostos]%' ) order by p.tipo_poliza, p.numero
PolizasFovi_datos_busfecnum=select P.NUMERO || p.tipo_poliza || to_char(p.fecha,'ddmmyyyy') AS ID,p.hora,p.compania,cto.cto_cto||'-'||cto.nombre,p.numero,p.estatus,p.tipo_poliza||'-'||t.nombre AS TIPO,to_char(p.fecha,'dd/mm/yyyy') AS FECHA,p.nombre,p.divisa||'-'||d.nombre,p.paridad,p.fuente,p.referencia,p.cargos_base,p.abonos_base,p.cargos,p.abonos from polizas p, erp_divisas d, tipos_polizas t, ERP_CTO_CTO cto where  p.compania = '[compania]' and    p.tipo_poliza = '[tipo_poliza]'  and t.compania = p.compania and t.tipo_poliza = p.tipo_poliza and  to_char(p.fecha,'yyyy') = '[calendario]' and d.divisa = p.divisa and p.fecha BETWEEN to_date('[fec_ini]','dd/mm/yyyy') and to_date('[fec_fin]','dd/mm/yyyy') and cto.compania = p.compania and cto.cto_cto IN (SELECT DISTINCT det2.C_COSTOS FROM DET_POLIZAS det2 WHERE det2.COMPANIA = '[compania]' AND det2.TIPO_POLIZA = '[tipo_poliza]' AND det2.FECHA = P.FECHA AND det2.NUMERO=P.NUMERO AND det2.c_costos like '[ccostos]%' ) and numero between [num_ini] and [num_fin] order by p.tipo_poliza, p.numero
PolizasFovi_datos_busfecha_sinCC= select P.NUMERO || p.tipo_poliza || to_char(p.fecha,'ddmmyyyy') AS ID, p.hora,p.compania,'00-00' as cto_cto   ,p.numero,p.estatus,p.tipo_poliza||'-'||t.nombre AS TIPO,to_char(p.fecha,'dd/mm/yyyy') AS FECHA,p.nombre,p.divisa||'-'||d.nombre,p.paridad,p.fuente,p.referencia,p.cargos_base,p.abonos_base,p.cargos,p.abonos from polizas p, erp_divisas d, tipos_polizas t where  p.compania = '[compania]' and    p.tipo_poliza = '[tipo_poliza]'  and t.compania = p.compania and t.tipo_poliza = p.tipo_poliza and  to_char(p.fecha,'yyyy') = '[calendario]' and d.divisa = p.divisa and p.fecha BETWEEN to_date('[fec_ini]','dd/mm/yyyy') and to_date('[fec_fin]','dd/mm/yyyy')  order by p.tipo_poliza, p.numero
BuscaCCCorrecto=select distinct CTO_CTO as CTO, CTO_CTO||'-'||NOMBRE AS CTO_NAME from ERP_CTO_CTO where compania = '[compania]' AND CTO_CTO = '[CC]'  order by 1
EstatusPoliza=SELECT ESTATUS FROM POLIZAS WHERE  COMPANIA='[compania]' AND TIPO_POLIZA = '[TIPO]' AND NUMERO ='[NUMERO]' AND FECHA = '[FECHA]'
BuscaDetallePolizaCopia = SELECT d.NUMERO || d.tipo_poliza || to_char(d.fecha,'ddmmyyyy') || D.SEC AS ID,d.hora, d.sec, d.c_costos AS CC, d.cto_trabajo AS CT, d.cuenta, d.descripcion, d.referencia, d.cheque, d.rfc, d.cargos_base, d.abonos_base, d.cargos, d.abonos from det_polizas d WHERE  d.COMPANIA='[compania]' AND d.TIPO_POLIZA = '[tipOriginal]' AND d.NUMERO ='[numOriginal]' AND d.FECHA = to_date('[fecOriginal]','DD/MM/YYYY') ORDER BY d.SEC


BuscaArchivos = SELECT COMPANIA, TIPO_POLIZA, TO_CHAR(FECHA,'DD/MM/YYYY') as FECHA, NUMERO, SEC, PATH, URL, NOMBRE, DESCRIPCION FROM POLIZAS_ARCHIVOS WHERE COMPANIA ='[compania]' AND TIPO_POLIZA = '[tipo_poliza]' AND FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND NUMERO= '[numero]' order by sec desc
INSERTA_DATOS_ARCHIVO= INSERT INTO POLIZAS_ARCHIVOS ( COMPANIA, TIPO_POLIZA, FECHA,  NUMERO, SEC, PATH,  URL,NOMBRE,DESCRIPCION) VALUES ( '[compania]','[TIPO_POLIZA]', TO_DATE('[FECHA]','DD/MM/YYYY'), '[NUMERO]', (SELECT NVL(MAX(SEC),0)+1 FROM POLIZAS_ARCHIVOS WHERE COMPANIA ='[compania]' AND TIPO_POLIZA = '[TIPO_POLIZA]' AND FECHA=TO_DATE('[FECHA]','DD/MM/YYYY') AND NUMERO ='[NUMERO]'), '[PATH]', '[URL]','[NOMBRE]','[DESCRIPCION]')
QUITAR_ARCHIVO = DELETE FROM POLIZAS_ARCHIVOS WHERE COMPANIA ='[compania]' AND TIPO_POLIZA = '[tipo_poliza]' AND FECHA = TO_DATE('[fecha]','DD/MM/YYYY') AND NUMERO= '[numero]' AND SEC=[sec]








